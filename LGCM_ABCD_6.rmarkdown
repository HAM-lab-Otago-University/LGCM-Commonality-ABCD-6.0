---
title: "LGCM_ABCD_6.0"
format: html
editor: visual
---


# Setup


```{r}
#| include: false

knitr::opts_chunk$set(echo = TRUE)
library(styler)
library(knitr)
library(tidyverse)
library(psych)
library(lavaan)
library(semPlot)
library(semptools)
library(parameters)
library(rio)
library(rmarkdown)
library(visdat)
library(summarytools)
library(EFAtools)
library(lavaanPlot)
library(ggplot2)

```


# Load Data


```{r}

demo6 <- tibble::as_tibble(rio::import("ab_p_demo.tsv")) # Demographic Data
sex6 <- tibble::as_tibble(rio::import("ab_g_stc.tsv")) # sex
svs6 <- tibble::as_tibble(rio::import("nc_y_svs.tsv")) # Snellen's vision problem screening
cbcl6 <- tibble::as_tibble(rio::import("mh_p_cbcl.tsv")) # Child Behavior Checklist
tool6 <- tibble::as_tibble(rio::import("nc_y_nihtb.tsv")) # NIH Toolbox
asr6 <- tibble::as_tibble(rio::import("mh_p_asr.tsv")) # Adult Self Report
```


# replace "n/a" with NA


```{r}
demo6 <- demo6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

sex6 <- sex6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

svs6 <- svs6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

cbcl6 <- cbcl6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

tool6 <- tool6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

asr6 <- asr6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))
```


## Vision problem screening 


```{r}
# Check for vision problem
vision <- svs6 %>% mutate(visionProb = ifelse(nc_y_svs_002 == 0 | nc_y_svs_002 == 1 | nc_y_svs_002__01 == 2, 1, 0))

# Join data excluding participants with vision problem
abcd6_all <- plyr::join_all(list(vision, demo6, cbcl6, tool6, asr6), by = c("participant_id", "session_id"), type = "full") %>%
  filter(visionProb != 1 | is.na(visionProb))
```


## prapare Data


```{r}
# check duplicate

abcd6_all %>%
  select(participant_id, session_id) %>%
  group_by(session_id) %>%
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id)))

# Convert data into appropriate type

abcd6_all <- abcd6_all %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ utils::type.convert(.x, as.is = TRUE)))

# label session_id into 0 (baseline) to 6 years follow-up
abcd6_all <- abcd6_all %>%
  mutate(
    session_id = factor(session_id,
      levels = c(
        "ses-00A",
        "ses-01A",
        "ses-02A",
        "ses-03A",
        "ses-04A",
        "ses-05A",
        "ses-06A"
      ),
      labels = c("0", "1", "2", "3", "4", "5", "6")
    )
  )

# Add sex
abcd6_all.sex <- plyr::join_all(
  list(
    abcd6_all,
    sex6 %>%
      select(participant_id, ab_g_stc__cohort_sex) %>%
      drop_na(ab_g_stc__cohort_sex)
  ),
  by = c("participant_id"), type = "left"
)

# check duplicate
abcd6_all.sex %>% 
  select(participant_id,session_id,ab_g_stc__cohort_sex) %>% 
  group_by(ab_g_stc__cohort_sex,session_id) %>% 
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id)))

```


## Age & Sex in each timepoint


```{r}
abcd6_all.sex %>% 
  select(participant_id,session_id,ab_p_demo_age,ab_g_stc__cohort_sex) %>% 
  group_by(session_id) %>% 
    dplyr::summarise(count = dplyr::n(), 
              AgeMean = round(mean(ab_p_demo_age, na.rm = T), 2),
              AgeSD = round(sd(ab_p_demo_age, na.rm = T), 2),
              male_pct   = mean(ab_g_stc__cohort_sex == 1) * 100,
              female_pct = mean(ab_g_stc__cohort_sex == 2) * 100
              )
z```

# Load Cognition Data (g factor)

```{r}
g_factor <- abcd6_all %>%
  select(contains(c("_id", "uncor_score"))) 

colnames(g_factor) <- c(
  "participant_id",
  "session_id",
  "cryst",     # Crystallized Composite Score
  "fluid",     # Fluid Composite Score
  "total_int", # Total Composite Scores
  "cardsort",  # Dimensional Change Card Sort
  "flanker",   # Flanker Inhibitory Control & Attention
  "list",      # List Sorting Working Memory
  "picture",   # Picture Sequence Memory
  "picvocab",  # Picture Vocabulary
  "pattern",   # Pattern Comparison Processing Speed
  "reading"    # Oral Reading Recognition: Language
)
```



## Valid data N & % in session_id


```{r}

g_factor %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  })

# 5 cognitive tasks:
# flnkr, picsq, picvcb, pttcp, readr
# 4 time points available: 
# Baseline (00), 2 year follow-up (02), 4 year follow-up (04), 6 year follow-up (06)
```


## Check data


```{r}

# Select 5 available cognitive tasks in 4 time points

g_factor_5task <- g_factor %>%
  select(
    "participant_id",
    "session_id",
    "flanker", # Flanker Inhibitory Control & Attention
    "picture", # Picture Sequence Memory
    "picvocab", # Picture Vocabulary
    "pattern", # Pattern Comparison Processing Speed
    "reading" # Oral Reading Recognition: Language
  ) %>% 
  filter(session_id %in% c("0", "2", "4", "6")) # only baseline, 2, 4, and 6 years data


# Year 0 (Baseline)

g_factor_5task %>%
  filter(session_id == "0") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 2 

g_factor_5task %>%
  filter(session_id == "2") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 4

g_factor_5task %>%
  filter(session_id == "4") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 6

g_factor_5task %>%
  filter(session_id == "6") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Reading in Year 2 contained an outliar 
# (180 raw score which should be ranged from 59 to 140)

g_factor_5task$reading <- ifelse(g_factor_5task$reading > 140,
                                 NA, # replace >140 with NA
                                 g_factor_5task$reading)

# Recheck

g_factor_5task %>%
  filter(session_id == "2") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) 

# reading max score came down from 180 to 121 
```


### Missing Visualization 


```{r}

# Baseline
g_factor_5task %>% 
  filter(session_id == "0") %>%
  visdat::vis_miss()


# 2-year follow-up
g_factor_5task %>% 
  filter(session_id == "2") %>%
  visdat::vis_miss()

# 4-year follow-up
g_factor_5task %>% 
  filter(session_id == "4") %>%
  visdat::vis_miss()

# 6-year follow-up
g_factor_5task %>% 
  filter(session_id == "6") %>%
  visdat::vis_miss()
```


## Scaled score: Z score


```{r}

# Scale into Z-score across all time points

g_factor_5task.scaled <- g_factor_5task %>%
  mutate_at(scale,
    .vars = c(
      "flanker", # Flanker Inhibitory Control & Attention
      "picture", # Picture Sequence Memory
      "picvocab", # Picture Vocabulary
      "pattern", # Pattern Comparison Processing Speed
      "reading" # Oral Reading Recognition: Language
    ),
    center = TRUE,
    scale = TRUE
  )
```


## Reconstruct Data

#### Long form (Scaled)


```{r}

g_factor_5task_long.scaled <- g_factor_5task.scaled %>%
  pivot_longer(
    cols = c(
      "flanker", # Flanker Inhibitory Control & Attention
      "picture", # Picture Sequence Memory
      "picvocab", # Picture Vocabulary
      "pattern", # Pattern Comparison Processing Speed
      "reading" # Oral Reading Recognition: Language
    ),
    names_to = "variable",
    values_to = "value"
  )

# check duplicate
g_factor_5task_long.scaled %>% 
  group_by(session_id,variable) %>% 
  dplyr::summarise(count = sum(!is.na(value)), 
                   duplicate = any(duplicated(participant_id))
                   )
```


#### Wide form (Scaled)


```{r}

g_factor_5task_wide.scaled <- g_factor_5task.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(
      "flanker", # Flanker Inhibitory Control & Attention
      "picture", # Picture Sequence Memory
      "picvocab", # Picture Vocabulary
      "pattern", # Pattern Comparison Processing Speed
      "reading" # Oral Reading Recognition: Language
   )
  )


# check duplicate
g_factor_5task_wide.scaled %>% 
  select(participant_id) %>% 
  dplyr::summarise(count = sum(!is.na(participant_id)),
                   duplicate = any(duplicated(participant_id))
                   )
```


### Descriptive Stat Summary


```{r}
g_factor_5task_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd"),
    transpose = T,
    headings = F
  )
```


# Load CBCL (Child p factor)


```{r}
pc_factor <- abcd6_all %>% 
  select(contains(c("_id","cbcl"))) %>% # select id & cbcl items
  select(contains(c("_id", "_0"))) %>% # select only items, not sum scores
  select(-contains("othpr")) # excluded other problem items
```


## Valid data N & % in session_id


```{r}

pc_factor %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  })

# > 98% availability across all cbcl items in all 7 time points (0-6)
```


## Check Low Freq CBCL items


```{r}

pc_lowcheck <- pc_factor

# check total items

pc_lowcheck %>%   
  filter(session_id == "ses-00A") %>% 
  select(contains("cbcl")) %>% 
  ncol() # n of total items = 103

# Check only 0 responses
pc_lowcheck[,3:ncol(pc_lowcheck)] <- ifelse(pc_lowcheck[,3:ncol(pc_lowcheck)] == 0,1,NA) 

# Check items with zero response >= 99.5% across all timelines

# Baseline
lowfreq_cbcl6_b <- pc_lowcheck %>%   
  filter(session_id == "ses-00A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 1 Year Follow-up
lowfreq_cbcl6_1 <- pc_lowcheck %>%   
  filter(session_id == "ses-01A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 2 Year Follow-up
lowfreq_cbcl6_2 <- pc_lowcheck %>%   
  filter(session_id == "ses-02A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 3 Year Follow-up
lowfreq_cbcl6_3 <- pc_lowcheck %>%   
  filter(session_id == "ses-03A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 4 Year Follow-up
lowfreq_cbcl6_4 <- pc_lowcheck %>%   
  filter(session_id == "ses-04A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 5 Year Follow-up
lowfreq_cbcl6_5 <- pc_lowcheck %>%   
  filter(session_id == "ses-05A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 6 Year Follow-up
lowfreq_cbcl6_6 <- pc_lowcheck %>%   
  filter(session_id == "ses-06A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()



# low frequecy item Summary

# Baseline:  
lowfreq_cbcl6_b # rule__cond_010, rule__001, rule__003, rule__005, rule__006

# 1Year:
lowfreq_cbcl6_1 # rule__cond_010, rule__001, rule__003, rule__005, rule__006

# 2Year:
lowfreq_cbcl6_2 # rule__001, rule__003, rule__005, rule__006

# 3Year:
lowfreq_cbcl6_3 # rule__001, rule__003, rule__005, rule__006, tho_005

# 4Year:
lowfreq_cbcl6_4 # tho_005

# 5Year:
lowfreq_cbcl6_5 # tho_005

# 6Year:
lowfreq_cbcl6_6 # rule__cond_006, tho_005

# low freq Item Description (7 unique items)

#mh_p_cbcl__rule_001	= Drinks alcohol without parents' approval
#mh_p_cbcl__rule__cond_006	= Sets fires
#mh_p_cbcl__rule_003	= Sexual problems
#mh_p_cbcl__rule_005	= Smokes, chews, or sniffs tobacco
#mh_p_cbcl__rule__cond_010 =	Truancy, skips school	101
#mh_p_cbcl__rule_006 =	Uses drugs for non medical purposes (don't include alcohol or tobacco)
#mh_p_cbcl__tho_005 =	Plays with own sex parts in public
```


## Cut Low Freq CBCL items


```{r}

# Cut low frequecy items across all timelines

pc_factor_nolow <- pc_factor %>% 
  select(-all_of(c(lowfreq_cbcl6_b
                   ,lowfreq_cbcl6_1
                   ,lowfreq_cbcl6_2
                   ,lowfreq_cbcl6_3
                   ,lowfreq_cbcl6_4
                   ,lowfreq_cbcl6_5
                   ,lowfreq_cbcl6_6
                   )))

# n of remaining items = 96 out of 103
pc_factor_nolow %>% 
  select(contains("cbcl")) %>% 
  ncol()
```


## Calculate Composite scores for CBCL


```{r}

pc_factor_nolow <- pc_factor_nolow %>%
  mutate(
    # Anxious/Depressed composite score
    anxdep_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("anxdep"))
    ),
    # Withdrawn/Depressed composite score
    withdep_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("wthdep"))
    ),
    # Somatic complaints composite score
    soma_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("som"))
    ),
    # Social Problems composite score
    socprob_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("soc"))
    ),
    # Thought Problems composite score
    thouprob_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("tho"))
    ),
    # Attention Problems composite score
    attprob_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("attn"))
    ),
    # Rule-breaking behavior composite score
    rulebreak_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("rule"))
    ),
    # Aggressive behavior composite score
    aggress_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("aggr"))
    )
  ) %>%
  mutate(
    Int_comp = rowMeans(cbind(
      anxdep_comp,
      withdep_comp,
      soma_comp
    )),
    Ext_comp = rowMeans(cbind(
      rulebreak_comp,
      aggress_comp
    )),
    total_comp = rowMeans(cbind(
      Int_comp,
      socprob_comp,
      thouprob_comp,
      attprob_comp,
      Ext_comp
    ))
  )
```


## Check data


```{r}

pc_factor_nolow_comp <- pc_factor_nolow %>%
  select(
    "participant_id",
    "session_id",
    "anxdep_comp",
    "withdep_comp",
    "soma_comp",
    "socprob_comp",
    "thouprob_comp",
    "attprob_comp",
    "rulebreak_comp",
    "aggress_comp",
    "Int_comp",
    "Ext_comp",
    "total_comp"
  )


# Year 0 (Baseline)

pc_factor_nolow_comp %>%
  filter(session_id == "0") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 2 

pc_factor_nolow_comp %>%
  filter(session_id == "2") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 4

pc_factor_nolow_comp %>%
  filter(session_id == "4") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 6

pc_factor_nolow_comp %>%
  filter(session_id == "6") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )
```


## Scaled score: Z score


```{r}

pc_factor_nolow_comp.scaled <- pc_factor_nolow_comp %>%
  mutate_at(scale,
    .vars = c(
          "anxdep_comp"
         ,"withdep_comp"
         ,"soma_comp"
         ,"socprob_comp"
         ,"thouprob_comp"
         ,"attprob_comp"
         ,"rulebreak_comp"
         ,"aggress_comp"
         ,"Int_comp"
         ,"Ext_comp"
         ,"total_comp"
      ),
    center = TRUE,
    scale = TRUE
  )
```


## Reconstruct Data

#### Long form (Scaled)


```{r}

pc_factor_nolow_long.scaled <- pc_factor_nolow_comp.scaled %>%
  pivot_longer(
    cols = c(
      "anxdep_comp",
      "withdep_comp",
      "soma_comp",
      "socprob_comp",
      "thouprob_comp",
      "attprob_comp",
      "rulebreak_comp",
      "aggress_comp",
      "Int_comp",
      "Ext_comp",
      "total_comp"
    ),
    names_to = "variable",
    values_to = "value"
  )

# check duplicate
pc_factor_nolow_long.scaled %>% 
  group_by(session_id,variable) %>% 
  dplyr::summarise(count = sum(!is.na(value)), 
                   duplicate = any(duplicated(participant_id))
                   )
```


#### Wide form (Scaled)


```{r}

pc_factor_nolow_wide.scaled <- pc_factor_nolow_comp.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(
      "anxdep_comp",
      "withdep_comp",
      "soma_comp",
      "socprob_comp",
      "thouprob_comp",
      "attprob_comp",
      "rulebreak_comp",
      "aggress_comp",
      "Int_comp",
      "Ext_comp",
      "total_comp"
   )
  )

# check duplicate
pc_factor_nolow_wide.scaled %>% 
  select(participant_id) %>% 
  dplyr::summarise(count = sum(!is.na(participant_id)),
                   duplicate = any(duplicated(participant_id))
                   )
```


### Descriptive Stat Summary


```{r}
pc_factor_nolow_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd"),
    transpose = T,
    headings = F
  )
```


# Load ASR (Parent p factor)


```{r}
pp_factor <- abcd6_all %>%
  select(contains(c("_id", "asr"))) %>% # select id & cbcl items
  select(contains(c("_id", "_0"))) %>% # select only items, not sum scores
  select(contains(
    c("_id",
      "aggr",   # Aggressive item
      "anxdep", # Anxious/depressed item
      "attn",   # Attention item
      "intru",  # Intrusive beh item
      "rule",   # Rule breaking item
      "som",    # Somatic item
      "tho",    # Thought item
      "wthdr"   # Withdrawn/depressed item
    )
  ))
```


## Valid data N & % in session_id


```{r}

pp_factor %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  })

# > 98% availability across all asr items in all 3 time points (0,2,4)
```


## Check Low Freq CBCL items


```{r}

pp_lowcheck <- pp_factor

# check total items

pp_lowcheck %>%   
  filter(session_id == "ses-00A") %>% 
  select(contains("asr")) %>% 
  ncol() # n of total items = 99

# Check only 0 responses
pp_lowcheck[,3:ncol(pp_lowcheck)] <- ifelse(pp_lowcheck[,3:ncol(pp_lowcheck)] == 0,1,NA) 

# Check items with zero response >= 99.5% across all timelines

# Baseline
lowfreq_asr6_b <- pp_lowcheck %>%   
  filter(session_id == "ses-00A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 2 Year Follow-up
lowfreq_asr6_2 <- pp_lowcheck %>%   
  filter(session_id == "ses-02A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# 4 Year Follow-up
lowfreq_asr6_4 <- pp_lowcheck %>%   
  filter(session_id == "ses-04A") %>% 
  descr(
      stats     = c("n.valid", "pct.valid"),
      transpose = TRUE,
      headings  = FALSE) %>% 
  filter(Pct.Valid >= 99.5) %>% 
  rownames()

# low frequecy item Summary

# Baseline:  
lowfreq_asr6_b # None

# 2Year:
lowfreq_asr6_2 # None

# 4Year:
lowfreq_asr6_4 # None
```


## Calculate Composite scores for CBCL


```{r}

pp_factor <- pp_factor %>%
  mutate(
    # Anxious/Depressed composite score
    asr_anxdep_comp = rowMeans(
      pp_factor %>%
        select(contains("anxdep"))
    ),
    # Withdrawn/Depressed composite score
    asr_withdep_comp = rowMeans(
      pp_factor %>%
        select(contains("wthdr"))
    ),
    # Somatic complaints composite score
    asr_soma_comp = rowMeans(
      pp_factor %>%
        select(contains("som"))
    ),
    # Thought Problems composite score
    asr_thouprob_comp = rowMeans(
      pp_factor %>%
        select(contains("tho"))
    ),
    # Attention Problems composite score
    asr_attprob_comp = rowMeans(
      pp_factor %>%
        select(contains("attn"))
    ),
    # Rule-breaking behavior composite score
    asr_rulebreak_comp = rowMeans(
      pp_factor %>%
        select(contains("rule"))
    ),
    # Aggressive behavior composite score
    asr_aggress_comp = rowMeans(
      pp_factor %>%
        select(contains("aggr"))
    ),
    # Intrusive composite score
    asr_intru_comp = rowMeans(
      pp_factor %>%
        select(contains("intru"))
    )
  ) %>%
  mutate(
    asr_Int_comp = rowMeans(cbind(
      asr_anxdep_comp,
      asr_withdep_comp,
      asr_soma_comp
    )),
    asr_Ext_comp = rowMeans(cbind(
      asr_rulebreak_comp,
      asr_aggress_comp,
      asr_intru_comp
    )),
    asr_total_comp = rowMeans(cbind(
      asr_Int_comp,
      asr_thouprob_comp,
      asr_attprob_comp,
      asr_Ext_comp
    ))
  )
```


## Check data


```{r}

pp_factor_comp <- pp_factor %>%
  select(
    "participant_id",
    "session_id",
    "asr_anxdep_comp",
    "asr_withdep_comp",
    "asr_soma_comp",
    "asr_thouprob_comp",
    "asr_attprob_comp",
    "asr_rulebreak_comp",
    "asr_aggress_comp",
    "asr_intru_comp",
    "asr_Int_comp",
    "asr_Ext_comp",
    "asr_total_comp"
  ) %>% 
  filter(session_id %in% c("0", "2", "4")) # only baseline, 2, and 4 years data


# Year 0 (Baseline)

pp_factor_comp %>%
  filter(session_id == "0") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 2 

pp_factor_comp %>%
  filter(session_id == "2") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 4

pp_factor_comp %>%
  filter(session_id == "4") %>% 
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )
```


## Scaled score: Z score


```{r}

pp_factor_comp.scaled <- pp_factor_comp %>%
  mutate_at(scale,
    .vars = c(
      "asr_anxdep_comp",
      "asr_withdep_comp",
      "asr_soma_comp",
      "asr_thouprob_comp",
      "asr_attprob_comp",
      "asr_rulebreak_comp",
      "asr_aggress_comp",
      "asr_intru_comp",
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
    ),
    center = TRUE,
    scale = TRUE
  )
```


## Reconstruct Data

#### Long form (Scaled)


```{r}

pp_factor_long.scaled <- pp_factor_comp.scaled %>%
  pivot_longer(
    cols = c(
      "asr_anxdep_comp",
      "asr_withdep_comp",
      "asr_soma_comp",
      "asr_thouprob_comp",
      "asr_attprob_comp",
      "asr_rulebreak_comp",
      "asr_aggress_comp",
      "asr_intru_comp",
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
    ),
    names_to = "variable",
    values_to = "value"
  )

# check duplicate
pp_factor_long.scaled %>% 
  group_by(session_id,variable) %>% 
  dplyr::summarise(count = sum(!is.na(value)), 
                   duplicate = any(duplicated(participant_id))
                   )
```


#### Wide form (Scaled)


```{r}

pp_factor_wide.scaled <- pp_factor_comp.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(
      "asr_anxdep_comp",
      "asr_withdep_comp",
      "asr_soma_comp",
      "asr_thouprob_comp",
      "asr_attprob_comp",
      "asr_rulebreak_comp",
      "asr_aggress_comp",
      "asr_intru_comp",
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
   )
  )

# check duplicate
pp_factor_wide.scaled %>% 
  select(participant_id) %>% 
  dplyr::summarise(count = sum(!is.na(participant_id)),
                   duplicate = any(duplicated(participant_id))
                   )
```


### Descriptive Stat Summary


```{r}
pp_factor_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid","mean", "sd"),
    transpose = T,
    headings = F
  )
```


# Join all data 

## No sex


```{r}
pga6_wide.allscaled <- plyr::join_all(
  list(
    g_factor_5task_wide.scaled,
    pc_factor_nolow_wide.scaled,
    pp_factor_wide.scaled
  ),
  by = c("participant_id"), type = "full"
)

# check duplicate
pga6_wide.allscaled %>% 
  select(participant_id) %>% 
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id)))

# n = 11867

pga6_wide.allscaled %>% 
  saveRDS("pga6_all_data.rds")
```


## Add sex


```{r}

pga6_wide.allscaled.sex <- plyr::join_all(
  list(
    readRDS("pga6_all_data.rds"),
    sex6 %>%
      select(participant_id, ab_g_stc__cohort_sex) %>%
      drop_na(ab_g_stc__cohort_sex)
  ),
  by = c("participant_id"), type = "left"
) %>%
  mutate(dummy_sex = 2-ab_g_stc__cohort_sex)

# check duplicate
pga6_wide.allscaled.sex %>% 
  select(participant_id,dummy_sex) %>% 
  group_by(dummy_sex) %>% 
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id)))

# n = 11867

pga6_wide.allscaled.sex %>% 
  saveRDS("pga6_all_data_sex.rds")
```


# Growth curve model

## g factor

### Configural invariance model

#### model fit


```{r}

g.4t.config.invar <-'#factor loadings # S & S2
               g_etaB =~ lambda_S*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ lambda_S2*flanker_2+
                       lambda_R2*pattern_2+ 
                       lambda_M2*picture_2+
                       lambda_P2*picvocab_2+
                       lambda_V2*reading_2
               g_eta4 =~ lambda_S4*flanker_4+
                       lambda_R4*pattern_4+ 
                       lambda_M4*picture_4+
                       lambda_P4*picvocab_4+
                       lambda_V4*reading_4
               g_eta6 =~ lambda_S6*flanker_6+
                       lambda_R6*pattern_6+ 
                       lambda_M6*picture_6+
                       lambda_P6*picvocab_6+
                       lambda_V6*reading_6
                       
              #latent variable variances # 1*
                      g_etaB~~1*g_etaB
                      g_eta2~~1*g_eta2
                      g_eta4~~1*g_eta4
                      g_eta6~~1*g_eta6
                      
              #latent variable covariances
                      g_etaB~~g_eta2 + g_eta4 + g_eta6
                      g_eta2~~g_eta4 + g_eta6
                      g_eta4~~g_eta6
                      
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Mental flexibility
                      flanker_0~~pattern_0 + pattern_2 + pattern_4 + pattern_6
                      flanker_2~~pattern_2 + pattern_0 + pattern_4 + pattern_6
                      flanker_4~~pattern_4 + pattern_0 + pattern_2 + pattern_6
                      flanker_6~~pattern_6 + pattern_0 + pattern_2 + pattern_4
                      
                      
                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6
                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4
                      
              #latent variable intercepts # 0*1
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S2*1
                      flanker_4~tau_S4*1
                      flanker_6~tau_S6*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R2*1
                      pattern_4~tau_R4*1
                      pattern_6~tau_R6*1
                      picture_0~tau_M*1
                      picture_2~tau_M2*1
                      picture_4~tau_M4*1
                      picture_6~tau_M6*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P2*1
                      picvocab_4~tau_P4*1
                      picvocab_6~tau_P6*1
                      reading_0~tau_V*1
                      reading_2~tau_V2*1
                      reading_4~tau_V4*1
                      reading_6~tau_V6*1'

lavaan(g.4t.config.invar,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("g_4t_config.rds")
```


#### result


```{r}
eigen(inspect(readRDS("g_4t_config.rds"), "cor.lv"))$value

readRDS("g_4t_config.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)
```


### Weak invariance model

#### model fit


```{r}

g.4t.weak.invar <-'#factor loadings # S & S2
               g_etaB =~ lambda_S*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ lambda_S*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ lambda_S*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ lambda_S*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances # 1*
                       g_etaB~~1*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                      
              #latent variable covariances
                      g_etaB~~g_eta2 + g_eta4 + g_eta6
                      g_eta2~~g_eta4 + g_eta6
                      g_eta4~~g_eta6
                      
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Mental flexibility
                      flanker_0~~pattern_0
                      flanker_2~~pattern_2
                      flanker_4~~pattern_4
                      flanker_6~~pattern_6
                      flanker_0~~pattern_2 + pattern_4 + pattern_6
                      flanker_2~~pattern_0 + pattern_4 + pattern_6
                      flanker_4~~pattern_0 + pattern_2 + pattern_6
                      flanker_6~~pattern_0 + pattern_2 + pattern_4
                      
                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6
                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4
                      
              #latent variable intercepts # 0*1
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S2*1
                      flanker_4~tau_S4*1
                      flanker_6~tau_S6*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R2*1
                      pattern_4~tau_R4*1
                      pattern_6~tau_R6*1
                      picture_0~tau_M*1
                      picture_2~tau_M2*1
                      picture_4~tau_M4*1
                      picture_6~tau_M6*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P2*1
                      picvocab_4~tau_P4*1
                      picvocab_6~tau_P6*1
                      reading_0~tau_V*1
                      reading_2~tau_V2*1
                      reading_4~tau_V4*1
                      reading_6~tau_V6*1'

lavaan(g.4t.weak.invar,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("g_4t_weak.rds")
```


#### result


```{r}
eigen(inspect(readRDS("g_4t_weak.rds"), "cor.lv"))$value

readRDS("g_4t_weak.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


#### Compare model


```{r}
anova(
readRDS("g_4t_config.rds"),
readRDS("g_4t_weak.rds")
)

nonnest2::vuongtest(
readRDS("g_4t_config.rds"),
readRDS("g_4t_weak.rds")
)

nonnest2::icci(
readRDS("g_4t_config.rds"),
readRDS("g_4t_weak.rds")
)
```


### Strong invariance model

#### model fit


```{r}

g.4t.strong.invar <-'#factor loadings # S & S2
               g_etaB =~ lambda_S*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ lambda_S*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ lambda_S*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ lambda_S*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances # 1*
                       g_etaB~~1*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
               #latent variable covariances
                      g_etaB~~g_eta2 + g_eta4 + g_eta6
                      g_eta2~~g_eta4 + g_eta6
                      g_eta4~~g_eta6
                      
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6
                      
                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4
                      
              #latent variable intercepts # m*1
                      g_etaB~0*1
                      g_eta2~m2*1
                      g_eta4~m4*1
                      g_eta6~m6*1
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1'

lavaan(g.4t.strong.invar,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("g_4t_strong.rds")
```


#### result


```{r}
eigen(inspect(readRDS("g_4t_strong.rds"), "cor.lv"))$value

readRDS("g_4t_strong.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)
```


### Second order model

#### model fit


```{r}

lg.g.4t.strong.invar <-'#factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6
                      
                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1'

lavaan(lg.g.4t.strong.invar,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_strong.rds")

lavaan(lg.g.4t.strong.invar,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "MLR",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_strongR.rds")
```


#### result


```{r}
eigen(inspect(readRDS("lg_g_4t_strong.rds"), "cor.lv"))$value

readRDS("lg_g_4t_strong.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T) %>% 
  saveRDS("lgcm_g_4t_result.rds")

readRDS("lgcm_g_4t_result.rds")
```


#### model comparison


```{r}

lapply(
  c(
    "g_4t_config_result.rds",
    "g_4t_weak_result.rds",
    "g_4t_strong_result.rds",
    "lgcm_g_4t_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM"), ., row.names = NULL)
```


#### ICC


```{r}
lavPredict(readRDS("lg_g_4t_strong.rds"),
             newdata = g_factor_5task_wide.scaled,
             append.data = T
             ) %>% 
  data.frame() %>%  
  select(contains(c("g_eta"))) %>% 
  ICC(lmer=T) %>% 
  saveRDS("g_4t_icc.rds")

readRDS("g_4t_icc.rds")
```


## Add sex


```{r}

g_factor_5task_wide.scaled.sex %>% select(contains("sex")) %>% freq()

g_factor_5task_wide.scaled.sex <- plyr::join_all(
  list(
    g_factor_5task_wide.scaled,
    sex6 %>%
      select(participant_id, ab_g_stc__cohort_sex) %>%
      drop_na(ab_g_stc__cohort_sex)
  ),
  by = c("participant_id"), type = "left"
) %>%
  mutate(dummy_sex = 2-ab_g_stc__cohort_sex)

# check duplicate
g_factor_5task_wide.scaled.sex %>% 
  select(participant_id,dummy_sex) %>% 
  group_by(dummy_sex) %>% 
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id)))

# n = 11865
```


### Add sex as covariate at latent variable

#### model fit


```{r}
lg.g.4t.sex.strong.invar <- lg.g.4t.strong.invar %>% 
  str_replace_all(c("g_i~1" = "g_i~1 + dummy_sex",
                    "g_s~1" = "g_s~1 + dummy_sex"))

lavaan(lg.g.4t.sex.strong.invar,
       data = g_factor_5task_wide.scaled.sex,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = T,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_sex_model.rds")
```


#### result


```{r}
eigen(inspect(readRDS("lg_g_4t_sex_model.rds"), "cor.lv"))$value

readRDS("lg_g_4t_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)
```


### Second order model 2

#### model fit


```{r}

lg.g.4t.strong.invar2 <-'#factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Mental flexibility
                      flanker_0~~pattern_0 
                      flanker_2~~pattern_2 
                      flanker_4~~pattern_4 
                      flanker_6~~pattern_6 
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1'

lavaan(lg.g.4t.strong.invar2,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_strong2.rds")
```


#### result


```{r}
eigen(inspect(readRDS("lg_g_4t_strong2.rds"), "cor.lv"))$value

readRDS("lg_g_4t_strong2.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)

# Covar: Metal Flexibilty within time points & Language across time points 
# Robust Comparative Fit Index (CFI)             0.942
# Robust Tucker-Lewis Index (TLI)                0.923

# Robust RMSEA                                   0.066
# 90 Percent confidence interval - lower         0.064
# 90 Percent confidence interval - upper         0.068
# P-value H_0: Robust RMSEA <= 0.050             0.000
# P-value H_0: Robust RMSEA >= 0.080             0.000

# SRMR                                           0.085
```


### Second order model 2.1 (5 tasks with q)

#### model fit


```{r}

lg.g.4t.strong.invar2.1 <-'#factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Mental flexibility
                      flanker_0~~pattern_0 
                      flanker_2~~pattern_2 
                      flanker_4~~pattern_4 
                      flanker_6~~pattern_6 
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      g_q =~    0*g_etaB + 1*g_eta2 + 4*g_eta4 + 9*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      g_q~~NA*g_q
                      
                      g_i~~g_s + g_q
                      g_s~~g_q
                      
                      g_i~1
                      g_s~1
                      g_q~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1'

lavaan(lg.g.4t.strong.invar2.1,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_strong2_1.rds")
```


#### result


```{r}
eigen(inspect(readRDS("lg_g_4t_strong2_1.rds"), "cor.lv"))$value

readRDS("lg_g_4t_strong2_1.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)
```


### Second order model 3

#### model fit


```{r}

lg.g.4t.strong.invar3 <-'#factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1'

lavaan(lg.g.4t.strong.invar3,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_strong3.rds")
```


#### result


```{r}
eigen(inspect(readRDS("lg_g_4t_strong3.rds"), "cor.lv"))$value

readRDS("lg_g_4t_strong3.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)

# Covar: Metal Flexibilty within time points & Language across time points 
# Robust Comparative Fit Index (CFI)             0.935
# Robust Tucker-Lewis Index (TLI)                0.903

# Robust RMSEA                                   0.089
# 90 Percent confidence interval - lower         0.086
# 90 Percent confidence interval - upper         0.091
# P-value H_0: Robust RMSEA <= 0.050             0.000
# P-value H_0: Robust RMSEA >= 0.080             0.000

# SRMR                                           0.069

lg.g.4t.sex.strong.invar3 <- lg.g.4t.strong.invar3 %>% 
  str_replace_all(c("g_i~1" = "g_i~1 + dummy_sex",
                    "g_s~1" = "g_s~1 + dummy_sex"))

lavaan(lg.g.4t.sex.strong.invar3,
       data = g_factor_5task_wide.scaled.sex,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = T,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_sex_model3.rds")

readRDS("lg_g_4t_sex_model3.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)
```


### Second order model 4 (4 tasks with q)

#### model fit


```{r}

lg.g.4t.strong.invar4 <-'#factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      g_q =~    0*g_etaB + 1*g_eta2 + 4*g_eta4 + 9*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      g_q~~NA*g_q
                      
                      g_i~~g_s + g_q
                      g_s~~g_q
                      
                      g_i~1
                      g_s~1
                      g_q~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1'

lavaan(lg.g.4t.strong.invar4,
       data = g_factor_5task_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lg_g_4t_strong4.rds")
```


#### result


```{r}
eigen(inspect(readRDS("lg_g_4t_strong4.rds"), "cor.lv"))$value

readRDS("lg_g_4t_strong4.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T)
```


## pc factor

### Configural invariance model

#### model fit


```{r}

pc.7t.config.invar <-'#factor loadings (with constraints)
               p_etaB =~ lambda_X0*anxdep_comp_0+
                         lambda_W0*withdep_comp_0+ 
                         lambda_S0*soma_comp_0+
                         lambda_C0*socprob_comp_0+
                         lambda_H0*thouprob_comp_0+
                         lambda_A0*attprob_comp_0+
                         lambda_R0*rulebreak_comp_0+
                         lambda_G0*aggress_comp_0
                         
               p_eta1 =~ lambda_X1*anxdep_comp_1+
                         lambda_W1*withdep_comp_1+ 
                         lambda_S1*soma_comp_1+
                         lambda_C1*socprob_comp_1+
                         lambda_H1*thouprob_comp_1+
                         lambda_A1*attprob_comp_1+
                         lambda_R1*rulebreak_comp_1+
                         lambda_G1*aggress_comp_1
                         
               p_eta2 =~ lambda_X2*anxdep_comp_2+
                         lambda_W2*withdep_comp_2+ 
                         lambda_S2*soma_comp_2+
                         lambda_C2*socprob_comp_2+
                         lambda_H2*thouprob_comp_2+
                         lambda_A2*attprob_comp_2+
                         lambda_R2*rulebreak_comp_2+
                         lambda_G2*aggress_comp_2
                         
               p_eta3 =~ lambda_X3*anxdep_comp_3+
                         lambda_W3*withdep_comp_3+ 
                         lambda_S3*soma_comp_3+
                         lambda_C3*socprob_comp_3+
                         lambda_H3*thouprob_comp_3+
                         lambda_A3*attprob_comp_3+
                         lambda_R3*rulebreak_comp_3+
                         lambda_G3*aggress_comp_3
                         
               p_eta4 =~ lambda_X4*anxdep_comp_4+
                         lambda_W4*withdep_comp_4+ 
                         lambda_S4*soma_comp_4+
                         lambda_C4*socprob_comp_4+
                         lambda_H4*thouprob_comp_4+
                         lambda_A4*attprob_comp_4+
                         lambda_R4*rulebreak_comp_4+
                         lambda_G4*aggress_comp_4
                         
               p_eta5 =~ lambda_X5*anxdep_comp_5+
                         lambda_W5*withdep_comp_5+ 
                         lambda_S5*soma_comp_5+
                         lambda_C5*socprob_comp_5+
                         lambda_H5*thouprob_comp_5+
                         lambda_A5*attprob_comp_5+
                         lambda_R5*rulebreak_comp_5+
                         lambda_G5*aggress_comp_5
                         
               p_eta6 =~ lambda_X6*anxdep_comp_6+
                         lambda_W6*withdep_comp_6+ 
                         lambda_S6*soma_comp_6+
                         lambda_C6*socprob_comp_6+
                         lambda_H6*thouprob_comp_6+
                         lambda_A6*attprob_comp_6+
                         lambda_R6*rulebreak_comp_6+
                         lambda_G6*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~1*p_etaB
                      p_eta1~~1*p_eta1
                      p_eta2~~1*p_eta2
                      p_eta3~~1*p_eta3
                      p_eta4~~1*p_eta4
                      p_eta5~~1*p_eta5
                      p_eta6~~1*p_eta6
              
              #latent variable covariances
                      p_etaB~~p_eta1 + p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta1~~p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta2~~p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta3~~p_eta4 + p_eta5 + p_eta6
                      p_eta4~~p_eta5 + p_eta6
                      p_eta5~~p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
                      #latent variable intercepts
                      p_etaB~0*1
                      p_eta1~0*1
                      p_eta2~0*1
                      p_eta3~0*1
                      p_eta4~0*1
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_X0*1
                      anxdep_comp_1~tau_X1*1
                      anxdep_comp_2~tau_X2*1
                      anxdep_comp_3~tau_X3*1
                      anxdep_comp_4~tau_X4*1
                      anxdep_comp_5~tau_X5*1
                      anxdep_comp_6~tau_X6*1
                      withdep_comp_0~tau_W0*1
                      withdep_comp_1~tau_W1*1
                      withdep_comp_2~tau_W2*1
                      withdep_comp_3~tau_W3*1
                      withdep_comp_4~tau_W4*1
                      withdep_comp_5~tau_W5*1
                      withdep_comp_6~tau_W6*1
                      soma_comp_0~tau_S0*1
                      soma_comp_1~tau_S1*1
                      soma_comp_2~tau_S2*1
                      soma_comp_3~tau_S3*1
                      soma_comp_4~tau_S4*1
                      soma_comp_5~tau_S5*1
                      soma_comp_6~tau_S6*1
                      socprob_comp_0~tau_P0*1
                      socprob_comp_1~tau_P1*1
                      socprob_comp_2~tau_P2*1
                      socprob_comp_3~tau_P3*1
                      socprob_comp_4~tau_P4*1
                      socprob_comp_5~tau_P5*1
                      socprob_comp_6~tau_P6*1
                      thouprob_comp_0~tau_H0*1
                      thouprob_comp_1~tau_H1*1
                      thouprob_comp_2~tau_H2*1
                      thouprob_comp_3~tau_H3*1
                      thouprob_comp_4~tau_H4*1
                      thouprob_comp_5~tau_H5*1
                      thouprob_comp_6~tau_H6*1
                      attprob_comp_0~tau_A0*1
                      attprob_comp_1~tau_A1*1
                      attprob_comp_2~tau_A2*1
                      attprob_comp_3~tau_A3*1
                      attprob_comp_4~tau_A4*1
                      attprob_comp_5~tau_A5*1
                      attprob_comp_6~tau_A6*1
                      rulebreak_comp_0~tau_R0*1
                      rulebreak_comp_1~tau_R1*1
                      rulebreak_comp_2~tau_R2*1
                      rulebreak_comp_3~tau_R3*1
                      rulebreak_comp_4~tau_R4*1
                      rulebreak_comp_5~tau_R5*1
                      rulebreak_comp_6~tau_R6*1
                      aggress_comp_0~tau_G0*1
                      aggress_comp_1~tau_G1*1
                      aggress_comp_2~tau_G2*1
                      aggress_comp_3~tau_G3*1
                      aggress_comp_4~tau_G4*1
                      aggress_comp_5~tau_G5*1
                      aggress_comp_6~tau_G6*1'

lavaan(pc.7t.config.invar,
       data = pc_factor_nolow_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("pc_7t_config.rds")
```


#### result


```{r}

eigen(inspect(readRDS("pc_7t_config.rds"), "cor.lv"))$value

readRDS("pc_7t_config.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


### Weak invariance model

#### model fit


```{r}

pc.7t.weak.invar <-'#factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                         lambda_W*withdep_comp_0+ 
                         lambda_S*soma_comp_0+
                         lambda_C*socprob_comp_0+
                         lambda_H*thouprob_comp_0+
                         lambda_A*attprob_comp_0+
                         lambda_R*rulebreak_comp_0+
                         lambda_G*aggress_comp_0
                         
               p_eta1 =~ 1*anxdep_comp_1+
                         lambda_W*withdep_comp_1+ 
                         lambda_S*soma_comp_1+
                         lambda_C*socprob_comp_1+
                         lambda_H*thouprob_comp_1+
                         lambda_A*attprob_comp_1+
                         lambda_R*rulebreak_comp_1+
                         lambda_G*aggress_comp_1
                         
               p_eta2 =~ 1*anxdep_comp_2+
                         lambda_W*withdep_comp_2+ 
                         lambda_S*soma_comp_2+
                         lambda_C*socprob_comp_2+
                         lambda_H*thouprob_comp_2+
                         lambda_A*attprob_comp_2+
                         lambda_R*rulebreak_comp_2+
                         lambda_G*aggress_comp_2
                         
               p_eta3 =~ 1*anxdep_comp_3+
                         lambda_W*withdep_comp_3+ 
                         lambda_S*soma_comp_3+
                         lambda_C*socprob_comp_3+
                         lambda_H*thouprob_comp_3+
                         lambda_A*attprob_comp_3+
                         lambda_R*rulebreak_comp_3+
                         lambda_G*aggress_comp_3
                         
               p_eta4 =~ 1*anxdep_comp_4+
                         lambda_W*withdep_comp_4+ 
                         lambda_S*soma_comp_4+
                         lambda_C*socprob_comp_4+
                         lambda_H*thouprob_comp_4+
                         lambda_A*attprob_comp_4+
                         lambda_R*rulebreak_comp_4+
                         lambda_G*aggress_comp_4
                         
               p_eta5 =~ 1*anxdep_comp_5+
                         lambda_W*withdep_comp_5+ 
                         lambda_S*soma_comp_5+
                         lambda_C*socprob_comp_5+
                         lambda_H*thouprob_comp_5+
                         lambda_A*attprob_comp_5+
                         lambda_R*rulebreak_comp_5+
                         lambda_G*aggress_comp_5
                         
               p_eta6 =~ 1*anxdep_comp_6+
                         lambda_W*withdep_comp_6+ 
                         lambda_S*soma_comp_6+
                         lambda_C*socprob_comp_6+
                         lambda_H*thouprob_comp_6+
                         lambda_A*attprob_comp_6+
                         lambda_R*rulebreak_comp_6+
                         lambda_G*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #latent variable covariances
                      p_etaB~~p_eta1 + p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta1~~p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta2~~p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta3~~p_eta4 + p_eta5 + p_eta6
                      p_eta4~~p_eta5 + p_eta6
                      p_eta5~~p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
                      #latent variable intercepts
                      p_etaB~0*1
                      p_eta1~0*1
                      p_eta2~0*1
                      p_eta3~0*1
                      p_eta4~0*1
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_X0*1
                      anxdep_comp_1~tau_X1*1
                      anxdep_comp_2~tau_X2*1
                      anxdep_comp_3~tau_X3*1
                      anxdep_comp_4~tau_X4*1
                      anxdep_comp_5~tau_X5*1
                      anxdep_comp_6~tau_X6*1
                      withdep_comp_0~tau_W0*1
                      withdep_comp_1~tau_W1*1
                      withdep_comp_2~tau_W2*1
                      withdep_comp_3~tau_W3*1
                      withdep_comp_4~tau_W4*1
                      withdep_comp_5~tau_W5*1
                      withdep_comp_6~tau_W6*1
                      soma_comp_0~tau_S0*1
                      soma_comp_1~tau_S1*1
                      soma_comp_2~tau_S2*1
                      soma_comp_3~tau_S3*1
                      soma_comp_4~tau_S4*1
                      soma_comp_5~tau_S5*1
                      soma_comp_6~tau_S6*1
                      socprob_comp_0~tau_P0*1
                      socprob_comp_1~tau_P1*1
                      socprob_comp_2~tau_P2*1
                      socprob_comp_3~tau_P3*1
                      socprob_comp_4~tau_P4*1
                      socprob_comp_5~tau_P5*1
                      socprob_comp_6~tau_P6*1
                      thouprob_comp_0~tau_H0*1
                      thouprob_comp_1~tau_H1*1
                      thouprob_comp_2~tau_H2*1
                      thouprob_comp_3~tau_H3*1
                      thouprob_comp_4~tau_H4*1
                      thouprob_comp_5~tau_H5*1
                      thouprob_comp_6~tau_H6*1
                      attprob_comp_0~tau_A0*1
                      attprob_comp_1~tau_A1*1
                      attprob_comp_2~tau_A2*1
                      attprob_comp_3~tau_A3*1
                      attprob_comp_4~tau_A4*1
                      attprob_comp_5~tau_A5*1
                      attprob_comp_6~tau_A6*1
                      rulebreak_comp_0~tau_R0*1
                      rulebreak_comp_1~tau_R1*1
                      rulebreak_comp_2~tau_R2*1
                      rulebreak_comp_3~tau_R3*1
                      rulebreak_comp_4~tau_R4*1
                      rulebreak_comp_5~tau_R5*1
                      rulebreak_comp_6~tau_R6*1
                      aggress_comp_0~tau_G0*1
                      aggress_comp_1~tau_G1*1
                      aggress_comp_2~tau_G2*1
                      aggress_comp_3~tau_G3*1
                      aggress_comp_4~tau_G4*1
                      aggress_comp_5~tau_G5*1
                      aggress_comp_6~tau_G6*1'

lavaan(pc.7t.weak.invar,
       data = pc_factor_nolow_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("pc_7t_weak.rds")
```


#### result


```{r}

eigen(inspect(readRDS("pc_7t_weak.rds"), "cor.lv"))$value

readRDS("pc_7t_weak.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


### Strong invariance model

#### model fit


```{r}

pc.7t.strong.invar <-'#factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                         lambda_W*withdep_comp_0+ 
                         lambda_S*soma_comp_0+
                         lambda_C*socprob_comp_0+
                         lambda_H*thouprob_comp_0+
                         lambda_A*attprob_comp_0+
                         lambda_R*rulebreak_comp_0+
                         lambda_G*aggress_comp_0
                         
               p_eta1 =~ 1*anxdep_comp_1+
                         lambda_W*withdep_comp_1+ 
                         lambda_S*soma_comp_1+
                         lambda_C*socprob_comp_1+
                         lambda_H*thouprob_comp_1+
                         lambda_A*attprob_comp_1+
                         lambda_R*rulebreak_comp_1+
                         lambda_G*aggress_comp_1
                         
               p_eta2 =~ 1*anxdep_comp_2+
                         lambda_W*withdep_comp_2+ 
                         lambda_S*soma_comp_2+
                         lambda_C*socprob_comp_2+
                         lambda_H*thouprob_comp_2+
                         lambda_A*attprob_comp_2+
                         lambda_R*rulebreak_comp_2+
                         lambda_G*aggress_comp_2
                         
               p_eta3 =~ 1*anxdep_comp_3+
                         lambda_W*withdep_comp_3+ 
                         lambda_S*soma_comp_3+
                         lambda_C*socprob_comp_3+
                         lambda_H*thouprob_comp_3+
                         lambda_A*attprob_comp_3+
                         lambda_R*rulebreak_comp_3+
                         lambda_G*aggress_comp_3
                         
               p_eta4 =~ 1*anxdep_comp_4+
                         lambda_W*withdep_comp_4+ 
                         lambda_S*soma_comp_4+
                         lambda_C*socprob_comp_4+
                         lambda_H*thouprob_comp_4+
                         lambda_A*attprob_comp_4+
                         lambda_R*rulebreak_comp_4+
                         lambda_G*aggress_comp_4
                         
               p_eta5 =~ 1*anxdep_comp_5+
                         lambda_W*withdep_comp_5+ 
                         lambda_S*soma_comp_5+
                         lambda_C*socprob_comp_5+
                         lambda_H*thouprob_comp_5+
                         lambda_A*attprob_comp_5+
                         lambda_R*rulebreak_comp_5+
                         lambda_G*aggress_comp_5
                         
               p_eta6 =~ 1*anxdep_comp_6+
                         lambda_W*withdep_comp_6+ 
                         lambda_S*soma_comp_6+
                         lambda_C*socprob_comp_6+
                         lambda_H*thouprob_comp_6+
                         lambda_A*attprob_comp_6+
                         lambda_R*rulebreak_comp_6+
                         lambda_G*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #latent variable covariances
                      p_etaB~~p_eta1 + p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta1~~p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta2~~p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta3~~p_eta4 + p_eta5 + p_eta6
                      p_eta4~~p_eta5 + p_eta6
                      p_eta5~~p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
                      #latent variable intercepts
                      p_etaB~0*1
                      p_eta1~m1*1
                      p_eta2~m2*1
                      p_eta3~m3*1
                      p_eta4~m4*1
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_X*1
                      anxdep_comp_1~tau_X*1
                      anxdep_comp_2~tau_X*1
                      anxdep_comp_3~tau_X*1
                      anxdep_comp_4~tau_X*1
                      anxdep_comp_5~tau_X*1
                      anxdep_comp_6~tau_X*1
                      withdep_comp_0~tau_W*1
                      withdep_comp_1~tau_W*1
                      withdep_comp_2~tau_W*1
                      withdep_comp_3~tau_W*1
                      withdep_comp_4~tau_W*1
                      withdep_comp_5~tau_W*1
                      withdep_comp_6~tau_W*1
                      soma_comp_0~tau_S*1
                      soma_comp_1~tau_S*1
                      soma_comp_2~tau_S*1
                      soma_comp_3~tau_S*1
                      soma_comp_4~tau_S*1
                      soma_comp_5~tau_S*1
                      soma_comp_6~tau_S*1
                      socprob_comp_0~tau_P*1
                      socprob_comp_1~tau_P*1
                      socprob_comp_2~tau_P*1
                      socprob_comp_3~tau_P*1
                      socprob_comp_4~tau_P*1
                      socprob_comp_5~tau_P*1
                      socprob_comp_6~tau_P*1
                      thouprob_comp_0~tau_H*1
                      thouprob_comp_1~tau_H*1
                      thouprob_comp_2~tau_H*1
                      thouprob_comp_3~tau_H*1
                      thouprob_comp_4~tau_H*1
                      thouprob_comp_5~tau_H*1
                      thouprob_comp_6~tau_H*1
                      attprob_comp_0~tau_A*1
                      attprob_comp_1~tau_A*1
                      attprob_comp_2~tau_A*1
                      attprob_comp_3~tau_A*1
                      attprob_comp_4~tau_A*1
                      attprob_comp_5~tau_A*1
                      attprob_comp_6~tau_A*1
                      rulebreak_comp_0~tau_R*1
                      rulebreak_comp_1~tau_R*1
                      rulebreak_comp_2~tau_R*1
                      rulebreak_comp_3~tau_R*1
                      rulebreak_comp_4~tau_R*1
                      rulebreak_comp_5~tau_R*1
                      rulebreak_comp_6~tau_R*1
                      aggress_comp_0~tau_G*1
                      aggress_comp_1~tau_G*1
                      aggress_comp_2~tau_G*1
                      aggress_comp_3~tau_G*1
                      aggress_comp_4~tau_G*1
                      aggress_comp_5~tau_G*1
                      aggress_comp_6~tau_G*1'

lavaan(pc.7t.strong.invar,
       data = pc_factor_nolow_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("pc_7t_strong.rds")
```


#### result


```{r}

eigen(inspect(readRDS("pc_7t_strong.rds"), "cor.lv"))$value

readRDS("pc_7t_strong.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


### Second order model

#### model fit


```{r}

lg.pc.7t.strong.invar <-'#factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_W*withdep_comp_0+ 
                       lambda_S*soma_comp_0+
                       lambda_C*socprob_comp_0+
                       lambda_H*thouprob_comp_0+
                       lambda_A*attprob_comp_0+
                       lambda_R*rulebreak_comp_0+
                       lambda_G*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_W*withdep_comp_1+ 
                       lambda_S*soma_comp_1+
                       lambda_C*socprob_comp_1+
                       lambda_H*thouprob_comp_1+
                       lambda_A*attprob_comp_1+
                       lambda_R*rulebreak_comp_1+
                       lambda_G*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_W*withdep_comp_2+ 
                       lambda_S*soma_comp_2+
                       lambda_C*socprob_comp_2+
                       lambda_H*thouprob_comp_2+
                       lambda_A*attprob_comp_2+
                       lambda_R*rulebreak_comp_2+
                       lambda_G*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_W*withdep_comp_3+ 
                       lambda_S*soma_comp_3+
                       lambda_C*socprob_comp_3+
                       lambda_H*thouprob_comp_3+
                       lambda_A*attprob_comp_3+
                       lambda_R*rulebreak_comp_3+
                       lambda_G*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_W*withdep_comp_4+ 
                       lambda_S*soma_comp_4+
                       lambda_C*socprob_comp_4+
                       lambda_H*thouprob_comp_4+
                       lambda_A*attprob_comp_4+
                       lambda_R*rulebreak_comp_4+
                       lambda_G*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_W*withdep_comp_5+ 
                       lambda_S*soma_comp_5+
                       lambda_C*socprob_comp_5+
                       lambda_H*thouprob_comp_5+
                       lambda_A*attprob_comp_5+
                       lambda_R*rulebreak_comp_5+
                       lambda_G*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_W*withdep_comp_6+ 
                       lambda_S*soma_comp_6+
                       lambda_C*socprob_comp_6+
                       lambda_H*thouprob_comp_6+
                       lambda_A*attprob_comp_6+
                       lambda_R*rulebreak_comp_6+
                       lambda_G*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_X*1
                      anxdep_comp_1~tau_X*1
                      anxdep_comp_2~tau_X*1
                      anxdep_comp_3~tau_X*1
                      anxdep_comp_4~tau_X*1
                      anxdep_comp_5~tau_X*1
                      anxdep_comp_6~tau_X*1
                      withdep_comp_0~tau_W*1
                      withdep_comp_1~tau_W*1
                      withdep_comp_2~tau_W*1
                      withdep_comp_3~tau_W*1
                      withdep_comp_4~tau_W*1
                      withdep_comp_5~tau_W*1
                      withdep_comp_6~tau_W*1
                      soma_comp_0~tau_S*1
                      soma_comp_1~tau_S*1
                      soma_comp_2~tau_S*1
                      soma_comp_3~tau_S*1
                      soma_comp_4~tau_S*1
                      soma_comp_5~tau_S*1
                      soma_comp_6~tau_S*1
                      socprob_comp_0~tau_P*1
                      socprob_comp_1~tau_P*1
                      socprob_comp_2~tau_P*1
                      socprob_comp_3~tau_P*1
                      socprob_comp_4~tau_P*1
                      socprob_comp_5~tau_P*1
                      socprob_comp_6~tau_P*1
                      thouprob_comp_0~tau_H*1
                      thouprob_comp_1~tau_H*1
                      thouprob_comp_2~tau_H*1
                      thouprob_comp_3~tau_H*1
                      thouprob_comp_4~tau_H*1
                      thouprob_comp_5~tau_H*1
                      thouprob_comp_6~tau_H*1
                      attprob_comp_0~tau_A*1
                      attprob_comp_1~tau_A*1
                      attprob_comp_2~tau_A*1
                      attprob_comp_3~tau_A*1
                      attprob_comp_4~tau_A*1
                      attprob_comp_5~tau_A*1
                      attprob_comp_6~tau_A*1
                      rulebreak_comp_0~tau_R*1
                      rulebreak_comp_1~tau_R*1
                      rulebreak_comp_2~tau_R*1
                      rulebreak_comp_3~tau_R*1
                      rulebreak_comp_4~tau_R*1
                      rulebreak_comp_5~tau_R*1
                      rulebreak_comp_6~tau_R*1
                      aggress_comp_0~tau_G*1
                      aggress_comp_1~tau_G*1
                      aggress_comp_2~tau_G*1
                      aggress_comp_3~tau_G*1
                      aggress_comp_4~tau_G*1
                      aggress_comp_5~tau_G*1
                      aggress_comp_6~tau_G*1
                      
                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      p_etaB ~ 0*1  
                      p_eta1 ~ 0*1                   
                      p_eta2 ~ 0*1                   
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1'

lavaan(lg.pc.7t.strong.invar,
       data = pc_factor_nolow_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lgcm_pc_7t_model.rds")
```


#### result


```{r}

eigen(inspect(readRDS("lgcm_pc_7t_model.rds"), "cor.lv"))$value

readRDS("lgcm_pc_7t_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("lgcm_pc_7t_result.rds")

readRDS("lgcm_pc_7t_result.rds")
```


#### model comparison


```{r}
lapply(
  c(
    "pc_7t_config_result.rds",
    "pc_7t_weak_result.rds",
    "pc_7t_strong_result.rds",
    "lgcm_pc_7t_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM"), ., row.names = NULL)
```


#### ICC


```{r}
lavPredict(readRDS("lgcm_pc_7t_model.rds"),
             newdata = pc_factor_nolow_wide.scaled,
             append.data = T
             ) %>% 
  data.frame() %>%  
  select(contains(c("p_eta"))) %>% 
  ICC(lmer=T) %>% 
  saveRDS("pc_7t_icc.rds")

readRDS("pc_7t_icc.rds")
```


#### pc factor symptom model

##### Externalizing model


```{r}

lg.ext6.strong.invar <-'# basis model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6
                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1'

lavaan(lg.ext6.strong.invar,
       data = pc_factor_nolow_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lgcm_Ext_7t_model.rds")
```


###### result


```{r}

eigen(inspect(readRDS("lgcm_Ext_7t_model.rds"), "cor.lv"))$value

readRDS("lgcm_Ext_7t_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("lgcm_Ext_7t_result.rds")

readRDS("lgcm_Ext_7t_result.rds")
```


###### ICC


```{r}
lavPredict(readRDS("lgcm_Ext_7t_model.rds"),
             newdata = pc_factor_nolow_wide.scaled,
             append.data = T
             ) %>% 
  data.frame() %>%  
  select(contains(c("Ext_comp_"))) %>% 
  ICC(lmer=T) %>% 
  saveRDS("Ext_pc_7t_icc.rds")

readRDS("Ext_pc_7t_icc.rds")
```


##### Internalizing model


```{r}
lg.int6.strong.invar <-'# basis model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1'

lavaan(lg.int6.strong.invar,
       data = pc_factor_nolow_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lgcm_Int_7t_model.rds")
```


###### result


```{r}

eigen(inspect(readRDS("lgcm_Int_7t_model.rds"), "cor.lv"))$value

readRDS("lgcm_Int_7t_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("lgcm_Int_7t_result.rds")

readRDS("lgcm_Int_7t_result.rds")
```


###### ICC


```{r}
lavPredict(readRDS("lgcm_Int_7t_model.rds"),
             newdata = pc_factor_nolow_wide.scaled,
             append.data = T
             ) %>% 
  data.frame() %>%  
  select(contains(c("Int_comp_"))) %>% 
  ICC(lmer=T) %>% 
  saveRDS("Int_pc_7t_icc.rds")

readRDS("Int_pc_7t_icc.rds")
```


## pp factor

### Configural invariance model

#### model fit


```{r}

pp.3t.config.invar <-'#factor loadings (with constraints)
               a_etaB =~ lambda_AD0*asr_anxdep_comp_0+
                         lambda_AW0*asr_withdep_comp_0+ 
                         lambda_AS0*asr_soma_comp_0+
                         lambda_AC0*asr_thouprob_comp_0+
                         lambda_AH0*asr_attprob_comp_0+
                         lambda_AA0*asr_rulebreak_comp_0+
                         lambda_AR0*asr_aggress_comp_0+
                         lambda_AG0*asr_intru_comp_0
               a_eta2 =~ lambda_AD2*asr_anxdep_comp_2+
                         lambda_AW2*asr_withdep_comp_2+ 
                         lambda_AS2*asr_soma_comp_2+
                         lambda_AC2*asr_thouprob_comp_2+
                         lambda_AH2*asr_attprob_comp_2+
                         lambda_AA2*asr_rulebreak_comp_2+
                         lambda_AR2*asr_aggress_comp_2+
                         lambda_AG2*asr_intru_comp_2
               a_eta4 =~ lambda_AD4*asr_anxdep_comp_4+
                         lambda_AW4*asr_withdep_comp_4+ 
                         lambda_AS4*asr_soma_comp_4+
                         lambda_AC4*asr_thouprob_comp_4+
                         lambda_AH4*asr_attprob_comp_4+
                         lambda_AA4*asr_rulebreak_comp_4+
                         lambda_AR4*asr_aggress_comp_4+
                         lambda_AG4*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~1*a_etaB
                      a_eta2~~1*a_eta2
                      a_eta4~~1*a_eta4
                      
              #latent variable covariances
                      a_etaB~~a_eta2 + a_eta4
                      a_eta2~~a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
                      #latent variable intercepts
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
              #observed variable intercepts
                      asr_aggress_comp_0~tau_AR0*1
                      asr_aggress_comp_2~tau_AR2*1
                      asr_aggress_comp_4~tau_AR4*1
                      
                      asr_anxdep_comp_0~tau_AX0*1
                      asr_anxdep_comp_2~tau_AX2*1
                      asr_anxdep_comp_4~tau_AX4*1
                      
                      asr_attprob_comp_0~tau_AH0*1
                      asr_attprob_comp_2~tau_AH2*1
                      asr_attprob_comp_4~tau_AH4*1
                      
                      asr_intru_comp_0~tau_AG0*1
                      asr_intru_comp_2~tau_AG2*1
                      asr_intru_comp_4~tau_AG4*1
                      
                      asr_rulebreak_comp_0~tau_AA0*1
                      asr_rulebreak_comp_2~tau_AA2*1
                      asr_rulebreak_comp_4~tau_AA4*1
                      
                      asr_soma_comp_0~tau_AS0*1
                      asr_soma_comp_2~tau_AS2*1
                      asr_soma_comp_4~tau_AS4*1
                      
                      asr_thouprob_comp_0~tau_AP0*1
                      asr_thouprob_comp_2~tau_AP2*1
                      asr_thouprob_comp_4~tau_AP4*1
                      
                      asr_withdep_comp_0~tau_AW0*1
                      asr_withdep_comp_2~tau_AW2*1
                      asr_withdep_comp_4~tau_AW4*1'

lavaan(pp.3t.config.invar,
       data = pp_factor_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("pp_3t_config.rds")
```


#### result


```{r}

eigen(inspect(readRDS("pp_3t_config.rds"), "cor.lv"))$value

readRDS("pp_3t_config.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


### Weak invariance model

#### model fit


```{r}

pp.3t.weak.invar <-'#factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                         lambda_AW*asr_withdep_comp_0+ 
                         lambda_AS*asr_soma_comp_0+
                         lambda_AC*asr_thouprob_comp_0+
                         lambda_AH*asr_attprob_comp_0+
                         lambda_AA*asr_rulebreak_comp_0+
                         lambda_AR*asr_aggress_comp_0+
                         lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                         lambda_AW*asr_withdep_comp_2+ 
                         lambda_AS*asr_soma_comp_2+
                         lambda_AC*asr_thouprob_comp_2+
                         lambda_AH*asr_attprob_comp_2+
                         lambda_AA*asr_rulebreak_comp_2+
                         lambda_AR*asr_aggress_comp_2+
                         lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                         lambda_AW*asr_withdep_comp_4+ 
                         lambda_AS*asr_soma_comp_4+
                         lambda_AC*asr_thouprob_comp_4+
                         lambda_AH*asr_attprob_comp_4+
                         lambda_AA*asr_rulebreak_comp_4+
                         lambda_AR*asr_aggress_comp_4+
                         lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
                      
              #latent variable covariances
                      a_etaB~~a_eta2 + a_eta4
                      a_eta2~~a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
                      #latent variable intercepts
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
              #observed variable intercepts
                      asr_aggress_comp_0~tau_AR0*1
                      asr_aggress_comp_2~tau_AR2*1
                      asr_aggress_comp_4~tau_AR4*1
                      
                      asr_anxdep_comp_0~tau_AX0*1
                      asr_anxdep_comp_2~tau_AX2*1
                      asr_anxdep_comp_4~tau_AX4*1
                      
                      asr_attprob_comp_0~tau_AH0*1
                      asr_attprob_comp_2~tau_AH2*1
                      asr_attprob_comp_4~tau_AH4*1
                      
                      asr_intru_comp_0~tau_AG0*1
                      asr_intru_comp_2~tau_AG2*1
                      asr_intru_comp_4~tau_AG4*1
                      
                      asr_rulebreak_comp_0~tau_AA0*1
                      asr_rulebreak_comp_2~tau_AA2*1
                      asr_rulebreak_comp_4~tau_AA4*1
                      
                      asr_soma_comp_0~tau_AS0*1
                      asr_soma_comp_2~tau_AS2*1
                      asr_soma_comp_4~tau_AS4*1
                      
                      asr_thouprob_comp_0~tau_AP0*1
                      asr_thouprob_comp_2~tau_AP2*1
                      asr_thouprob_comp_4~tau_AP4*1
                      
                      asr_withdep_comp_0~tau_AW0*1
                      asr_withdep_comp_2~tau_AW2*1
                      asr_withdep_comp_4~tau_AW4*1'

lavaan(pp.3t.weak.invar,
       data = pp_factor_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("pp_3t_weak.rds")
```


#### result


```{r}

eigen(inspect(readRDS("pp_3t_weak.rds"), "cor.lv"))$value

readRDS("pp_3t_weak.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


### Strong invariance model

#### model fit


```{r}

pp.3t.strong.invar <-'#factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                         lambda_AW*asr_withdep_comp_0+ 
                         lambda_AS*asr_soma_comp_0+
                         lambda_AC*asr_thouprob_comp_0+
                         lambda_AH*asr_attprob_comp_0+
                         lambda_AA*asr_rulebreak_comp_0+
                         lambda_AR*asr_aggress_comp_0+
                         lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                         lambda_AW*asr_withdep_comp_2+ 
                         lambda_AS*asr_soma_comp_2+
                         lambda_AC*asr_thouprob_comp_2+
                         lambda_AH*asr_attprob_comp_2+
                         lambda_AA*asr_rulebreak_comp_2+
                         lambda_AR*asr_aggress_comp_2+
                         lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                         lambda_AW*asr_withdep_comp_4+ 
                         lambda_AS*asr_soma_comp_4+
                         lambda_AC*asr_thouprob_comp_4+
                         lambda_AH*asr_attprob_comp_4+
                         lambda_AA*asr_rulebreak_comp_4+
                         lambda_AR*asr_aggress_comp_4+
                         lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
                      
              #latent variable covariances
                      a_etaB~~a_eta2 + a_eta4
                      a_eta2~~a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
                      #latent variable intercepts
                      a_etaB~0*1
                      a_eta2~m2*1
                      a_eta4~m4*1
                      
              #observed variable intercepts
                      asr_aggress_comp_0~tau_AR*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_aggress_comp_4~tau_AR*1
                      
                      asr_anxdep_comp_0~tau_AX*1
                      asr_anxdep_comp_2~tau_AX*1
                      asr_anxdep_comp_4~tau_AX*1
                      
                      asr_attprob_comp_0~tau_AH*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_attprob_comp_4~tau_AH*1
                      
                      asr_intru_comp_0~tau_AG*1
                      asr_intru_comp_2~tau_AG*1
                      asr_intru_comp_4~tau_AG*1
                      
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_rulebreak_comp_4~tau_AA*1
                      
                      asr_soma_comp_0~tau_AS*1
                      asr_soma_comp_2~tau_AS*1
                      asr_soma_comp_4~tau_AS*1
                      
                      asr_thouprob_comp_0~tau_AP*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_thouprob_comp_4~tau_AP*1
                      
                      asr_withdep_comp_0~tau_AW*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_withdep_comp_4~tau_AW*1'

lavaan(pp.3t.strong.invar,
       data = pp_factor_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("pp_3t_strong.rds")
```


#### result


```{r}

eigen(inspect(readRDS("pp_3t_strong.rds"), "cor.lv"))$value

readRDS("pp_3t_strong.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T)
```


### Second order model

#### model fit


```{r}

lg.pp.3t.strong.invar <-'#factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1'

lavaan(lg.pp.3t.strong.invar,
       data = pp_factor_wide.scaled,
       meanstructure = TRUE,
       estimator = "ML",
       missing = "fiml",
       fixed.x = F,
       std.lv = T) %>% 
  saveRDS("lgcm_pp_3t_model.rds")
```


#### result


```{r}

eigen(inspect(readRDS("lgcm_pp_3t_model.rds"), "cor.lv"))$value

readRDS("lgcm_pp_3t_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("lgcm_pp_3t_result.rds")

readRDS("lgcm_pp_3t_result.rds")
```


#### model comparison


```{r}
lapply(
  c(
    "pp_3t_config_result.rds",
    "pp_3t_weak_result.rds",
    "pp_3t_strong_result.rds",
    "lgcm_pp_3t_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM"), ., row.names = NULL)
```


#### ICC


```{r}
lavPredict(readRDS("lgcm_pp_3t_model.rds"),
             newdata = pp_factor_wide.scaled,
             append.data = T
             ) %>% 
  data.frame() %>%  
  select(contains(c("a_eta"))) %>% 
  ICC(lmer=T) %>% 
  saveRDS("pp_3t_icc.rds")

readRDS("pp_3t_icc.rds")
```


# Parallel growth curve Model 

## pc ~ pp + g model without sex

### model fit 


```{r}

pga6.model <- "# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+ 
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+ 
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+ 
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+ 
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+ 
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+ 
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+ 
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1
                      
                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      p_etaB ~ 0*1  
                      p_eta1 ~ 0*1                   
                      p_eta2 ~ 0*1                   
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1
                      
               # second-order g factor       
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"


lavaan(pga6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_pga6_model.rds")
```


### result


```{r}
eigen(inspect(readRDS("pgcm_pga6_model.rds"), "cor.lv"))$value

readRDS("pgcm_pga6_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("pgcm_pga6_result.rds")

readRDS("pgcm_pga6_result.rds")
```


### Externalizing model

#### model fit


```{r}
Ext.pga6.model <- "# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
               
               # second-order g factor       
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      
                      p_i~1
                      p_s~1
                      p_q~1
                      
                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6
                      
                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1
                      
                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"

lavaan(Ext.pga6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pga6_model.rds")
```


#### result


```{r}
eigen(inspect(readRDS("pgcm_Ext_pga6_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pga6_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("pgcm_Ext_pga6_result.rds")

readRDS("pgcm_Ext_pga6_result.rds")
```


### Internalizing model

#### model fit


```{r}
Int.pga6.model <- "# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
               
               # second-order g factor       
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1
                      
                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"

lavaan(Int.pga6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pga6_model.rds")
```


#### result


```{r}
eigen(inspect(readRDS("pgcm_Int_pga6_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pga6_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("pgcm_Int_pga6_result.rds")

readRDS("pgcm_Int_pga6_result.rds")
```


## pc ~ g model with sex

### model fit


```{r}
pg6.sex.model <- '# 
               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+ 
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+ 
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+ 
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+ 
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+ 
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+ 
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+ 
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1
                      
                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      p_etaB ~ 0*1  
                      p_eta1 ~ 0*1                   
                      p_eta2 ~ 0*1                   
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1
                      
               # second-order g factor       
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1 + dummy_sex
                      g_s~1 + dummy_sex
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # regression
                      p_i ~ g_i
                      p_s ~ g_i + g_s
                      p_q ~ g_i + g_s'

lavaan(pg6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pg6_sex_model.rds")
```


### result


```{r}
# Check model
eigen(inspect(readRDS("pgcm_pg6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_pg6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          fm.args = list(robust = F),
          rsq = T) %>% 
  saveRDS("pgcm_pg6_sex_result.rds")
```


#### Model summary


```{r}
readRDS("pgcm_pg6_sex_result.rds")
```


### Externalizing model


```{r}
Ext.pg6.sex.model <- '# 
               # second-order g factor       
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1 + dummy_sex
                      g_s~1 + dummy_sex
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      
                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6
                      
                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1
                      
                      # regression
                      p_i ~ g_i
                      p_s ~ g_i + g_s
                      p_q ~ g_i + g_s'

lavaan(Ext.pg6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pg6_sex_model.rds")
```


#### result


```{r}
# Check model
eigen(inspect(readRDS("pgcm_Ext_pg6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_Ext_pg6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          fm.args = list(robust = F),
          rsq = T) %>% 
  saveRDS("pgcm_Ext_pg6_sex_result.rds")
```


### Internalizing model


```{r}
Int.pg6.sex.model <- '# 
               # second-order g factor       
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+ 
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+ 
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+ 
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+ 
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1 + dummy_sex
                      g_s~1 + dummy_sex
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1
                      
                      # regression
                      p_i ~ g_i
                      p_s ~ g_i + g_s
                      p_q ~ g_i + g_s'

lavaan(Int.pg6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pg6_sex_model.rds")
```


#### result


```{r}
# Check model
eigen(inspect(readRDS("pgcm_Int_pg6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_Int_pg6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          fm.args = list(robust = F),
          rsq = T) %>% 
  saveRDS("pgcm_Int_pg6_sex_result.rds")
```


## pc ~ pp model with sex

### model fit


```{r}

pa6.sex.model <- '# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1 + dummy_sex
                      a_s~1 + dummy_sex
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+ 
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+ 
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+ 
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+ 
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+ 
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+ 
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+ 
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1
                      
                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      p_etaB ~ 0*1  
                      p_eta1 ~ 0*1                   
                      p_eta2 ~ 0*1                   
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1
                      
                      # regression
                      p_i ~ a_i
                      p_s ~ a_i + a_s
                      p_q ~ a_i + a_s'

lavaan(pa6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pa6_sex_model.rds")
```


### result


```{r}
# Check model
eigen(inspect(readRDS("pgcm_pa6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_pa6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T) %>% 
  saveRDS("pgcm_pa6_sex_result.rds")
```


#### Model summary


```{r}
readRDS("pgcm_pa6_sex_result.rds")
```


### Externalizing model


```{r}
Ext.pa6.sex.model <- '# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1 + dummy_sex
                      a_s~1 + dummy_sex
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
                      # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      
                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6
                      
                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1
                      
                      # regression
                      p_i ~ a_i
                      p_s ~ a_i + a_s
                      p_q ~ a_i + a_s'

lavaan(Ext.pa6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pa6_sex_model.rds")
```


#### result


```{r}
# Check model
eigen(inspect(readRDS("pgcm_Ext_pa6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_Ext_pa6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T) %>% 
  saveRDS("pgcm_Ext_pa6_sex_result.rds")
```


### Internalizing model


```{r}
Int.pa6.sex.model <- '# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1 + dummy_sex
                      a_s~1 + dummy_sex
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
                      # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1
                      
                      # regression
                      p_i ~ a_i
                      p_s ~ a_i + a_s
                      p_q ~ a_i + a_s'

lavaan(Int.pa6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pa6_sex_model.rds")
```


#### result


```{r}
# Check model
eigen(inspect(readRDS("pgcm_Int_pa6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_Int_pa6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T) %>% 
  saveRDS("pgcm_Int_pa6_sex_result.rds")
```


## pc ~ pp + g model with sex

### model fit


```{r}
# Add sex as covariate
pga6.sex.model <- pga6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(pga6.sex.model)

lavaan(pga6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pga6_sex_model.rds")
```


### result


```{r}

# Check model
eigen(inspect(readRDS("pgcm_pga6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_pga6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE,
          rsq = T) %>% 
  saveRDS("pgcm_pga6_sex_result.rds")

parameterEstimates(readRDS("pgcm_pga6_sex_model.rds"))

lavInspect(readRDS("pgcm_pga6_sex_model.rds"), "est")           # matrix of estimated parameters
lavInspect(readRDS("pgcm_pga6_sex_model.rds"), "free")          # shows which elements are free parameters
lavInspect(readRDS("pgcm_pga6_sex_model.rds"), "converged")     # did model converge?
lavInspect(readRDS("pgcm_pga6_sex_model.rds"), "constraints")   # constraints, if any
lavInspect(readRDS("pgcm_pga6_sex_model.rds"), "list")  
```


#### Model summary


```{r}
readRDS("pgcm_pga6_sex_result.rds")
```


#### Standardized estimate


```{r}
standardizedSolution(readRDS("pgcm_pga6_sex_model.rds")) %>% 
  filter(op == "~")
```


### Externalizing model

#### model fit


```{r}
# Add sex as covariate
Ext.pga6.sex.model <- Ext.pga6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(Ext.pga6.sex.model)

lavaan(Ext.pga6.sex.model,
  data = pga6_wide.allscaled.sex,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pga6_sex_model.rds")
```


#### result


```{r}

# Check model
eigen(inspect(readRDS("pgcm_Ext_pga6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_Ext_pga6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("pgcm_Ext_pga6_sex_result.rds")
```


##### Model summary


```{r}
readRDS("pgcm_Ext_pga6_sex_result.rds")
```


##### Standardized estimate


```{r}
standardizedSolution(readRDS("pgcm_Ext_pga6_sex_model.rds")) %>% 
  filter(op == "~")
```


### Internalizing model

#### model fit


```{r}
# Add sex as covariate
Int.pga6.sex.model <- Int.pga6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(Int.pga6.sex.model)

lavaan(Int.pga6.sex.model,
  data = pga6_wide.allscaled.sex,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pga6_sex_model.rds")
```


#### result


```{r}

# Check model
eigen(inspect(readRDS("pgcm_Int_pga6_sex_model.rds"), "cor.lv"))$value

# Save result
readRDS("pgcm_Int_pga6_sex_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("pgcm_Int_pga6_sex_result.rds")
```


##### Model summary


```{r}
readRDS("pgcm_Int_pga6_sex_result.rds")
```


##### Standardized estimate


```{r}
standardizedSolution(readRDS("pgcm_Int_pga6_sex_model.rds")) %>% 
  filter(op == "~")
```


### Result Summary


```{r}

model_list <- c(
  "pgcm_pga6_sex_model.rds",
  "pgcm_Ext_pga6_sex_model.rds",
  "pgcm_Int_pga6_sex_model.rds"
)

# combine all significant results

final.pga.sex.result <- data.frame()

for (a in 1:3) {
final.pga.sex.result <- final.pga.sex.result %>% 
  rbind(
    readRDS(paste0(model_list[a])) %>% 
      standardizedSolution() %>% 
      filter(op == "~") %>% 
      filter(rhs != "dummy_sex") %>% 
      select(lhs:pvalue) %>% 
      mutate(label = str_sub(model_result_list[a],6,8))
  )
}

final.pga.sex.result %>% 
  mutate(sig = case_when(
    pvalue < .001 ~ "***",
    pvalue < .01 ~ "**",
    pvalue < .05 ~ "*",
    pvalue >= .05 ~ ""
  )) %>% 
  mutate(std.lv = round(est.std,3),
         effsize = stringr::str_replace(paste0(std.lv,sig),"0.", ".")) %>%
  select(lhs,op,rhs,label,effsize) %>% 
  pivot_wider(names_from = label,
              values_from = effsize) %>% 
  select(lhs,op,rhs,Int,Ext,pga)
```


# Commonality analysis

## General p factor


```{r}

lapply(
  c("pgcm_pga6_sex_model.rds",
    "pgcm_pg6_sex_model.rds",
    "pgcm_pa6_sex_model.rds"
  ),
  function(f) {
    inspect(readRDS(f), "r2")[c("p_i","p_s","p_q")]
  }
) %>%
  do.call(rbind, .) %>%
  round(4) %>%
  data.frame(., row.names = c("pc~pp+g",
                       "pc~g",
                       "pc~pp")) %>% 
  t() %>% 
  data.frame() %>% 
  mutate(Unique_g = .[[1]] - .[[3]], # whole model (pc ~ pp + g) minus pc ~ pp
         Unique_pp = .[[1]] - .[[2]], # whole model (pc ~ pp + g) minus pc ~ g
         Common = .[[1]] - Unique_g - Unique_pp)
```


## Externalizing


```{r}

lapply(
  c("pgcm_Ext_pga6_sex_model.rds",
    "pgcm_Ext_pg6_sex_model.rds",
    "pgcm_Ext_pa6_sex_model.rds"
  ),
  function(f) {
    inspect(readRDS(f), "r2")[c("p_i","p_s","p_q")]
  }
) %>%
  do.call(rbind, .) %>%
  round(4) %>%
  data.frame(., row.names = c("pc~pp+g",
                       "pc~g",
                       "pc~pp")) %>% 
  t() %>% 
  data.frame() %>% 
  mutate(Unique_g = .[[1]] - .[[3]], # whole model (pc ~ pp + g) minus pc ~ pp
         Unique_pp = .[[1]] - .[[2]], # whole model (pc ~ pp + g) minus pc ~ g
         Common = .[[1]] - Unique_g - Unique_pp)
```


## Internalizing 


```{r}

lapply(
  c("pgcm_Int_pga6_sex_model.rds",
    "pgcm_Int_pg6_sex_model.rds",
    "pgcm_Int_pa6_sex_model.rds"
  ),
  function(f) {
    inspect(readRDS(f), "r2")[c("p_i","p_s","p_q")]
  }
) %>%
  do.call(rbind, .) %>%
  round(4) %>%
  data.frame(., row.names = c("pc~pp+g",
                       "pc~g",
                       "pc~pp")) %>% 
  t() %>% 
  data.frame() %>% 
  mutate(Unique_g = .[[1]] - .[[3]], # whole model (pc ~ pp + g) minus pc ~ pp
         Unique_pp = .[[1]] - .[[2]], # whole model (pc ~ pp + g) minus pc ~ g
         Common = .[[1]] - Unique_g - Unique_pp) 
```


### doFuture for robust fit measures


```{r}

pga_model_list <- c(
  "pgcm_pga6_model.rds",
  "pgcm_pga6_sex_model.rds",
  "pgcm_pg6_sex_model.rds",
  "pgcm_Ext_pg6_sex_model.rds",
  "pgcm_Int_pg6_sex_model.rds",
  "pgcm_pa6_sex_model.rds",
  "pgcm_Ext_pa6_sex_model.rds",
  "pgcm_Int_pa6_sex_model.rds"
)

options(future.globals.onReference = "error")

plan(multisession(workers = availableCores()))

foreach(a = 1:8, .options.future = list(seed = TRUE)) %dofuture% {
  readRDS(paste0(pga_model_list[a])) %>%
    summary(
      std = T,
      fit.measures = TRUE,
      rsq = T
    ) %>%
    saveRDS(paste0(pga_model_list[a] %>%
      str_replace("model.rds", "result.rds")))
}
```


## pc, pp, & g model without sex (g task 4)

### model fit 


```{r}

pga6.model2 <- "# second-order pp factor 
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+ 
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+ 
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+ 
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4
                       
              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4
              
              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0
                      
                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2
                      
                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4
                      
              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4
                      
                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4
                      
                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4
                      
                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4
                      
                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4
                      
                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4
                      
                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4
                      
                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4
                      
                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      
                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      
                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      
                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      
              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1
                      
                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1
                      
                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1
                      
                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1
                      
               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_W*withdep_comp_0+ 
                       lambda_S*soma_comp_0+
                       lambda_C*socprob_comp_0+
                       lambda_H*thouprob_comp_0+
                       lambda_A*attprob_comp_0+
                       lambda_R*rulebreak_comp_0+
                       lambda_G*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_W*withdep_comp_1+ 
                       lambda_S*soma_comp_1+
                       lambda_C*socprob_comp_1+
                       lambda_H*thouprob_comp_1+
                       lambda_A*attprob_comp_1+
                       lambda_R*rulebreak_comp_1+
                       lambda_G*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_W*withdep_comp_2+ 
                       lambda_S*soma_comp_2+
                       lambda_C*socprob_comp_2+
                       lambda_H*thouprob_comp_2+
                       lambda_A*attprob_comp_2+
                       lambda_R*rulebreak_comp_2+
                       lambda_G*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_W*withdep_comp_3+ 
                       lambda_S*soma_comp_3+
                       lambda_C*socprob_comp_3+
                       lambda_H*thouprob_comp_3+
                       lambda_A*attprob_comp_3+
                       lambda_R*rulebreak_comp_3+
                       lambda_G*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_W*withdep_comp_4+ 
                       lambda_S*soma_comp_4+
                       lambda_C*socprob_comp_4+
                       lambda_H*thouprob_comp_4+
                       lambda_A*attprob_comp_4+
                       lambda_R*rulebreak_comp_4+
                       lambda_G*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_W*withdep_comp_5+ 
                       lambda_S*soma_comp_5+
                       lambda_C*socprob_comp_5+
                       lambda_H*thouprob_comp_5+
                       lambda_A*attprob_comp_5+
                       lambda_R*rulebreak_comp_5+
                       lambda_G*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_W*withdep_comp_6+ 
                       lambda_S*soma_comp_6+
                       lambda_C*socprob_comp_6+
                       lambda_H*thouprob_comp_6+
                       lambda_A*attprob_comp_6+
                       lambda_R*rulebreak_comp_6+
                       lambda_G*aggress_comp_6
                       
              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6
              
              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1
                      
                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2
                      
                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3
                      
                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4
                      
                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5
                      
                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6
                      
              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6
                      
                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6
                      
                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6
                      
                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6
                      
                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6
                      
                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6
                      
                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6
                      
                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6
                      
                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      
                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      
                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      
              #observed variable intercepts
                      anxdep_comp_0~tau_X*1
                      anxdep_comp_1~tau_X*1
                      anxdep_comp_2~tau_X*1
                      anxdep_comp_3~tau_X*1
                      anxdep_comp_4~tau_X*1
                      anxdep_comp_5~tau_X*1
                      anxdep_comp_6~tau_X*1
                      withdep_comp_0~tau_W*1
                      withdep_comp_1~tau_W*1
                      withdep_comp_2~tau_W*1
                      withdep_comp_3~tau_W*1
                      withdep_comp_4~tau_W*1
                      withdep_comp_5~tau_W*1
                      withdep_comp_6~tau_W*1
                      soma_comp_0~tau_S*1
                      soma_comp_1~tau_S*1
                      soma_comp_2~tau_S*1
                      soma_comp_3~tau_S*1
                      soma_comp_4~tau_S*1
                      soma_comp_5~tau_S*1
                      soma_comp_6~tau_S*1
                      socprob_comp_0~tau_P*1
                      socprob_comp_1~tau_P*1
                      socprob_comp_2~tau_P*1
                      socprob_comp_3~tau_P*1
                      socprob_comp_4~tau_P*1
                      socprob_comp_5~tau_P*1
                      socprob_comp_6~tau_P*1
                      thouprob_comp_0~tau_H*1
                      thouprob_comp_1~tau_H*1
                      thouprob_comp_2~tau_H*1
                      thouprob_comp_3~tau_H*1
                      thouprob_comp_4~tau_H*1
                      thouprob_comp_5~tau_H*1
                      thouprob_comp_6~tau_H*1
                      attprob_comp_0~tau_A*1
                      attprob_comp_1~tau_A*1
                      attprob_comp_2~tau_A*1
                      attprob_comp_3~tau_A*1
                      attprob_comp_4~tau_A*1
                      attprob_comp_5~tau_A*1
                      attprob_comp_6~tau_A*1
                      rulebreak_comp_0~tau_R*1
                      rulebreak_comp_1~tau_R*1
                      rulebreak_comp_2~tau_R*1
                      rulebreak_comp_3~tau_R*1
                      rulebreak_comp_4~tau_R*1
                      rulebreak_comp_5~tau_R*1
                      rulebreak_comp_6~tau_R*1
                      aggress_comp_0~tau_G*1
                      aggress_comp_1~tau_G*1
                      aggress_comp_2~tau_G*1
                      aggress_comp_3~tau_G*1
                      aggress_comp_4~tau_G*1
                      aggress_comp_5~tau_G*1
                      aggress_comp_6~tau_G*1
                      
                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6
                      
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      p_etaB ~ 0*1  
                      p_eta1 ~ 0*1                   
                      p_eta2 ~ 0*1                   
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1
                      
               # second-order g factor       
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6
                       
              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6
                       
              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6
                      
              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6
                      
                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4
                      
              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6
                      
                      g_i~~NA*g_i
                      g_s~~NA*g_s
                      
                      g_i~~g_s
                      
                      g_i~1
                      g_s~1
                      
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1
                      
                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"

lavaan(pga6.model2,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_pga6_model2.rds")
```


### result


```{r}
eigen(inspect(readRDS("pgcm_pga6_model2.rds"), "cor.lv"))$value

readRDS("pgcm_pga6_model2.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          fm.args = list(robust = F),
          rsq = T) 

readRDS("pgcm_pga6_model.rds") %>% 
  summary(std = T, 
          fit.measures=TRUE, 
          rsq = T) %>% 
  saveRDS("pgcm_pga6_result.rds")

readRDS("pgcm_pga6_result.rds")
```




## covariance


```{r}
## --- 1. Put your vectors in a named list ------------------------------------
tasks <- list(
  flanker = c("flanker_0", "flanker_2", "flanker_4", "flanker_6"),
  pattern = c("pattern_0", "pattern_2", "pattern_4", "pattern_6"),
  picture = c("picture_0", "picture_2", "picture_4", "picture_6"),
  picvocb = c("picvocab_0", "picvocab_2", "picvocab_4", "picvocab_6"),
  reading = c("reading_0", "reading_2", "reading_4", "reading_6")
)

## --- 2. Flatten to a data‑frame with a task label ---------------------------
library(tibble)
df <- tibble(
  item = unlist(tasks, use.names = FALSE),
  task = rep(names(tasks), lengths(tasks))
)

## --- 3. All unordered pairs, discard same‑task pairs ------------------------
pairs <- combn(seq_len(nrow(df)), 2, simplify = FALSE) |>
  purrr::keep(~ df$task[.x[1]] != df$task[.x[2]]) |>
  purrr::map_chr(~ paste(df$item[.x[1]], "~~", df$item[.x[2]]))

## --- 4. Inspect / export ----------------------------------------------------
length(pairs)        # 160   (10 task‑combinations × 4 × 4 time‑combinations)
cat(pairs, sep = "\n")  # prints each “var1 ~~ var2” on its own line

```

