---
title: "R script supplementary"
format:
  html:
    page-layout: article
    toc: true
    toc-depth: 6
    sidebar:
      style: docked
      contents: toc
      width: 350px
    grid:
      body-width: 900px
    html-math-method: katex
    css: styles.css
---

Supplementary R Script: 

This document provides the complete R code for all analyses, data preparation, and visualizations reported in the manuscript.

# Setup and Data Preparation

## Load Required Libraries

```{r}
#| include: false

options(knitr.kable.NA = "", dplyr.print_max = Inf, dplyr.print_min = Inf)
options(tibble.print_max = Inf, tibble.width = Inf)
knitr::opts_chunk$set(echo = TRUE)
library(styler)
library(knitr)
library(tidyverse)
library(psych)
library(lavaan)
library(semPlot)
library(semptools)
library(parameters)
library(rio)
library(rmarkdown)
library(visdat)
library(summarytools)
library(EFAtools)
library(lavaanPlot)
library(ggplot2)
```

# Load Data

This analysis uses ABCD Release 6

```{r}
demo6 <- tibble::as_tibble(rio::import("ab_p_demo.tsv")) # Demographic Data
sex6 <- tibble::as_tibble(rio::import("ab_g_stc.tsv")) # Sex
svs6 <- tibble::as_tibble(rio::import("nc_y_svs.tsv")) # Snellen's vision problem screening
cbcl6 <- tibble::as_tibble(rio::import("mh_p_cbcl.tsv")) # Child Behavior Checklist
tool6 <- tibble::as_tibble(rio::import("nc_y_nihtb.tsv")) # NIH Toolbox
asr6 <- tibble::as_tibble(rio::import("mh_p_asr.tsv")) # Adult Self Report
y_pds6 <- tibble::as_tibble(rio::import("ph_y_pds.tsv")) # Puberty Youth Report
p_pds6 <- tibble::as_tibble(rio::import("ph_p_pds.tsv")) # Puberty Parent Report
```

# replace "n/a" with NA

```{r}
demo6 <- demo6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

sex6 <- sex6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

svs6 <- svs6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

cbcl6 <- cbcl6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

tool6 <- tool6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

asr6 <- asr6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

y_pds6 <- y_pds6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))

p_pds6 <- p_pds6 %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ dplyr::na_if(as.character(.x), "n/a")))
```

## Vision problem screening 

need to exclude participants with vision problem

```{r}
# Check for vision problem
vision <- svs6 %>% mutate(visionProb = ifelse(nc_y_svs_002 == 0 | nc_y_svs_002 == 1 | nc_y_svs_002__01 == 2, 1, 0))

# Join data excluding participants with vision problem
abcd6_all <- plyr::join_all(list(vision, demo6, cbcl6, tool6, asr6, y_pds6, p_pds6), by = c("participant_id", "session_id"), type = "full") %>%
  filter(visionProb != 1 | is.na(visionProb))

# check duplicate
abcd6_all %>%
  select(participant_id, session_id) %>%
  group_by(session_id) %>%
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id))) %>%
  knitr::kable()
```

## Prapare Data

```{r}
#| warning: False
# Convert data into appropriate type
abcd6_all <- abcd6_all %>%
  dplyr::mutate(dplyr::across(dplyr::everything(), ~ utils::type.convert(.x, as.is = TRUE)))

# label session_id into 0 (baseline) to 6 years follow-up
abcd6_all <- abcd6_all %>%
  mutate(
    session_id = factor(session_id,
      levels = c(
        "ses-00A",
        "ses-01A",
        "ses-02A",
        "ses-03A",
        "ses-04A",
        "ses-05A",
        "ses-06A"
      ),
      labels = c("0", "1", "2", "3", "4", "5", "6")
    )
  )

# Add sex
abcd6_all.sex <- plyr::join_all(
  list(
    abcd6_all,
    sex6 %>%
      select(participant_id, ab_g_stc__cohort_sex) %>%
      drop_na(ab_g_stc__cohort_sex)
  ),
  by = c("participant_id"), type = "left"
)

# check duplicate
abcd6_all.sex %>%
  select(participant_id, session_id, ab_g_stc__cohort_sex) %>%
  group_by(ab_g_stc__cohort_sex, session_id) %>%
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id))) %>%
  knitr::kable()
```

## Age & Sex in each timepoint

```{r}
#| eval: False

abcd6_all.sex %>%
  select(participant_id, session_id, ab_p_demo_age, ab_g_stc__cohort_sex) %>%
  group_by(session_id) %>%
  dplyr::summarise(
    count = dplyr::n(),
    AgeMean = round(mean(ab_p_demo_age, na.rm = T), 2),
    AgeSD = round(sd(ab_p_demo_age, na.rm = T), 2),
    male_N = sum(ab_g_stc__cohort_sex == 1, na.rm = TRUE),
    female_N = sum(ab_g_stc__cohort_sex == 2, na.rm = TRUE),
    male_pct = mean(ab_g_stc__cohort_sex == 1) * 100,
    female_pct = mean(ab_g_stc__cohort_sex == 2) * 100
  ) %>%
  knitr::kable()
```

```{r}
#| echo: False
readRDS("abcd6_demo_table.rds")
```

### density plot

```{r}
#| warning: False
ggplot(
  abcd6_all.sex,
  aes(
    x = ab_p_demo_age, y = session_id,
    fill = factor(ab_g_stc__cohort_sex), height = ..count..
  )
) +
  ggridges::geom_density_ridges(stat = "density", scale = .8, alpha = .7) +
  xlab("Age (Years old)") +
  ylab("Time point") +
  theme_bw(base_size = 20) +
  theme(legend.position = "bottom") +
  scale_fill_manual(
    name = "Sex",
    labels = c(
      "1" = "Male",
      "2" = "Female"
    ),
    values = c(
      "1" = "navy",
      "2" = "darkred"
    )
  ) +
  scale_x_continuous(breaks = 8:18) +
  scale_y_discrete(labels = c("Baseline", paste0("Year", 1:6))) +
  annotate(
    geom = "text",
    x = (14) - .1,
    y = 1:7, size = 5,
    label = paste0(
      "N = ",
      readRDS("abcd6_demo_table.rds") %>%
        pull(count) %>%
        formattable::comma(digits = 0, big.mark = ",")
    ),
    vjust = 1.2
  ) +
  annotate(
    geom = "text",
    x = (16.05),
    y = 1:7, size = 5,
    label = paste0(
      "(",
      readRDS("abcd6_demo_table.rds") %>%
        pull(male_N) %>%
        formattable::comma(digits = 0, big.mark = ","),
      "/"
    ),
    vjust = 1.2, color = "navy"
  ) +
  annotate(
    geom = "text",
    x = (17.6),
    y = 1:7, size = 5,
    label = paste0(readRDS("abcd6_demo_table.rds") %>%
      pull(female_N) %>%
      formattable::comma(digits = 0, big.mark = ","), ")"),
    vjust = 1.2, color = "darkred"
  )
```

# Load Cognition Data (g factor)

```{r}
g_factor <- abcd6_all %>%
  select(contains(c("_id", "uncor_score")))

colnames(g_factor) <- c(
  "participant_id",
  "session_id",
  "cryst", # Crystallized Composite Score
  "fluid", # Fluid Composite Score
  "total_int", # Total Composite Scores
  "cardsort", # Dimensional Change Card Sort
  "flanker", # Flanker Inhibitory Control & Attention
  "list", # List Sorting Working Memory
  "picture", # Picture Sequence Memory
  "picvocab", # Picture Vocabulary
  "pattern", # Pattern Comparison Processing Speed
  "reading" # Oral Reading Recognition: Language
)
```


## Valid data N & % in session_id

```{r}
g_factor %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  }) %>%
  knitr::kable()
```

5 cognitive tasks that contain complete available data:

Flanker Inhibitory Control & Attention
Picture Sequence Memory
Picture Vocabulary
Pattern Comparison Processing Speed
Oral Reading Recognition: Language

with 4 time points available:

Baseline (00), 
2 year follow-up (02), 
4 year follow-up (04), 
6 year follow-up (06)

## Check data

```{r}
# Select 5 available cognitive tasks in 4 time points

g_factor_5task <- g_factor %>%
  select(
    "participant_id",
    "session_id",
    "flanker", # Flanker Inhibitory Control & Attention
    "picture", # Picture Sequence Memory
    "picvocab", # Picture Vocabulary
    "pattern", # Pattern Comparison Processing Speed
    "reading" # Oral Reading Recognition: Language
  ) %>%
  filter(session_id %in% c("0", "2", "4", "6")) # only baseline, 2, 4, and 6 years data


# Year 0 (Baseline)

g_factor_5task %>%
  filter(session_id == "0") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 2

g_factor_5task %>%
  filter(session_id == "2") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 4

g_factor_5task %>%
  filter(session_id == "4") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 6

g_factor_5task %>%
  filter(session_id == "6") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Reading in Year 2 contained an outliar
# (180 raw score which should be ranged from 59 to 140)

g_factor_5task$reading <- ifelse(g_factor_5task$reading > 140,
  NA, # replace >140 with NA
  g_factor_5task$reading
)

# Recheck

g_factor_5task %>%
  filter(session_id == "2") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# reading max score came down from 180 to 121
```

### Missing Visualization 

```{r}
# Baseline
g_factor_5task %>%
  filter(session_id == "0") %>%
  visdat::vis_miss()


# 2-year follow-up
g_factor_5task %>%
  filter(session_id == "2") %>%
  visdat::vis_miss()

# 4-year follow-up
g_factor_5task %>%
  filter(session_id == "4") %>%
  visdat::vis_miss()

# 6-year follow-up
g_factor_5task %>%
  filter(session_id == "6") %>%
  visdat::vis_miss()
```

## Scaled score: Z score

```{r}
# Scale into Z-score across all time points

g_factor_5task.scaled <- g_factor_5task %>%
  mutate_at(scale,
    .vars = c(
      "flanker", # Flanker Inhibitory Control & Attention
      "picture", # Picture Sequence Memory
      "picvocab", # Picture Vocabulary
      "pattern", # Pattern Comparison Processing Speed
      "reading" # Oral Reading Recognition: Language
    ),
    center = TRUE,
    scale = TRUE
  )
```

## Reconstruct Data

#### Long form (Scaled)

```{r}
#| warning: False
g_factor_5task_long.scaled <- g_factor_5task.scaled %>%
  pivot_longer(
    cols = c(
      "flanker", # Flanker Inhibitory Control & Attention
      "picture", # Picture Sequence Memory
      "picvocab", # Picture Vocabulary
      "pattern", # Pattern Comparison Processing Speed
      "reading" # Oral Reading Recognition: Language
    ),
    names_to = "variable",
    values_to = "value"
  )

# check duplicate
g_factor_5task_long.scaled %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(
    count = sum(!is.na(value)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

#### Wide form (Scaled)

```{r}
g_factor_5task_wide.scaled <- g_factor_5task.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(
      "flanker", # Flanker Inhibitory Control & Attention
      "picture", # Picture Sequence Memory
      "picvocab", # Picture Vocabulary
      "pattern", # Pattern Comparison Processing Speed
      "reading" # Oral Reading Recognition: Language
    )
  )


# check duplicate
g_factor_5task_wide.scaled %>%
  select(participant_id) %>%
  dplyr::summarise(
    count = sum(!is.na(participant_id)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

## Descriptive Stat Summary

```{r}
#| warning: False
g_factor_5task_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

## Plot

```{r}
#| warning: False
# All tasks plot
g_5task_plot <- Rmisc::summarySE(
  g_factor_5task_long.scaled %>%
    mutate(variable = factor(
      variable,
      levels = c(
        "flanker", # Flanker Inhibitory Control & Attention
        "picture", # Picture Sequence Memory
        "picvocab", # Picture Vocabulary
        "pattern", # Pattern Comparison Processing Speed
        "reading" # Oral Reading Recognition: Language
      )
    )),
  measurevar = "value",
  na.rm = T,
  groupvars = c("variable", "session_id")
) %>%
  ggplot(aes(session_id, value, color = variable, group = variable)) +
  geom_errorbar(
    aes(x = session_id, y = value, ymin = value - ci, ymax = value + ci),
    alpha = 1, position = position_dodge(width = .5), colour = "black"
  ) +
  stat_summary(fun.y = mean, geom = "line", position = position_dodge(width = .5), linewidth = 1.5) +
  theme_bw(base_size = 20) +
  ylab("Children's\nCognitive Functoning") +
  labs(color = "Task") +
  scale_x_discrete(labels = c("10", "12", "14", "16")) +
  theme(axis.title.x = element_blank())

g_5task_plot %>% saveRDS("g_5task_plot.rds")
```

```{r}
readRDS("g_5task_plot.rds") +
  theme(
    axis.title.x = element_text(),
    legend.position = "bottom"
  ) +
  guides(color = guide_legend(nrow = 2)) +
  labs(x = expression("Time points (" * italic(M)["age"] * ", y/o)"))
```

# Load CBCL (Child p factor)

CBCL definitions from Michelini et al. Translational Psychiatry (2019)

```{r}
pc_factor <- abcd6_all %>%
  select(contains(c("_id", "cbcl"))) %>% # select id & cbcl items
  select(contains(c("_id", "_0"))) %>% # select only items, not sum scores
  select(-contains("othpr")) # excluded other problem items
```

## Valid data N & % in session_id

```{r}
#| results: 'asis'

pc_factor %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  }) %>%
  DT::datatable(options = list(pageLength = 10, scrollY = "450px", scrollX = TRUE))
```

> 98% availability across all cbcl items in all 7 time points (0-6)

## Check Low Freq CBCL items

Because some CBCL items may exhibit a high proportion of zero responses when no problems are observed, we examined item frequency distributions to identify low-frequency items.

```{r}
pc_lowcheck <- pc_factor

# check total items

pc_lowcheck %>%
  select(contains("cbcl")) %>%
  ncol() # n of total items = 103

# Check only 0 responses
pc_lowcheck[, 3:ncol(pc_lowcheck)] <- ifelse(pc_lowcheck[, 3:ncol(pc_lowcheck)] == 0, 1, NA)

# Check items with zero response >= 99.5% across all timelines

# Baseline
lowfreq_cbcl6_b <- pc_lowcheck %>%
  filter(session_id == "0") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 1 Year Follow-up
lowfreq_cbcl6_1 <- pc_lowcheck %>%
  filter(session_id == "1") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 2 Year Follow-up
lowfreq_cbcl6_2 <- pc_lowcheck %>%
  filter(session_id == "2") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 3 Year Follow-up
lowfreq_cbcl6_3 <- pc_lowcheck %>%
  filter(session_id == "3") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 4 Year Follow-up
lowfreq_cbcl6_4 <- pc_lowcheck %>%
  filter(session_id == "4") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 5 Year Follow-up
lowfreq_cbcl6_5 <- pc_lowcheck %>%
  filter(session_id == "5") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 6 Year Follow-up
lowfreq_cbcl6_6 <- pc_lowcheck %>%
  filter(session_id == "6") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# low frequecy item Summary

# Baseline:
lowfreq_cbcl6_b # rule__cond_010, rule__001, rule__003, rule__005, rule__006

# 1Year:
lowfreq_cbcl6_1 # rule__001, rule__003, rule__005, rule__006

# 2Year:
lowfreq_cbcl6_2

# 3Year:
lowfreq_cbcl6_3

# 4Year:
lowfreq_cbcl6_4

# 5Year:
lowfreq_cbcl6_5

# 6Year:
lowfreq_cbcl6_6
```

low freq Item Description (7 unique items)

mh_p_cbcl__rule_001	        = Drinks alcohol without parents' approval
mh_p_cbcl__rule_003	        = Sexual problems
mh_p_cbcl__rule_005	        = Smokes, chews, or sniffs tobacco
mh_p_cbcl__rule__cond_010   =	Truancy, skips school	101
mh_p_cbcl__rule_006         =	Uses drugs for non medical purposes (don't include alcohol or tobacco)

## Cut Low Freq CBCL items

```{r}
# Cut low frequecy items across all timelines
pc_factor_nolow <- pc_factor %>%
  select(-all_of(c(
    lowfreq_cbcl6_b,
    lowfreq_cbcl6_1,
    lowfreq_cbcl6_2,
    lowfreq_cbcl6_3,
    lowfreq_cbcl6_4,
    lowfreq_cbcl6_5,
    lowfreq_cbcl6_6
  )))

# n of remaining items = 96 out of 103
pc_factor_nolow %>%
  select(contains("cbcl")) %>%
  ncol()
```

## Calculate Composite scores for CBCL

The calculation was based on CBCL manual (Achenbach, 2015)

![](CBCL_Manual.jpg)

```{r}
pc_factor_nolow <- pc_factor_nolow %>%
  mutate(
    # Anxious/Depressed composite score
    anxdep_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("anxdep"))
    ),
    # Withdrawn/Depressed composite score
    withdep_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("wthdep"))
    ),
    # Somatic complaints composite score
    soma_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("som"))
    ),
    # Social Problems composite score
    socprob_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("soc"))
    ),
    # Thought Problems composite score
    thouprob_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("tho"))
    ),
    # Attention Problems composite score
    attprob_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("attn"))
    ),
    # Rule-breaking behavior composite score
    rulebreak_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("rule"))
    ),
    # Aggressive behavior composite score
    aggress_comp = rowMeans(
      pc_factor_nolow %>%
        select(contains("aggr"))
    )
  ) %>%
  mutate(
    Int_comp = rowMeans(cbind(
      anxdep_comp,
      withdep_comp,
      soma_comp
    )),
    Ext_comp = rowMeans(cbind(
      rulebreak_comp,
      aggress_comp
    )),
    total_comp = rowMeans(cbind(
      Int_comp,
      socprob_comp,
      thouprob_comp,
      attprob_comp,
      Ext_comp
    ))
  )
```

## Check data

```{r}
pc_factor_nolow_comp <- pc_factor_nolow %>%
  select(
    "participant_id",
    "session_id",
    "anxdep_comp",
    "withdep_comp",
    "soma_comp",
    "socprob_comp",
    "thouprob_comp",
    "attprob_comp",
    "rulebreak_comp",
    "aggress_comp",
    "Int_comp",
    "Ext_comp",
    "total_comp"
  )

# Year 0 (Baseline)

pc_factor_nolow_comp %>%
  filter(session_id == "0") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 1

pc_factor_nolow_comp %>%
  filter(session_id == "1") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 2

pc_factor_nolow_comp %>%
  filter(session_id == "2") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 3

pc_factor_nolow_comp %>%
  filter(session_id == "3") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 4

pc_factor_nolow_comp %>%
  filter(session_id == "4") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 5

pc_factor_nolow_comp %>%
  filter(session_id == "5") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 6

pc_factor_nolow_comp %>%
  filter(session_id == "6") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

## Scaled score: Z score

```{r}
pc_factor_nolow_comp.scaled <- pc_factor_nolow_comp %>%
  mutate_at(scale,
    .vars = c(
      "anxdep_comp",
      "withdep_comp",
      "soma_comp",
      "socprob_comp",
      "thouprob_comp",
      "attprob_comp",
      "rulebreak_comp",
      "aggress_comp",
      "Int_comp",
      "Ext_comp",
      "total_comp"
    ),
    center = TRUE,
    scale = TRUE
  )
```

## Reconstruct Data

### Long form (Scaled)

```{r}
pc_factor_nolow_long.scaled <- pc_factor_nolow_comp.scaled %>%
  pivot_longer(
    cols = c(
      "anxdep_comp",
      "withdep_comp",
      "soma_comp",
      "socprob_comp",
      "thouprob_comp",
      "attprob_comp",
      "rulebreak_comp",
      "aggress_comp",
      "Int_comp",
      "Ext_comp",
      "total_comp"
    ),
    names_to = "variable",
    values_to = "value"
  )

# check duplicate
pc_factor_nolow_long.scaled %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(
    count = sum(!is.na(value)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

### Wide form (Scaled)

```{r}
pc_factor_nolow_wide.scaled <- pc_factor_nolow_comp.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(
      "anxdep_comp",
      "withdep_comp",
      "soma_comp",
      "socprob_comp",
      "thouprob_comp",
      "attprob_comp",
      "rulebreak_comp",
      "aggress_comp",
      "Int_comp",
      "Ext_comp",
      "total_comp"
    )
  )

# check duplicate
pc_factor_nolow_wide.scaled %>%
  select(participant_id) %>%
  dplyr::summarise(
    count = sum(!is.na(participant_id)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

## Descriptive Stat Summary

```{r}
pc_factor_nolow_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

## Plot

#### All symptoms plot

```{r}
# All symptom plots
pc_8symp_plot <- Rmisc::summarySE(
  pc_factor_nolow_long.scaled %>%
    filter(variable %in% c(
      "anxdep_comp", "withdep_comp", "soma_comp",
      "attprob_comp", "thouprob_comp", "socprob_comp",
      "rulebreak_comp", "aggress_comp"
    )),
  measurevar = "value",
  na.rm = T,
  groupvars = c("variable", "session_id")
) %>%
  ggplot(aes(session_id, value,
    color = factor(variable,
      levels = c(
        "anxdep_comp", "withdep_comp", "soma_comp",
        "attprob_comp", "thouprob_comp", "socprob_comp",
        "rulebreak_comp", "aggress_comp", "intru_comp"
      ),
      labels = c(
        "Anxious/Depressed", "Withdrawn/Depressed", "Somatic Complaints",
        "Attention Problems", "Thought Problems", "Social Problems",
        "Rule-Breaking Beh.", "Aggressive Beh.", "Intrusive Beh."
      )
    ),
    group = variable
  )) +
  geom_errorbar(
    aes(x = session_id, y = value, ymin = value - ci, ymax = value + ci),
    alpha = 1, position = position_dodge(width = .5), colour = "black"
  ) +
  stat_summary(fun.y = mean, geom = "line", position = position_dodge(width = .5), linewidth = 1.5, show.legend = TRUE) +
  theme_bw(base_size = 20) +
  labs(color = "Symptom") +
  scale_color_manual(values = c("purple", "navy", "blue", "green", "lightgreen", "yellow2", "orange", "red", "darkred"), drop = FALSE) +
  scale_x_discrete(labels = c("10", "11", "12", "13", "14", "15", "16"))

pc_8symp_plot %>% saveRDS("pc_8symp_plot.rds")
```


```{r}
readRDS("pc_8symp_plot.rds") +
  labs(
    x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
    y = "Children Psychopathology"
  )
```

### p, Int, & Ext plot

```{r}
# p, Internalizing, Externalizing plot

pc_sum_plot <- Rmisc::summarySE(
  pc_factor_nolow_long.scaled %>%
    filter(variable %in% c(
      "Int_comp",
      "Ext_comp",
      "total_comp"
    )),
  measurevar = "value",
  na.rm = T,
  groupvars = c("variable", "session_id")
) %>%
  ggplot(aes(session_id, value, color = variable, group = variable)) +
  geom_errorbar(
    aes(x = session_id, y = value, ymin = value - ci, ymax = value + ci),
    position = position_dodge(width = .5), colour = "black"
  ) +
  stat_summary(fun.y = mean, geom = "line", position = position_dodge(width = .5), linewidth = 1.5) +
  theme_bw(base_size = 20) +
  scale_x_discrete(labels = c("10", "11", "12", "13", "14", "15", "16")) +
  scale_color_discrete(
    name = "Symptom",
    labels = c(
      "Int_comp"     = "Internalizing",
      "Ext_comp"     = "Externalizing",
      "total_comp"   = "General *p* factor"
    )
  ) +
  theme(
    legend.text = ggtext::element_markdown()
  )

pc_sum_plot %>% saveRDS("pc_sum_plot.rds")
```

```{r}
readRDS("pc_sum_plot.rds") +
  labs(
    x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
    y = "Children Psychopathology"
  )
```

# Load ASR (Parent p factor)

```{r}
pp_factor <- abcd6_all %>%
  select(contains(c("_id", "asr"))) %>% # select id & cbcl items
  select(contains(c("_id", "_0"))) %>% # select only items, not sum scores
  select(contains(
    c(
      "_id",
      "aggr", # Aggressive item
      "anxdep", # Anxious/depressed item
      "attn", # Attention item
      "intru", # Intrusive beh item
      "rule", # Rule breaking item
      "som", # Somatic item
      "tho", # Thought item
      "wthdr" # Withdrawn/depressed item
    )
  ))
```

## Valid data N & % in session_id

```{r}
pp_factor %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  }) %>%
  DT::datatable(options = list(pageLength = 10, scrollY = "450px", scrollX = TRUE))

# > 98% availability across all asr items in all 3 time points (0,2,4)
```

## Check Low Freq ASR items

```{r}
pp_lowcheck <- pp_factor

# check total items

pp_lowcheck %>%
  filter(session_id == "0") %>%
  select(contains("asr")) %>%
  ncol() # n of total items = 99

# Check only 0 responses
pp_lowcheck[, 3:ncol(pp_lowcheck)] <- ifelse(pp_lowcheck[, 3:ncol(pp_lowcheck)] == 0, 1, NA)

# Check items with zero response >= 99.5% across all timelines

# Baseline
lowfreq_asr6_b <- pp_lowcheck %>%
  filter(session_id == "0") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 2 Year Follow-up
lowfreq_asr6_2 <- pp_lowcheck %>%
  filter(session_id == "2") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# 4 Year Follow-up
lowfreq_asr6_4 <- pp_lowcheck %>%
  filter(session_id == "4") %>%
  descr(
    stats     = c("n.valid", "pct.valid"),
    transpose = TRUE,
    headings  = FALSE
  ) %>%
  filter(Pct.Valid >= 99.5) %>%
  rownames()

# low frequecy item Summary

# Baseline:
lowfreq_asr6_b # None

# 2Year:
lowfreq_asr6_2 # None

# 4Year:
lowfreq_asr6_4 # None
```

Unlike CBCL, there is no low freq item in ASR

## Calculate Composite scores for ASR

The calculation was based on ASR manual (Achenbach & Rescorla, 2003)
https://aseba.org/wp-content/uploads/2019/02/dsm-adultratings.pdf

![](ASR_Manual.jpg)

```{r}
pp_factor <- pp_factor %>%
  mutate(
    # Anxious/Depressed composite score
    asr_anxdep_comp = rowMeans(
      pp_factor %>%
        select(contains("anxdep"))
    ),
    # Withdrawn/Depressed composite score
    asr_withdep_comp = rowMeans(
      pp_factor %>%
        select(contains("wthdr"))
    ),
    # Somatic complaints composite score
    asr_soma_comp = rowMeans(
      pp_factor %>%
        select(contains("som"))
    ),
    # Thought Problems composite score
    asr_thouprob_comp = rowMeans(
      pp_factor %>%
        select(contains("tho"))
    ),
    # Attention Problems composite score
    asr_attprob_comp = rowMeans(
      pp_factor %>%
        select(contains("attn"))
    ),
    # Rule-breaking behavior composite score
    asr_rulebreak_comp = rowMeans(
      pp_factor %>%
        select(contains("rule"))
    ),
    # Aggressive behavior composite score
    asr_aggress_comp = rowMeans(
      pp_factor %>%
        select(contains("aggr"))
    ),
    # Intrusive composite score
    asr_intru_comp = rowMeans(
      pp_factor %>%
        select(contains("intru"))
    )
  ) %>%
  mutate(
    asr_Int_comp = rowMeans(cbind(
      asr_anxdep_comp,
      asr_withdep_comp,
      asr_soma_comp
    )),
    asr_Ext_comp = rowMeans(cbind(
      asr_rulebreak_comp,
      asr_aggress_comp,
      asr_intru_comp
    )),
    asr_total_comp = rowMeans(cbind(
      asr_Int_comp,
      asr_thouprob_comp,
      asr_attprob_comp,
      asr_Ext_comp
    ))
  )
```

## Check data

```{r}
pp_factor_comp <- pp_factor %>%
  select(
    "participant_id",
    "session_id",
    "asr_anxdep_comp",
    "asr_withdep_comp",
    "asr_soma_comp",
    "asr_thouprob_comp",
    "asr_attprob_comp",
    "asr_rulebreak_comp",
    "asr_aggress_comp",
    "asr_intru_comp",
    "asr_Int_comp",
    "asr_Ext_comp",
    "asr_total_comp"
  ) %>%
  filter(session_id %in% c("0", "2", "4")) # only baseline, 2, and 4 years data


# Year 0 (Baseline)

pp_factor_comp %>%
  filter(session_id == "0") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 2

pp_factor_comp %>%
  filter(session_id == "2") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 4

pp_factor_comp %>%
  filter(session_id == "4") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

## Scaled score: Z score

```{r}
pp_factor_comp.scaled <- pp_factor_comp %>%
  mutate_at(scale,
    .vars = c(
      "asr_anxdep_comp",
      "asr_withdep_comp",
      "asr_soma_comp",
      "asr_thouprob_comp",
      "asr_attprob_comp",
      "asr_rulebreak_comp",
      "asr_aggress_comp",
      "asr_intru_comp",
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
    ),
    center = TRUE,
    scale = TRUE
  )
```

## Reconstruct Data

### Long form (Scaled)

```{r}
pp_factor_long.scaled <- pp_factor_comp.scaled %>%
  pivot_longer(
    cols = c(
      "asr_anxdep_comp",
      "asr_withdep_comp",
      "asr_soma_comp",
      "asr_thouprob_comp",
      "asr_attprob_comp",
      "asr_rulebreak_comp",
      "asr_aggress_comp",
      "asr_intru_comp",
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
    ),
    names_to = "variable",
    values_to = "value"
  )

# check duplicate
pp_factor_long.scaled %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(
    count = sum(!is.na(value)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

### Wide form (Scaled)

```{r}
pp_factor_wide.scaled <- pp_factor_comp.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(
      "asr_anxdep_comp",
      "asr_withdep_comp",
      "asr_soma_comp",
      "asr_thouprob_comp",
      "asr_attprob_comp",
      "asr_rulebreak_comp",
      "asr_aggress_comp",
      "asr_intru_comp",
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
    )
  )

# check duplicate
pp_factor_wide.scaled %>%
  select(participant_id) %>%
  dplyr::summarise(
    count = sum(!is.na(participant_id)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

## Descriptive Stat Summary

```{r}
pp_factor_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "max", "min"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

## Plot

### All symptoms plot

```{r}
# All symptom plots
pp_8symp_plot <- Rmisc::summarySE(
  pp_factor_long.scaled %>%
    filter(variable %in% c(
      "asr_anxdep_comp", "asr_withdep_comp", "asr_soma_comp",
      "asr_attprob_comp", "asr_thouprob_comp",
      "asr_rulebreak_comp", "asr_aggress_comp", "asr_intru_comp"
    )),
  measurevar = "value",
  na.rm = T,
  groupvars = c("variable", "session_id")
) %>%
  ggplot(aes(session_id, value,
    color = factor(variable,
      levels = c(
        "asr_anxdep_comp", "asr_withdep_comp", "asr_soma_comp",
        "asr_attprob_comp", "asr_thouprob_comp", "asr_socprob_comp",
        "asr_rulebreak_comp", "asr_aggress_comp", "asr_intru_comp"
      ),
      labels = c(
        "Anxious/Depressed", "Withdrawn/Depressed", "Somatic Complaints",
        "Attention Problems", "Thought Problems", "Social Problems",
        "Rule-Breaking Beh.", "Aggressive Beh.", "Intrusive Beh."
      )
    ),
    group = variable
  )) +
  geom_errorbar(
    aes(x = session_id, y = value, ymin = value - ci, ymax = value + ci),
    alpha = 1, position = position_dodge(width = .5), colour = "black"
  ) +
  stat_summary(fun.y = mean, geom = "line", position = position_dodge(width = .5), linewidth = 1.5, show.legend = TRUE) +
  theme_bw(base_size = 20) +
  labs(color = "Symptom") +
  scale_color_manual(values = c("purple", "navy", "blue", "green", "lightgreen", "yellow2", "orange", "red", "darkred"), drop = FALSE) +
  scale_x_discrete(labels = c("10", "12", "14"))


pp_8symp_plot %>% saveRDS("pp_8symp_plot.rds")
```

```{r}
readRDS("pp_8symp_plot.rds") +
  labs(
    x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
    y = "Parental Psychopathology"
  )
```

### p, Int & Ext plot

```{r}
pp_sum_plot <- Rmisc::summarySE(
  pp_factor_long.scaled %>%
    filter(variable %in% c(
      "asr_Int_comp",
      "asr_Ext_comp",
      "asr_total_comp"
    )),
  measurevar = "value",
  na.rm = T,
  groupvars = c("variable", "session_id")
) %>%
  ggplot(aes(session_id, value, color = variable, group = variable)) +
  geom_errorbar(
    aes(x = session_id, y = value, ymin = value - ci, ymax = value + ci),
    alpha = 1, position = position_dodge(width = .5), colour = "black"
  ) +
  stat_summary(fun.y = mean, geom = "line", position = position_dodge(width = .5), linewidth = 1.5) +
  theme_bw(base_size = 20) +
  scale_x_discrete(labels = c("10", "12", "14")) +
  scale_color_discrete(
    name = "Symptom",
    labels = c(
      "asr_Int_comp"     = "Internalizing",
      "asr_Ext_comp"     = "Externalizing",
      "asr_total_comp"   = "General *p* factor"
    )
  ) +
  theme(
    legend.text = ggtext::element_markdown()
  )

pp_sum_plot %>% saveRDS("pp_sum_plot.rds")
```

```{r}
readRDS("pp_sum_plot.rds") +
  labs(
    x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
    y = "Parental Psychopathology"
  )
```

# pc & pp Visualization

## Symptoms plot

```{r}
#| warning: false

ggpubr::ggarrange(
  readRDS("pc_8symp_plot.rds") +
    guides(color = guide_legend(nrow = 3)) +
    labs(
      x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
      y = "Children Psychopathology"
    ),
  readRDS("pp_8symp_plot.rds") +
    labs(
      x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
      y = "Parental Psychopathology"
    ),
  common.legend = TRUE,
  legend = "bottom",
  ncol = 2,
  nrow = 1
)
```

## Int, Ext, & p plot

```{r}
#| warning: false

ggpubr::ggarrange(
  readRDS("pc_sum_plot.rds") +
    labs(
      x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
      y = "Children Psychopathology"
    ),
  readRDS("pp_sum_plot.rds") +
    labs(
      x = expression("Time points (" * italic(M)["age"] * ", y/o)"),
      y = "Parental Psychopathology"
    ),
  common.legend = TRUE,
  legend = "bottom",
  ncol = 2,
  nrow = 1
)
```

# Load Puberty

```{r}
puberty6 <- abcd6_all %>%
  select(
    contains(c("_id", "pds_00", "_mean")), # select id & pds mean score items
    "ph_p_pds__m_001", "ph_p_pds__m_002", # select pds male items (parent report)
    "ph_p_pds__f_001", "ph_p_pds__f_002", # select pds female items (parent report)
    "ph_y_pds__m_001", "ph_y_pds__m_002", # select pds male items (youth report)
    "ph_y_pds__f_001", "ph_y_pds__f_002" # select pds female items (youth report)
  ) %>%
  mutate(
    ph_p_pds_mean = coalesce(
      ph_p_pds__f_mean,
      ph_p_pds__m_mean
    ), # combine mean male and female scores into one in parent report
    ph_y_pds_mean = coalesce(
      ph_y_pds__f_mean,
      ph_y_pds__m_mean
    )
  ) # combine mean male and female scores into one in youth report
```

## Valid data N & % in session_id

```{r}
puberty6 %>%
  pivot_longer(where(is.numeric), names_to = "variable", values_to = "value") %>%
  group_by(session_id, variable) %>%
  dplyr::summarise(N = sum(!is.na(value)), Pct = round(mean(!is.na(value)) * 100, 2), .groups = "drop") %>%
  pivot_wider(
    names_from = session_id,
    values_from = c(N, Pct),
    names_glue = "{.value}_{session_id}"
  ) %>%
  relocate(variable, {
    sessions <- str_remove(names(.)[-1], "^(N|Pct)_") %>% unique()
    as.vector(rbind(
      paste0("N_", sessions),
      paste0("Pct_", sessions)
    ))
  }) %>%
  knitr::kable()

# > 97% availability across all neutral items in all 7 time points (0-6)
# Male and female items' percentage add up to > 97% availability as well
```

## replace 777 & 999 with NA

```{r}
for (a in 3:22) {
  puberty6[, a] <-
    ifelse(puberty6[, a] > 100, NA, puberty6[, a])
}

# Checking
puberty6 %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

## recode Values in f_002 items (menstruattion):

"0" (No) –> "1"

"1" (Yes) –> "4"

```{r}
puberty6 <- puberty6 %>%
  mutate(
    ph_p_pds__f_002 = recode(ph_p_pds__f_002,
      "0" = 1,
      "1" = 4,
      .default = NA_real_
    ),
    ph_y_pds__f_002 = recode(ph_y_pds__f_002,
      "0" = 1,
      "1" = 4,
      .default = NA_real_
    )
  )

# Checking
puberty6 %>%
  select(ph_p_pds__f_002, ph_y_pds__f_002) %>%
  freq() %>%
  knitr::kable()
```

## Calculate average scores for gender-specific items

Gender-specific items in Parent report

Male
ph_p_pds__m_001: Have you noticed a deepening of your child's voice?
ph_p_pds__m_002: Have you noticed that your child has begun to grow hair on their face?

Female
ph_p_pds__f_001: Have you noticed that your child's breasts have begun to grow?
ph_p_pds__f_002: Has your child begun to menstruate?

Gender-specific items in Youth report

Male
ph_y_pds__m_001: Have you noticed a deepening of your voice?
ph_y_pds__m_002: Have you begun to grow hair on your face?

Female
ph_y_pds__f_001: Have you noticed that your breasts have begun to grow?
ph_y_pds__f_002: Have you begun to menstruate (started to have your period)?

```{r}
#| warning: False

puberty6 <- puberty6 %>%
  mutate(
    # Gender-specific items in Parent report
    ph_p_pds_mf = rowMeans(
      puberty6 %>%
        select(
          "ph_p_pds__m_001",
          "ph_p_pds__m_002",
          "ph_p_pds__f_001",
          "ph_p_pds__f_002",
        ),
      na.rm = T
    ),
    # Gender-specific items in Youth report
    ph_y_pds_mf = rowMeans(
      puberty6 %>%
        select(
          "ph_y_pds__m_001",
          "ph_y_pds__m_002",
          "ph_y_pds__f_001",
          "ph_y_pds__f_002",
        ),
      na.rm = T
    )
  )

# Checking
puberty6 %>%
  select(ph_p_pds_mf, ph_y_pds_mf) %>%
  freq() %>%
  knitr::kable()
```

## Check data

```{r}
pub_yp_mean <- puberty6 %>%
  select(
    "participant_id",
    "session_id",
    "ph_p_pds_001",
    "ph_p_pds_002",
    "ph_p_pds_003",
    "ph_p_pds__f_001",
    "ph_p_pds__f_002",
    "ph_p_pds__m_001",
    "ph_p_pds__m_002",
    "ph_p_pds_mf",
    "ph_p_pds_mean",
    "ph_y_pds_001",
    "ph_y_pds_002",
    "ph_y_pds_003",
    "ph_y_pds__f_001",
    "ph_y_pds__f_002",
    "ph_y_pds__m_001",
    "ph_y_pds__m_002",
    "ph_y_pds_mf",
    "ph_y_pds_mean"
  )


# Year 0 (Baseline)

pub_yp_mean %>%
  filter(session_id == "0") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 1

pub_yp_mean %>%
  filter(session_id == "1") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  )

# Year 2

pub_yp_mean %>%
  filter(session_id == "2") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 3

pub_yp_mean %>%
  filter(session_id == "3") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 4

pub_yp_mean %>%
  filter(session_id == "4") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 5

pub_yp_mean %>%
  filter(session_id == "5") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()

# Year 6

pub_yp_mean %>%
  filter(session_id == "6") %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd", "min", "max"),
    transpose = T,
    headings = F
  ) %>%
  knitr::kable()
```

### Missing Visualization 

```{r}
# Baseline
pub_yp_mean %>%
  filter(session_id == "0") %>%
  visdat::vis_miss()

# 1-year follow-up
pub_yp_mean %>%
  filter(session_id == "1") %>%
  visdat::vis_miss()

# 2-year follow-up
pub_yp_mean %>%
  filter(session_id == "2") %>%
  visdat::vis_miss()

# 3-year follow-up
pub_yp_mean %>%
  filter(session_id == "3") %>%
  visdat::vis_miss()

# 4-year follow-up
pub_yp_mean %>%
  filter(session_id == "4") %>%
  visdat::vis_miss()

# 5-year follow-up
pub_yp_mean %>%
  filter(session_id == "5") %>%
  visdat::vis_miss()

# 6-year follow-up
pub_yp_mean %>%
  filter(session_id == "6") %>%
  visdat::vis_miss()
```

## Scaled score: Z score

```{r}
# Scale into Z-score across all time points

pub_yp_mean.scaled <- pub_yp_mean %>%
  mutate_at(scale,
    .vars = c(
      "ph_p_pds_001",
      "ph_p_pds_002",
      "ph_p_pds_003",
      "ph_p_pds__f_001",
      "ph_p_pds__f_002",
      "ph_p_pds__m_001",
      "ph_p_pds__m_002",
      "ph_p_pds_mf",
      "ph_p_pds_mean",
      "ph_y_pds_001",
      "ph_y_pds_002",
      "ph_y_pds_003",
      "ph_y_pds__f_001",
      "ph_y_pds__f_002",
      "ph_y_pds__m_001",
      "ph_y_pds__m_002",
      "ph_y_pds_mf",
      "ph_y_pds_mean"
    ),
    center = TRUE,
    scale = TRUE
  )
```

## Reconstruct Data

#### Long form (Scaled)

```{r}
pub_yp_mean_long.scaled <- pub_yp_mean.scaled %>%
  pivot_longer(
    cols = starts_with("ph_"), # all pds columns
    names_to = c("rater", "item"), # create two new columns
    names_pattern = "ph_(.)_pds_(.*)", # (.) captures y or p, (.*) captures the rest
    values_to = "value"
  )

# check duplicate
pub_yp_mean_long.scaled %>%
  group_by(rater, item, session_id) %>%
  dplyr::summarise(
    count = sum(!is.na(value)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

#### Wide form (Scaled)

```{r}
pub_yp_mean_wide.scaled <- pub_yp_mean.scaled %>%
  pivot_wider(
    names_from = session_id,
    values_from = starts_with("ph_")
  )


# check duplicate
pub_yp_mean_wide.scaled %>%
  select(participant_id) %>%
  dplyr::summarise(
    count = sum(!is.na(participant_id)),
    duplicate = any(duplicated(participant_id))
  ) %>%
  knitr::kable()
```

## Descriptive Stat Summary

```{r}
pub_yp_mean_wide.scaled %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd"),
    transpose = T,
    headings = F
  ) %>%
  DT::datatable(options = list(pageLength = 10, scrollY = "450px", scrollX = TRUE))

pub_yp_mean %>%
  pivot_wider(
    names_from = session_id,
    values_from = starts_with("ph_")
  ) %>%
  descr(
    stats = c("N.Valid", "Pct.Valid", "mean", "sd"),
    transpose = T,
    headings = F
  ) %>%
  DT::datatable(options = list(pageLength = 10, scrollY = "450px", scrollX = TRUE))
```

## Plot

```{r}
puberty_plot <- Rmisc::summarySE(
  pub_yp_mean_long.scaled %>%
    mutate(
      item = factor(
        item,
        levels = c("001", "002", "003", "_f_001", "_f_002", "_m_001", "_m_002", "mean"),
        labels = c("item1", "item2", "item3", "female1", "female2", "male1", "male2", "Avarage")
      ),
      rater = factor(
        rater,
        levels = c("p", "y"),
        labels = c("Parent", "Youth")
      )
    ),
  measurevar = "value",
  na.rm = T,
  groupvars = c("rater", "item", "session_id")
) %>%
  filter(!is.na(item)) %>%
  ggplot(aes(session_id, value, color = item, group = item)) +
  geom_errorbar(
    aes(x = session_id, y = value, ymin = value - ci, ymax = value + ci),
    alpha = 1, position = position_dodge(width = .5), colour = "black"
  ) +
  stat_summary(fun.y = mean, geom = "line", position = position_dodge(width = .5), linewidth = 1.5) +
  theme_bw(base_size = 20) +
  ylab("Puberty Score") +
  scale_x_discrete(labels = c("10", "11", "12", "13", "14", "15", "16")) +
  theme(axis.title.x = element_blank()) +
  facet_wrap(~rater, scales = "free_y") +
  theme(axis.title.x = element_text()) +
  labs(x = expression("Time points (" * italic(M)["age"] * ", y/o)"))

puberty_plot %>% saveRDS("puberty_plot.rds")
```

```{r}
readRDS("puberty_plot.rds")
```

# Join all data 

## No sex

```{r}
pga6_wide.allscaled <- plyr::join_all(
  list(
    g_factor_5task_wide.scaled,
    pc_factor_nolow_wide.scaled,
    pp_factor_wide.scaled,
    pub_yp_mean_wide.scaled
  ),
  by = c("participant_id"), type = "full"
)

# check duplicate
pga6_wide.allscaled %>%
  select(participant_id) %>%
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id))) %>%
  knitr::kable()

# n = 11867
```

```{r}
#| eval: False
# Save data for the main analysis
pga6_wide.allscaled %>%
  saveRDS("pga6_all_data.rds")
```

## Add sex

```{r}
pga6_wide.allscaled.sex <- plyr::join_all(
  list(
    readRDS("pga6_all_data.rds"),
    sex6 %>%
      select(participant_id, ab_g_stc__cohort_sex) %>%
      drop_na(ab_g_stc__cohort_sex)
  ),
  by = c("participant_id"), type = "left"
) %>%
  mutate(dummy_sex = 2 - as.numeric(ab_g_stc__cohort_sex))

# check duplicate
pga6_wide.allscaled.sex %>%
  select(participant_id, dummy_sex) %>%
  group_by(dummy_sex) %>%
  dplyr::summarise(count = dplyr::n(), duplicate = any(duplicated(participant_id))) %>%
  knitr::kable()

# total n = 5678 + 6189 = 11867
```

```{r}
#| eval: False
# Save data for the main analysis
pga6_wide.allscaled.sex %>%
  saveRDS("pga6_all_data_sex.rds")
```

# Main Analysis

## Measurement invariance test

### g factor

#### Configural invariance model

##### model fit

```{r}
#| eval: False

g.4t.config.invar <- "#factor loadings # S & S2
               g_etaB =~ lambda_S*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ lambda_S2*flanker_2+
                       lambda_R2*pattern_2+
                       lambda_M2*picture_2+
                       lambda_P2*picvocab_2+
                       lambda_V2*reading_2
               g_eta4 =~ lambda_S4*flanker_4+
                       lambda_R4*pattern_4+
                       lambda_M4*picture_4+
                       lambda_P4*picvocab_4+
                       lambda_V4*reading_4
               g_eta6 =~ lambda_S6*flanker_6+
                       lambda_R6*pattern_6+
                       lambda_M6*picture_6+
                       lambda_P6*picvocab_6+
                       lambda_V6*reading_6

              #latent variable variances # 1*
                      g_etaB~~1*g_etaB
                      g_eta2~~1*g_eta2
                      g_eta4~~1*g_eta4
                      g_eta6~~1*g_eta6

              #latent variable covariances
                      g_etaB~~g_eta2 + g_eta4 + g_eta6
                      g_eta2~~g_eta4 + g_eta6
                      g_eta4~~g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Mental flexibility
                      flanker_0~~pattern_0 + pattern_2 + pattern_4 + pattern_6
                      flanker_2~~pattern_2 + pattern_0 + pattern_4 + pattern_6
                      flanker_4~~pattern_4 + pattern_0 + pattern_2 + pattern_6
                      flanker_6~~pattern_6 + pattern_0 + pattern_2 + pattern_4


                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6
                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4

              #latent variable intercepts # 0*1
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S2*1
                      flanker_4~tau_S4*1
                      flanker_6~tau_S6*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R2*1
                      pattern_4~tau_R4*1
                      pattern_6~tau_R6*1
                      picture_0~tau_M*1
                      picture_2~tau_M2*1
                      picture_4~tau_M4*1
                      picture_6~tau_M6*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P2*1
                      picvocab_4~tau_P4*1
                      picvocab_6~tau_P6*1
                      reading_0~tau_V*1
                      reading_2~tau_V2*1
                      reading_4~tau_V4*1
                      reading_6~tau_V6*1"

lavaan(g.4t.config.invar,
  data = g_factor_5task_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("g_4t_config.rds")
```

##### result

```{r}
#| eval: False
readRDS("g_4t_config.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("g_4t_config_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("g_4t_config.rds"), "cor.lv"))$value

readRDS("g_4t_config_result.rds")
```

#### Weak invariance model

##### model fit

```{r}
#| eval: False

g.4t.weak.invar <- "#factor loadings # S & S2
               g_etaB =~ lambda_S*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ lambda_S*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ lambda_S*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ lambda_S*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances # 1*
                       g_etaB~~1*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #latent variable covariances
                      g_etaB~~g_eta2 + g_eta4 + g_eta6
                      g_eta2~~g_eta4 + g_eta6
                      g_eta4~~g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6
                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6
                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6
                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6
                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6
                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6
                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6
                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6
                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Mental flexibility
                      flanker_0~~pattern_0
                      flanker_2~~pattern_2
                      flanker_4~~pattern_4
                      flanker_6~~pattern_6
                      flanker_0~~pattern_2 + pattern_4 + pattern_6
                      flanker_2~~pattern_0 + pattern_4 + pattern_6
                      flanker_4~~pattern_0 + pattern_2 + pattern_6
                      flanker_6~~pattern_0 + pattern_2 + pattern_4

                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6
                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4

              #latent variable intercepts # 0*1
                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S2*1
                      flanker_4~tau_S4*1
                      flanker_6~tau_S6*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R2*1
                      pattern_4~tau_R4*1
                      pattern_6~tau_R6*1
                      picture_0~tau_M*1
                      picture_2~tau_M2*1
                      picture_4~tau_M4*1
                      picture_6~tau_M6*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P2*1
                      picvocab_4~tau_P4*1
                      picvocab_6~tau_P6*1
                      reading_0~tau_V*1
                      reading_2~tau_V2*1
                      reading_4~tau_V4*1
                      reading_6~tau_V6*1"

lavaan(g.4t.weak.invar,
  data = g_factor_5task_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("g_4t_weak.rds")
```

##### result

```{r}
#| eval: False
readRDS("g_4t_weak.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("g_4t_weak_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("g_4t_weak.rds"), "cor.lv"))$value

readRDS("g_4t_weak_result.rds")
```

#### Strong invariance model

##### model fit

```{r}
#| eval: False

g.4t.strong.invar <- "#factor loadings # S & S2
               g_etaB =~ lambda_S*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ lambda_S*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ lambda_S*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ lambda_S*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances # 1*
                       g_etaB~~1*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

               #latent variable covariances
                      g_etaB~~g_eta2 + g_eta4 + g_eta6
                      g_eta2~~g_eta4 + g_eta6
                      g_eta4~~g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6

                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4

              #latent variable intercepts # m*1
                      g_etaB~0*1
                      g_eta2~m2*1
                      g_eta4~m4*1
                      g_eta6~m6*1

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1"

lavaan(g.4t.strong.invar,
  data = g_factor_5task_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("g_4t_strong.rds")
```

##### result

```{r}
#| eval: False
readRDS("g_4t_strong.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("g_4t_strong_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("g_4t_strong.rds"), "cor.lv"))$value

readRDS("g_4t_strong_result.rds")
```

#### Latent growth curve model

##### model fit

```{r}
#| eval: False

lg.g.4t.strong.invar <- "#factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0
                      picvocab_2~~reading_2
                      picvocab_4~~reading_4
                      picvocab_6~~reading_6

                      picvocab_0~~reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1"

lavaan(lg.g.4t.strong.invar,
  data = g_factor_5task_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lg_g_4t_strong.rds")

lavaan(lg.g.4t.strong.invar,
  data = g_factor_5task_wide.scaled,
  meanstructure = TRUE,
  estimator = "MLR",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lg_g_4t_strongR.rds")
```

##### result

```{r}
#| eval: False
readRDS("lg_g_4t_strong.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lgcm_g_4t_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lg_g_4t_strong.rds"), "cor.lv"))$value

readRDS("lgcm_g_4t_result.rds")
```

##### ICC

```{r}
#| eval: False
lavPredict(readRDS("lg_g_4t_strong.rds"),
  newdata = g_factor_5task_wide.scaled,
  append.data = T
) %>%
  data.frame() %>%
  select(contains(c("g_eta"))) %>%
  ICC(lmer = T) %>%
  saveRDS("g_4t_icc.rds")
```

```{r}
readRDS("g_4t_icc.rds") %>%
  {
    \(x) x$results
  }() %>%
  knitr::kable()
```

##### LGCM plot

```{r}
# create function to plot latent grwoth curve plot
lgcm_plot <- function(fit) {
  pe <- parameterEstimates(fit) # Store parameter estimates in a variable

  # Define the i, s, q equation parameters
  intercept <- pe %>%
    filter(str_length(lhs) <= 4 & str_detect(lhs, "_i") & str_detect(op, "~1")) %>%
    select(est) %>%
    pull()

  slope <- pe %>%
    filter(str_length(lhs) <= 4 & str_detect(lhs, "_s") & str_detect(op, "~1")) %>%
    select(est) %>%
    pull()

  # Check if there is a quadratic component
  if (any(str_detect(pe$lhs, "_q"))) {
    quadratic <- pe %>%
      filter(str_length(lhs) <= 4 & str_detect(lhs, "_q") & str_detect(op, "~1")) %>%
      select(est) %>%
      pull()
  } else {
    quadratic <- 0 # Set to zero if the quadratic component is missing
  }

  # Generate equation
  x <- pe %>%
    filter(str_length(lhs) <= 4 & str_detect(lhs, "_s") & str_detect(op, "=~")) %>%
    select(est) %>%
    pull()
  y <- intercept + slope * x + quadratic * x^2

  # Create a data frame
  df <- data.frame(x = x, y = y)

  # Create the line graph using ggplot2
  plot <- ggplot(df, aes(x = x, y = y)) +
    geom_line(size = 1, colour = "red") +
    theme_bw(base_size = 30) +
    xlab("Age (years old)")

  # Display the plot
  return(plot)
}

lgcm_plot(readRDS("lg_g_4t_strong.rds")) +
  labs(y = "Children's\nCognitive Functioning") +
  scale_x_continuous(labels = c("10", "12", "14", "16")) +
  # add significant results for intercept and slope
  annotate(geom = "text", x = 2.4, y = -0.3, label = 'paste(" ",italic("i")," = -.640***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = -0.5, label = 'paste(italic("s")," =  .473***")', parse = TRUE, size = 10)
```

#### Model comparison

```{r}
lapply(
  c(
    "g_4t_config_result.rds",
    "g_4t_weak_result.rds",
    "g_4t_strong_result.rds",
    "lgcm_g_4t_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM"), ., row.names = NULL) %>%
  knitr::kable()
```

### pc factor

#### Configural invariance model

##### model fit

```{r}
#| eval: False
pc.7t.config.invar <- "#factor loadings (with constraints)
               p_etaB =~ lambda_X0*anxdep_comp_0+
                         lambda_W0*withdep_comp_0+
                         lambda_S0*soma_comp_0+
                         lambda_C0*socprob_comp_0+
                         lambda_H0*thouprob_comp_0+
                         lambda_A0*attprob_comp_0+
                         lambda_R0*rulebreak_comp_0+
                         lambda_G0*aggress_comp_0

               p_eta1 =~ lambda_X1*anxdep_comp_1+
                         lambda_W1*withdep_comp_1+
                         lambda_S1*soma_comp_1+
                         lambda_C1*socprob_comp_1+
                         lambda_H1*thouprob_comp_1+
                         lambda_A1*attprob_comp_1+
                         lambda_R1*rulebreak_comp_1+
                         lambda_G1*aggress_comp_1

               p_eta2 =~ lambda_X2*anxdep_comp_2+
                         lambda_W2*withdep_comp_2+
                         lambda_S2*soma_comp_2+
                         lambda_C2*socprob_comp_2+
                         lambda_H2*thouprob_comp_2+
                         lambda_A2*attprob_comp_2+
                         lambda_R2*rulebreak_comp_2+
                         lambda_G2*aggress_comp_2

               p_eta3 =~ lambda_X3*anxdep_comp_3+
                         lambda_W3*withdep_comp_3+
                         lambda_S3*soma_comp_3+
                         lambda_C3*socprob_comp_3+
                         lambda_H3*thouprob_comp_3+
                         lambda_A3*attprob_comp_3+
                         lambda_R3*rulebreak_comp_3+
                         lambda_G3*aggress_comp_3

               p_eta4 =~ lambda_X4*anxdep_comp_4+
                         lambda_W4*withdep_comp_4+
                         lambda_S4*soma_comp_4+
                         lambda_C4*socprob_comp_4+
                         lambda_H4*thouprob_comp_4+
                         lambda_A4*attprob_comp_4+
                         lambda_R4*rulebreak_comp_4+
                         lambda_G4*aggress_comp_4

               p_eta5 =~ lambda_X5*anxdep_comp_5+
                         lambda_W5*withdep_comp_5+
                         lambda_S5*soma_comp_5+
                         lambda_C5*socprob_comp_5+
                         lambda_H5*thouprob_comp_5+
                         lambda_A5*attprob_comp_5+
                         lambda_R5*rulebreak_comp_5+
                         lambda_G5*aggress_comp_5

               p_eta6 =~ lambda_X6*anxdep_comp_6+
                         lambda_W6*withdep_comp_6+
                         lambda_S6*soma_comp_6+
                         lambda_C6*socprob_comp_6+
                         lambda_H6*thouprob_comp_6+
                         lambda_A6*attprob_comp_6+
                         lambda_R6*rulebreak_comp_6+
                         lambda_G6*aggress_comp_6

              #latent variable variances
                      p_etaB~~1*p_etaB
                      p_eta1~~1*p_eta1
                      p_eta2~~1*p_eta2
                      p_eta3~~1*p_eta3
                      p_eta4~~1*p_eta4
                      p_eta5~~1*p_eta5
                      p_eta6~~1*p_eta6

              #latent variable covariances
                      p_etaB~~p_eta1 + p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta1~~p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta2~~p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta3~~p_eta4 + p_eta5 + p_eta6
                      p_eta4~~p_eta5 + p_eta6
                      p_eta5~~p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

                      #latent variable intercepts
                      p_etaB~0*1
                      p_eta1~0*1
                      p_eta2~0*1
                      p_eta3~0*1
                      p_eta4~0*1

              #observed variable intercepts
                      anxdep_comp_0~tau_X0*1
                      anxdep_comp_1~tau_X1*1
                      anxdep_comp_2~tau_X2*1
                      anxdep_comp_3~tau_X3*1
                      anxdep_comp_4~tau_X4*1
                      anxdep_comp_5~tau_X5*1
                      anxdep_comp_6~tau_X6*1
                      withdep_comp_0~tau_W0*1
                      withdep_comp_1~tau_W1*1
                      withdep_comp_2~tau_W2*1
                      withdep_comp_3~tau_W3*1
                      withdep_comp_4~tau_W4*1
                      withdep_comp_5~tau_W5*1
                      withdep_comp_6~tau_W6*1
                      soma_comp_0~tau_S0*1
                      soma_comp_1~tau_S1*1
                      soma_comp_2~tau_S2*1
                      soma_comp_3~tau_S3*1
                      soma_comp_4~tau_S4*1
                      soma_comp_5~tau_S5*1
                      soma_comp_6~tau_S6*1
                      socprob_comp_0~tau_P0*1
                      socprob_comp_1~tau_P1*1
                      socprob_comp_2~tau_P2*1
                      socprob_comp_3~tau_P3*1
                      socprob_comp_4~tau_P4*1
                      socprob_comp_5~tau_P5*1
                      socprob_comp_6~tau_P6*1
                      thouprob_comp_0~tau_H0*1
                      thouprob_comp_1~tau_H1*1
                      thouprob_comp_2~tau_H2*1
                      thouprob_comp_3~tau_H3*1
                      thouprob_comp_4~tau_H4*1
                      thouprob_comp_5~tau_H5*1
                      thouprob_comp_6~tau_H6*1
                      attprob_comp_0~tau_A0*1
                      attprob_comp_1~tau_A1*1
                      attprob_comp_2~tau_A2*1
                      attprob_comp_3~tau_A3*1
                      attprob_comp_4~tau_A4*1
                      attprob_comp_5~tau_A5*1
                      attprob_comp_6~tau_A6*1
                      rulebreak_comp_0~tau_R0*1
                      rulebreak_comp_1~tau_R1*1
                      rulebreak_comp_2~tau_R2*1
                      rulebreak_comp_3~tau_R3*1
                      rulebreak_comp_4~tau_R4*1
                      rulebreak_comp_5~tau_R5*1
                      rulebreak_comp_6~tau_R6*1
                      aggress_comp_0~tau_G0*1
                      aggress_comp_1~tau_G1*1
                      aggress_comp_2~tau_G2*1
                      aggress_comp_3~tau_G3*1
                      aggress_comp_4~tau_G4*1
                      aggress_comp_5~tau_G5*1
                      aggress_comp_6~tau_G6*1"

lavaan(pc.7t.config.invar,
  data = pc_factor_nolow_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("pc_7t_config.rds")
```

##### result

```{r}
#| eval: False
readRDS("pc_7t_config.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pc_7t_config_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pc_7t_config.rds"), "cor.lv"))$value

readRDS("pc_7t_config_result.rds")
```

#### Weak invariance model

##### model fit

```{r}
#| eval: False
pc.7t.weak.invar <- "#factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                         lambda_W*withdep_comp_0+
                         lambda_S*soma_comp_0+
                         lambda_C*socprob_comp_0+
                         lambda_H*thouprob_comp_0+
                         lambda_A*attprob_comp_0+
                         lambda_R*rulebreak_comp_0+
                         lambda_G*aggress_comp_0

               p_eta1 =~ 1*anxdep_comp_1+
                         lambda_W*withdep_comp_1+
                         lambda_S*soma_comp_1+
                         lambda_C*socprob_comp_1+
                         lambda_H*thouprob_comp_1+
                         lambda_A*attprob_comp_1+
                         lambda_R*rulebreak_comp_1+
                         lambda_G*aggress_comp_1

               p_eta2 =~ 1*anxdep_comp_2+
                         lambda_W*withdep_comp_2+
                         lambda_S*soma_comp_2+
                         lambda_C*socprob_comp_2+
                         lambda_H*thouprob_comp_2+
                         lambda_A*attprob_comp_2+
                         lambda_R*rulebreak_comp_2+
                         lambda_G*aggress_comp_2

               p_eta3 =~ 1*anxdep_comp_3+
                         lambda_W*withdep_comp_3+
                         lambda_S*soma_comp_3+
                         lambda_C*socprob_comp_3+
                         lambda_H*thouprob_comp_3+
                         lambda_A*attprob_comp_3+
                         lambda_R*rulebreak_comp_3+
                         lambda_G*aggress_comp_3

               p_eta4 =~ 1*anxdep_comp_4+
                         lambda_W*withdep_comp_4+
                         lambda_S*soma_comp_4+
                         lambda_C*socprob_comp_4+
                         lambda_H*thouprob_comp_4+
                         lambda_A*attprob_comp_4+
                         lambda_R*rulebreak_comp_4+
                         lambda_G*aggress_comp_4

               p_eta5 =~ 1*anxdep_comp_5+
                         lambda_W*withdep_comp_5+
                         lambda_S*soma_comp_5+
                         lambda_C*socprob_comp_5+
                         lambda_H*thouprob_comp_5+
                         lambda_A*attprob_comp_5+
                         lambda_R*rulebreak_comp_5+
                         lambda_G*aggress_comp_5

               p_eta6 =~ 1*anxdep_comp_6+
                         lambda_W*withdep_comp_6+
                         lambda_S*soma_comp_6+
                         lambda_C*socprob_comp_6+
                         lambda_H*thouprob_comp_6+
                         lambda_A*attprob_comp_6+
                         lambda_R*rulebreak_comp_6+
                         lambda_G*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #latent variable covariances
                      p_etaB~~p_eta1 + p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta1~~p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta2~~p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta3~~p_eta4 + p_eta5 + p_eta6
                      p_eta4~~p_eta5 + p_eta6
                      p_eta5~~p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

                      #latent variable intercepts
                      p_etaB~0*1
                      p_eta1~0*1
                      p_eta2~0*1
                      p_eta3~0*1
                      p_eta4~0*1

              #observed variable intercepts
                      anxdep_comp_0~tau_X0*1
                      anxdep_comp_1~tau_X1*1
                      anxdep_comp_2~tau_X2*1
                      anxdep_comp_3~tau_X3*1
                      anxdep_comp_4~tau_X4*1
                      anxdep_comp_5~tau_X5*1
                      anxdep_comp_6~tau_X6*1
                      withdep_comp_0~tau_W0*1
                      withdep_comp_1~tau_W1*1
                      withdep_comp_2~tau_W2*1
                      withdep_comp_3~tau_W3*1
                      withdep_comp_4~tau_W4*1
                      withdep_comp_5~tau_W5*1
                      withdep_comp_6~tau_W6*1
                      soma_comp_0~tau_S0*1
                      soma_comp_1~tau_S1*1
                      soma_comp_2~tau_S2*1
                      soma_comp_3~tau_S3*1
                      soma_comp_4~tau_S4*1
                      soma_comp_5~tau_S5*1
                      soma_comp_6~tau_S6*1
                      socprob_comp_0~tau_P0*1
                      socprob_comp_1~tau_P1*1
                      socprob_comp_2~tau_P2*1
                      socprob_comp_3~tau_P3*1
                      socprob_comp_4~tau_P4*1
                      socprob_comp_5~tau_P5*1
                      socprob_comp_6~tau_P6*1
                      thouprob_comp_0~tau_H0*1
                      thouprob_comp_1~tau_H1*1
                      thouprob_comp_2~tau_H2*1
                      thouprob_comp_3~tau_H3*1
                      thouprob_comp_4~tau_H4*1
                      thouprob_comp_5~tau_H5*1
                      thouprob_comp_6~tau_H6*1
                      attprob_comp_0~tau_A0*1
                      attprob_comp_1~tau_A1*1
                      attprob_comp_2~tau_A2*1
                      attprob_comp_3~tau_A3*1
                      attprob_comp_4~tau_A4*1
                      attprob_comp_5~tau_A5*1
                      attprob_comp_6~tau_A6*1
                      rulebreak_comp_0~tau_R0*1
                      rulebreak_comp_1~tau_R1*1
                      rulebreak_comp_2~tau_R2*1
                      rulebreak_comp_3~tau_R3*1
                      rulebreak_comp_4~tau_R4*1
                      rulebreak_comp_5~tau_R5*1
                      rulebreak_comp_6~tau_R6*1
                      aggress_comp_0~tau_G0*1
                      aggress_comp_1~tau_G1*1
                      aggress_comp_2~tau_G2*1
                      aggress_comp_3~tau_G3*1
                      aggress_comp_4~tau_G4*1
                      aggress_comp_5~tau_G5*1
                      aggress_comp_6~tau_G6*1"

lavaan(pc.7t.weak.invar,
  data = pc_factor_nolow_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("pc_7t_weak.rds")
```

##### result

```{r}
#| eval: False
readRDS("pc_7t_weak.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pc_7t_weak_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pc_7t_weak.rds"), "cor.lv"))$value

readRDS("pc_7t_weak_result.rds")
```

#### Strong invariance model

##### model fit

```{r}
#| eval: False
pc.7t.strong.invar <- "#factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                         lambda_W*withdep_comp_0+
                         lambda_S*soma_comp_0+
                         lambda_C*socprob_comp_0+
                         lambda_H*thouprob_comp_0+
                         lambda_A*attprob_comp_0+
                         lambda_R*rulebreak_comp_0+
                         lambda_G*aggress_comp_0

               p_eta1 =~ 1*anxdep_comp_1+
                         lambda_W*withdep_comp_1+
                         lambda_S*soma_comp_1+
                         lambda_C*socprob_comp_1+
                         lambda_H*thouprob_comp_1+
                         lambda_A*attprob_comp_1+
                         lambda_R*rulebreak_comp_1+
                         lambda_G*aggress_comp_1

               p_eta2 =~ 1*anxdep_comp_2+
                         lambda_W*withdep_comp_2+
                         lambda_S*soma_comp_2+
                         lambda_C*socprob_comp_2+
                         lambda_H*thouprob_comp_2+
                         lambda_A*attprob_comp_2+
                         lambda_R*rulebreak_comp_2+
                         lambda_G*aggress_comp_2

               p_eta3 =~ 1*anxdep_comp_3+
                         lambda_W*withdep_comp_3+
                         lambda_S*soma_comp_3+
                         lambda_C*socprob_comp_3+
                         lambda_H*thouprob_comp_3+
                         lambda_A*attprob_comp_3+
                         lambda_R*rulebreak_comp_3+
                         lambda_G*aggress_comp_3

               p_eta4 =~ 1*anxdep_comp_4+
                         lambda_W*withdep_comp_4+
                         lambda_S*soma_comp_4+
                         lambda_C*socprob_comp_4+
                         lambda_H*thouprob_comp_4+
                         lambda_A*attprob_comp_4+
                         lambda_R*rulebreak_comp_4+
                         lambda_G*aggress_comp_4

               p_eta5 =~ 1*anxdep_comp_5+
                         lambda_W*withdep_comp_5+
                         lambda_S*soma_comp_5+
                         lambda_C*socprob_comp_5+
                         lambda_H*thouprob_comp_5+
                         lambda_A*attprob_comp_5+
                         lambda_R*rulebreak_comp_5+
                         lambda_G*aggress_comp_5

               p_eta6 =~ 1*anxdep_comp_6+
                         lambda_W*withdep_comp_6+
                         lambda_S*soma_comp_6+
                         lambda_C*socprob_comp_6+
                         lambda_H*thouprob_comp_6+
                         lambda_A*attprob_comp_6+
                         lambda_R*rulebreak_comp_6+
                         lambda_G*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #latent variable covariances
                      p_etaB~~p_eta1 + p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta1~~p_eta2 + p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta2~~p_eta3 + p_eta4 + p_eta5 + p_eta6
                      p_eta3~~p_eta4 + p_eta5 + p_eta6
                      p_eta4~~p_eta5 + p_eta6
                      p_eta5~~p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

                      #latent variable intercepts
                      p_etaB~0*1
                      p_eta1~m1*1
                      p_eta2~m2*1
                      p_eta3~m3*1
                      p_eta4~m4*1

              #observed variable intercepts
                      anxdep_comp_0~tau_X*1
                      anxdep_comp_1~tau_X*1
                      anxdep_comp_2~tau_X*1
                      anxdep_comp_3~tau_X*1
                      anxdep_comp_4~tau_X*1
                      anxdep_comp_5~tau_X*1
                      anxdep_comp_6~tau_X*1
                      withdep_comp_0~tau_W*1
                      withdep_comp_1~tau_W*1
                      withdep_comp_2~tau_W*1
                      withdep_comp_3~tau_W*1
                      withdep_comp_4~tau_W*1
                      withdep_comp_5~tau_W*1
                      withdep_comp_6~tau_W*1
                      soma_comp_0~tau_S*1
                      soma_comp_1~tau_S*1
                      soma_comp_2~tau_S*1
                      soma_comp_3~tau_S*1
                      soma_comp_4~tau_S*1
                      soma_comp_5~tau_S*1
                      soma_comp_6~tau_S*1
                      socprob_comp_0~tau_P*1
                      socprob_comp_1~tau_P*1
                      socprob_comp_2~tau_P*1
                      socprob_comp_3~tau_P*1
                      socprob_comp_4~tau_P*1
                      socprob_comp_5~tau_P*1
                      socprob_comp_6~tau_P*1
                      thouprob_comp_0~tau_H*1
                      thouprob_comp_1~tau_H*1
                      thouprob_comp_2~tau_H*1
                      thouprob_comp_3~tau_H*1
                      thouprob_comp_4~tau_H*1
                      thouprob_comp_5~tau_H*1
                      thouprob_comp_6~tau_H*1
                      attprob_comp_0~tau_A*1
                      attprob_comp_1~tau_A*1
                      attprob_comp_2~tau_A*1
                      attprob_comp_3~tau_A*1
                      attprob_comp_4~tau_A*1
                      attprob_comp_5~tau_A*1
                      attprob_comp_6~tau_A*1
                      rulebreak_comp_0~tau_R*1
                      rulebreak_comp_1~tau_R*1
                      rulebreak_comp_2~tau_R*1
                      rulebreak_comp_3~tau_R*1
                      rulebreak_comp_4~tau_R*1
                      rulebreak_comp_5~tau_R*1
                      rulebreak_comp_6~tau_R*1
                      aggress_comp_0~tau_G*1
                      aggress_comp_1~tau_G*1
                      aggress_comp_2~tau_G*1
                      aggress_comp_3~tau_G*1
                      aggress_comp_4~tau_G*1
                      aggress_comp_5~tau_G*1
                      aggress_comp_6~tau_G*1"

lavaan(pc.7t.strong.invar,
  data = pc_factor_nolow_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("pc_7t_strong.rds")
```

##### result

```{r}
#| eval: False
readRDS("pc_7t_strong.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pc_7t_strong_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pc_7t_strong.rds"), "cor.lv"))$value

readRDS("pc_7t_strong_result.rds")
```

#### Latent growth curve model

##### model fit

```{r}
#| eval: False
lg.pc.7t.strong.invar <- "#factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_W*withdep_comp_0+
                       lambda_S*soma_comp_0+
                       lambda_C*socprob_comp_0+
                       lambda_H*thouprob_comp_0+
                       lambda_A*attprob_comp_0+
                       lambda_R*rulebreak_comp_0+
                       lambda_G*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_W*withdep_comp_1+
                       lambda_S*soma_comp_1+
                       lambda_C*socprob_comp_1+
                       lambda_H*thouprob_comp_1+
                       lambda_A*attprob_comp_1+
                       lambda_R*rulebreak_comp_1+
                       lambda_G*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_W*withdep_comp_2+
                       lambda_S*soma_comp_2+
                       lambda_C*socprob_comp_2+
                       lambda_H*thouprob_comp_2+
                       lambda_A*attprob_comp_2+
                       lambda_R*rulebreak_comp_2+
                       lambda_G*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_W*withdep_comp_3+
                       lambda_S*soma_comp_3+
                       lambda_C*socprob_comp_3+
                       lambda_H*thouprob_comp_3+
                       lambda_A*attprob_comp_3+
                       lambda_R*rulebreak_comp_3+
                       lambda_G*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_W*withdep_comp_4+
                       lambda_S*soma_comp_4+
                       lambda_C*socprob_comp_4+
                       lambda_H*thouprob_comp_4+
                       lambda_A*attprob_comp_4+
                       lambda_R*rulebreak_comp_4+
                       lambda_G*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_W*withdep_comp_5+
                       lambda_S*soma_comp_5+
                       lambda_C*socprob_comp_5+
                       lambda_H*thouprob_comp_5+
                       lambda_A*attprob_comp_5+
                       lambda_R*rulebreak_comp_5+
                       lambda_G*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_W*withdep_comp_6+
                       lambda_S*soma_comp_6+
                       lambda_C*socprob_comp_6+
                       lambda_H*thouprob_comp_6+
                       lambda_A*attprob_comp_6+
                       lambda_R*rulebreak_comp_6+
                       lambda_G*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

              #observed variable intercepts
                      anxdep_comp_0~tau_X*1
                      anxdep_comp_1~tau_X*1
                      anxdep_comp_2~tau_X*1
                      anxdep_comp_3~tau_X*1
                      anxdep_comp_4~tau_X*1
                      anxdep_comp_5~tau_X*1
                      anxdep_comp_6~tau_X*1
                      withdep_comp_0~tau_W*1
                      withdep_comp_1~tau_W*1
                      withdep_comp_2~tau_W*1
                      withdep_comp_3~tau_W*1
                      withdep_comp_4~tau_W*1
                      withdep_comp_5~tau_W*1
                      withdep_comp_6~tau_W*1
                      soma_comp_0~tau_S*1
                      soma_comp_1~tau_S*1
                      soma_comp_2~tau_S*1
                      soma_comp_3~tau_S*1
                      soma_comp_4~tau_S*1
                      soma_comp_5~tau_S*1
                      soma_comp_6~tau_S*1
                      socprob_comp_0~tau_P*1
                      socprob_comp_1~tau_P*1
                      socprob_comp_2~tau_P*1
                      socprob_comp_3~tau_P*1
                      socprob_comp_4~tau_P*1
                      socprob_comp_5~tau_P*1
                      socprob_comp_6~tau_P*1
                      thouprob_comp_0~tau_H*1
                      thouprob_comp_1~tau_H*1
                      thouprob_comp_2~tau_H*1
                      thouprob_comp_3~tau_H*1
                      thouprob_comp_4~tau_H*1
                      thouprob_comp_5~tau_H*1
                      thouprob_comp_6~tau_H*1
                      attprob_comp_0~tau_A*1
                      attprob_comp_1~tau_A*1
                      attprob_comp_2~tau_A*1
                      attprob_comp_3~tau_A*1
                      attprob_comp_4~tau_A*1
                      attprob_comp_5~tau_A*1
                      attprob_comp_6~tau_A*1
                      rulebreak_comp_0~tau_R*1
                      rulebreak_comp_1~tau_R*1
                      rulebreak_comp_2~tau_R*1
                      rulebreak_comp_3~tau_R*1
                      rulebreak_comp_4~tau_R*1
                      rulebreak_comp_5~tau_R*1
                      rulebreak_comp_6~tau_R*1
                      aggress_comp_0~tau_G*1
                      aggress_comp_1~tau_G*1
                      aggress_comp_2~tau_G*1
                      aggress_comp_3~tau_G*1
                      aggress_comp_4~tau_G*1
                      aggress_comp_5~tau_G*1
                      aggress_comp_6~tau_G*1

                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      p_etaB ~ 0*1
                      p_eta1 ~ 0*1
                      p_eta2 ~ 0*1
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1"

lavaan(lg.pc.7t.strong.invar,
  data = pc_factor_nolow_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lgcm_pc_7t_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("lgcm_pc_7t_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lgcm_pc_7t_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lgcm_pc_7t_model.rds"), "cor.lv"))$value

readRDS("lgcm_pc_7t_result.rds")
```

##### ICC

```{r}
#| eval: False
lavPredict(readRDS("lgcm_pc_7t_model.rds"),
  newdata = pc_factor_nolow_wide.scaled,
  append.data = T
) %>%
  data.frame() %>%
  select(contains(c("p_eta"))) %>%
  ICC(lmer = T) %>%
  saveRDS("pc_7t_icc.rds")
```

```{r}
readRDS("pc_7t_icc.rds") %>%
  {
    \(x) x$results
  }() %>%
  knitr::kable()
```

##### LGCM plot

```{r}
lgcm_plot(readRDS("lgcm_pc_7t_model.rds")) +
  labs(y = "Children's\nPsychopathology") +
  scale_x_continuous(
    breaks = seq(0, 3, .5),
    labels = c("10", "11", "12", "13", "14", "15", "16")
  ) +
  # add significant results for intercept and slope
  annotate(geom = "text", x = 2.4, y = 0.045, label = 'paste(" ",italic("i")," =  .051***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = 0.02, label = 'paste(italic("s")," = -.049***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = -0.005, label = 'paste(italic("q")," = -.004    ")', parse = TRUE, size = 10)
```

#### Model comparison

```{r}
lapply(
  c(
    "pc_7t_config_result.rds",
    "pc_7t_weak_result.rds",
    "pc_7t_strong_result.rds",
    "lgcm_pc_7t_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM"), ., row.names = NULL) %>%
  knitr::kable()
```

### pc factor symptom model

#### Externalizing model

```{r}
#| eval: False
lg.ext6.strong.invar <- "# basis model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6
                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1"

lavaan(lg.ext6.strong.invar,
  data = pc_factor_nolow_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lgcm_Ext_7t_model.rds")
```

##### result

```{r}
#| eval: False

readRDS("lgcm_Ext_7t_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lgcm_Ext_7t_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lgcm_Ext_7t_model.rds"), "cor.lv"))$value

readRDS("lgcm_Ext_7t_result.rds")
```

##### ICC

```{r}
#| eval: False
lavPredict(readRDS("lgcm_Ext_7t_model.rds"),
  newdata = pc_factor_nolow_wide.scaled,
  append.data = T
) %>%
  data.frame() %>%
  select(contains(c("Ext_comp_"))) %>%
  ICC(lmer = T) %>%
  saveRDS("Ext_pc_7t_icc.rds")
```

```{r}
readRDS("Ext_pc_7t_icc.rds") %>%
  {
    \(x) x$results
  }() %>%
  knitr::kable()
```

##### Growth curve plot

```{r}
lgcm_plot(readRDS("lgcm_Ext_7t_model.rds")) +
  labs(y = "Children's\nExternalizing") +
  scale_x_continuous(
    breaks = seq(0, 3, .5),
    labels = c("10", "11", "12", "13", "14", "15", "16")
  ) +
  coord_cartesian(ylim = c(-.08, 0.08)) +
  annotate(geom = "text", x = 2.4, y = 0.075, label = 'paste(" ",italic("i")," =  .083***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = 0.055, label = 'paste(italic("s")," = -.062***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = 0.035, label = 'paste(italic("q")," =  .004    ")', parse = TRUE, size = 10)
```

#### Internalizing model

```{r}
#| eval: False
lg.int6.strong.invar <- "# basis model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1"

lavaan(lg.int6.strong.invar,
  data = pc_factor_nolow_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lgcm_Int_7t_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("lgcm_Int_7t_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lgcm_Int_7t_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lgcm_Int_7t_model.rds"), "cor.lv"))$value

readRDS("lgcm_Int_7t_result.rds")
```

##### ICC

```{r}
#| eval: False
lavPredict(readRDS("lgcm_Int_7t_model.rds"),
  newdata = pc_factor_nolow_wide.scaled,
  append.data = T
) %>%
  data.frame() %>%
  select(contains(c("Int_comp_"))) %>%
  ICC(lmer = T) %>%
  saveRDS("Int_pc_7t_icc.rds")
```

```{r}
readRDS("Int_pc_7t_icc.rds") %>%
  {
    \(x) x$results
  }() %>%
  knitr::kable()
```

##### Growth curve plot

```{r}
lgcm_plot(readRDS("lgcm_Int_7t_model.rds")) +
  labs(y = "Children's\nInternalizing") +
  scale_x_continuous(
    breaks = seq(0, 3, .5),
    labels = c("10", "11", "12", "13", "14", "15", "16")
  ) +
  coord_cartesian(ylim = c(-.08, 0.08)) +
  annotate(geom = "text", x = 2.4, y = -0.03, label = 'paste(" ",italic("i")," = -.046***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = -0.05, label = 'paste(italic("s")," =  .035***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.4, y = -0.07, label = 'paste(italic("q")," =  .002    ")', parse = TRUE, size = 10)
```

### pp factor

#### Configural invariance model

##### model fit

```{r} 
#| eval: False
pp.3t.config.invar <- "#factor loadings (with constraints)
               a_etaB =~ lambda_AD0*asr_anxdep_comp_0+
                         lambda_AW0*asr_withdep_comp_0+
                         lambda_AS0*asr_soma_comp_0+
                         lambda_AC0*asr_thouprob_comp_0+
                         lambda_AH0*asr_attprob_comp_0+
                         lambda_AA0*asr_rulebreak_comp_0+
                         lambda_AR0*asr_aggress_comp_0+
                         lambda_AG0*asr_intru_comp_0
               a_eta2 =~ lambda_AD2*asr_anxdep_comp_2+
                         lambda_AW2*asr_withdep_comp_2+
                         lambda_AS2*asr_soma_comp_2+
                         lambda_AC2*asr_thouprob_comp_2+
                         lambda_AH2*asr_attprob_comp_2+
                         lambda_AA2*asr_rulebreak_comp_2+
                         lambda_AR2*asr_aggress_comp_2+
                         lambda_AG2*asr_intru_comp_2
               a_eta4 =~ lambda_AD4*asr_anxdep_comp_4+
                         lambda_AW4*asr_withdep_comp_4+
                         lambda_AS4*asr_soma_comp_4+
                         lambda_AC4*asr_thouprob_comp_4+
                         lambda_AH4*asr_attprob_comp_4+
                         lambda_AA4*asr_rulebreak_comp_4+
                         lambda_AR4*asr_aggress_comp_4+
                         lambda_AG4*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~1*a_etaB
                      a_eta2~~1*a_eta2
                      a_eta4~~1*a_eta4

              #latent variable covariances
                      a_etaB~~a_eta2 + a_eta4
                      a_eta2~~a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

                      #latent variable intercepts
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

              #observed variable intercepts
                      asr_aggress_comp_0~tau_AR0*1
                      asr_aggress_comp_2~tau_AR2*1
                      asr_aggress_comp_4~tau_AR4*1

                      asr_anxdep_comp_0~tau_AX0*1
                      asr_anxdep_comp_2~tau_AX2*1
                      asr_anxdep_comp_4~tau_AX4*1

                      asr_attprob_comp_0~tau_AH0*1
                      asr_attprob_comp_2~tau_AH2*1
                      asr_attprob_comp_4~tau_AH4*1

                      asr_intru_comp_0~tau_AG0*1
                      asr_intru_comp_2~tau_AG2*1
                      asr_intru_comp_4~tau_AG4*1

                      asr_rulebreak_comp_0~tau_AA0*1
                      asr_rulebreak_comp_2~tau_AA2*1
                      asr_rulebreak_comp_4~tau_AA4*1

                      asr_soma_comp_0~tau_AS0*1
                      asr_soma_comp_2~tau_AS2*1
                      asr_soma_comp_4~tau_AS4*1

                      asr_thouprob_comp_0~tau_AP0*1
                      asr_thouprob_comp_2~tau_AP2*1
                      asr_thouprob_comp_4~tau_AP4*1

                      asr_withdep_comp_0~tau_AW0*1
                      asr_withdep_comp_2~tau_AW2*1
                      asr_withdep_comp_4~tau_AW4*1"

lavaan(pp.3t.config.invar,
  data = pp_factor_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("pp_3t_config.rds")
```

##### result

```{r}  
#| eval: False
readRDS("pp_3t_config.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pp_3t_config_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pp_3t_config.rds"), "cor.lv"))$value

readRDS("pp_3t_config_result.rds")
```

#### Weak invariance model

##### model fit

```{r}
#| eval: False
pp.3t.weak.invar <- "#factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                         lambda_AW*asr_withdep_comp_0+
                         lambda_AS*asr_soma_comp_0+
                         lambda_AC*asr_thouprob_comp_0+
                         lambda_AH*asr_attprob_comp_0+
                         lambda_AA*asr_rulebreak_comp_0+
                         lambda_AR*asr_aggress_comp_0+
                         lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                         lambda_AW*asr_withdep_comp_2+
                         lambda_AS*asr_soma_comp_2+
                         lambda_AC*asr_thouprob_comp_2+
                         lambda_AH*asr_attprob_comp_2+
                         lambda_AA*asr_rulebreak_comp_2+
                         lambda_AR*asr_aggress_comp_2+
                         lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                         lambda_AW*asr_withdep_comp_4+
                         lambda_AS*asr_soma_comp_4+
                         lambda_AC*asr_thouprob_comp_4+
                         lambda_AH*asr_attprob_comp_4+
                         lambda_AA*asr_rulebreak_comp_4+
                         lambda_AR*asr_aggress_comp_4+
                         lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #latent variable covariances
                      a_etaB~~a_eta2 + a_eta4
                      a_eta2~~a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

                      #latent variable intercepts
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

              #observed variable intercepts
                      asr_aggress_comp_0~tau_AR0*1
                      asr_aggress_comp_2~tau_AR2*1
                      asr_aggress_comp_4~tau_AR4*1

                      asr_anxdep_comp_0~tau_AX0*1
                      asr_anxdep_comp_2~tau_AX2*1
                      asr_anxdep_comp_4~tau_AX4*1

                      asr_attprob_comp_0~tau_AH0*1
                      asr_attprob_comp_2~tau_AH2*1
                      asr_attprob_comp_4~tau_AH4*1

                      asr_intru_comp_0~tau_AG0*1
                      asr_intru_comp_2~tau_AG2*1
                      asr_intru_comp_4~tau_AG4*1

                      asr_rulebreak_comp_0~tau_AA0*1
                      asr_rulebreak_comp_2~tau_AA2*1
                      asr_rulebreak_comp_4~tau_AA4*1

                      asr_soma_comp_0~tau_AS0*1
                      asr_soma_comp_2~tau_AS2*1
                      asr_soma_comp_4~tau_AS4*1

                      asr_thouprob_comp_0~tau_AP0*1
                      asr_thouprob_comp_2~tau_AP2*1
                      asr_thouprob_comp_4~tau_AP4*1

                      asr_withdep_comp_0~tau_AW0*1
                      asr_withdep_comp_2~tau_AW2*1
                      asr_withdep_comp_4~tau_AW4*1"

lavaan(pp.3t.weak.invar,
  data = pp_factor_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("pp_3t_weak.rds")
```

##### result

```{r}
#| eval: False
readRDS("pp_3t_weak.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pp_3t_weak_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pp_3t_weak.rds"), "cor.lv"))$value

readRDS("pp_3t_weak_result.rds")
```

#### Strong invariance model

##### model fit

```{r}
#| eval: False
pp.3t.strong.invar <- "#factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                         lambda_AW*asr_withdep_comp_0+
                         lambda_AS*asr_soma_comp_0+
                         lambda_AC*asr_thouprob_comp_0+
                         lambda_AH*asr_attprob_comp_0+
                         lambda_AA*asr_rulebreak_comp_0+
                         lambda_AR*asr_aggress_comp_0+
                         lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                         lambda_AW*asr_withdep_comp_2+
                         lambda_AS*asr_soma_comp_2+
                         lambda_AC*asr_thouprob_comp_2+
                         lambda_AH*asr_attprob_comp_2+
                         lambda_AA*asr_rulebreak_comp_2+
                         lambda_AR*asr_aggress_comp_2+
                         lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                         lambda_AW*asr_withdep_comp_4+
                         lambda_AS*asr_soma_comp_4+
                         lambda_AC*asr_thouprob_comp_4+
                         lambda_AH*asr_attprob_comp_4+
                         lambda_AA*asr_rulebreak_comp_4+
                         lambda_AR*asr_aggress_comp_4+
                         lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #latent variable covariances
                      a_etaB~~a_eta2 + a_eta4
                      a_eta2~~a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

                      #latent variable intercepts
                      a_etaB~0*1
                      a_eta2~m2*1
                      a_eta4~m4*1

              #observed variable intercepts
                      asr_aggress_comp_0~tau_AR*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_aggress_comp_4~tau_AR*1

                      asr_anxdep_comp_0~tau_AX*1
                      asr_anxdep_comp_2~tau_AX*1
                      asr_anxdep_comp_4~tau_AX*1

                      asr_attprob_comp_0~tau_AH*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_attprob_comp_4~tau_AH*1

                      asr_intru_comp_0~tau_AG*1
                      asr_intru_comp_2~tau_AG*1
                      asr_intru_comp_4~tau_AG*1

                      asr_rulebreak_comp_0~tau_AA*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_rulebreak_comp_4~tau_AA*1

                      asr_soma_comp_0~tau_AS*1
                      asr_soma_comp_2~tau_AS*1
                      asr_soma_comp_4~tau_AS*1

                      asr_thouprob_comp_0~tau_AP*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_thouprob_comp_4~tau_AP*1

                      asr_withdep_comp_0~tau_AW*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_withdep_comp_4~tau_AW*1"

lavaan(pp.3t.strong.invar,
  data = pp_factor_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("pp_3t_strong.rds")
```

##### result

```{r}
#| eval: False
readRDS("pp_3t_strong.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pp_3t_strong_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pp_3t_strong.rds"), "cor.lv"))$value

readRDS("pp_3t_strong_result.rds")
```

#### Latent growth curve model

##### model fit

```{r}
#| eval: False
lg.pp.3t.strong.invar <- "#factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1"

lavaan(lg.pp.3t.strong.invar,
  data = pp_factor_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lgcm_pp_3t_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("lgcm_pp_3t_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lgcm_pp_3t_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lgcm_pp_3t_model.rds"), "cor.lv"))$value

readRDS("lgcm_pp_3t_result.rds")
```

##### ICC

```{r}
#| eval: False
lavPredict(readRDS("lgcm_pp_3t_model.rds"),
  newdata = pp_factor_wide.scaled,
  append.data = T
) %>%
  data.frame() %>%
  select(contains(c("a_eta"))) %>%
  ICC(lmer = T) %>%
  saveRDS("pp_3t_icc.rds")
```

```{r}
readRDS("pp_3t_icc.rds") %>%
  {
    \(x) x$results
  }() %>%
  knitr::kable()
```

##### LGCM plot

```{r}
lgcm_plot(readRDS("lgcm_pp_3t_model.rds")) +
  labs(y = "Parent's\nPsychopathology") +
  scale_x_continuous(
    breaks = seq(0, 2, 1),
    labels = c("10", "12", "14")
  ) +
  # add significant results for intercept and slope
  annotate(geom = "text", x = 1.6, y = 0.025, label = 'paste(" ",italic("i")," =  .026***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 1.6, y = 0.019, label = 'paste(italic("s")," = -.024***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 1.6, y = 0.013, label = 'paste("  ",italic("i"),"-",italic("s")," = -.054***    ")', parse = TRUE, size = 10)
```

#### Model comparison

```{r}
lapply(
  c(
    "pp_3t_config_result.rds",
    "pp_3t_weak_result.rds",
    "pp_3t_strong_result.rds",
    "lgcm_pp_3t_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM"), ., row.names = NULL) %>%
  knitr::kable()
```

## Parallel Latent Growth Curve Modeling

### p factor model

#### pc ~ pp + g model

Children’s psychopathology (pc) was regressed on parental psychopathology (pp) and children’s cognitive functioning (g).

##### model fit 

```{r}
pga6.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1

                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      p_etaB ~ 0*1
                      p_eta1 ~ 0*1
                      p_eta2 ~ 0*1
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"
```

```{r}
#| eval: False
lavaan(pga6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_pga6_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("pgcm_pga6_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_pga6_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_pga6_model.rds"), "cor.lv"))$value

readRDS("pgcm_pga6_result.rds")
```

#### pc ~ pp + g model with sex

Children’s psychopathology (pc) was regressed on parental psychopathology (pp) and children’s cognitive functioning (g), with sex as a covariate.

##### model fit

```{r}
# Add sex as covariate
pga6.sex.model <- pga6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(pga6.sex.model)
```

```{r}
#| eval: False
lavaan(pga6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pga6_sex_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("pgcm_pga6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_pga6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_pga6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_pga6_sex_result.rds")
```

### Symptom model

#### Externalizing symptoms

##### Ext ~ pp + g model

Children’s Externalizing symptoms (Ext) was regressed on parental psychopathology (pp) and children’s cognitive functioning (g).

###### model fit

```{r}
Ext.pga6.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

                      # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q

                      p_i~1
                      p_s~1
                      p_q~1

                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6

                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1

                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"
```

```{r}
#| eval: False
lavaan(Ext.pga6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pga6_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Ext_pga6_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Ext_pga6_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Ext_pga6_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pga6_result.rds")
```

##### Ext ~ pp + g model with sex

Children’s Externalizing symptoms (Ext) was regressed on parental psychopathology (pp) and children’s cognitive functioning (g), with sex as a covariate.

###### model fit

```{r}
#| eval: False
# Add sex as covariate
Ext.pga6.sex.model <- Ext.pga6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(Ext.pga6.sex.model)
```

```{r}
#| eval: False
lavaan(Ext.pga6.sex.model,
  data = pga6_wide.allscaled.sex,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pga6_sex_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Ext_pga6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Ext_pga6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Ext_pga6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pga6_sex_result.rds")
```

#### Internalizing Symptoms

##### Int ~ pp + g model

Children’s Internalizing symptoms (Int) was regressed on parental psychopathology (pp) and children’s cognitive functioning (g).

###### model fit

```{r}
Int.pga6.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

                      # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1

                      # regression
                      p_i ~ g_i + a_i
                      p_s ~ g_i + g_s + a_i + a_s
                      p_q ~ g_i + g_s + a_i + a_s"
```

```{r}
#| eval: False
lavaan(Int.pga6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pga6_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Int_pga6_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Int_pga6_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Int_pga6_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pga6_result.rds")
```

##### Int ~ pp + g model with sex

Children’s Internalizing symptoms (Int) was regressed on parental psychopathology (pp) and children’s cognitive functioning (g), with sex as a covariate.

###### model fit

```{r}
#| eval: False
# Add sex as covariate
Int.pga6.sex.model <- Int.pga6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(Int.pga6.sex.model)
```

```{r}
#| eval: False

lavaan(Int.pga6.sex.model,
  data = pga6_wide.allscaled.sex,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pga6_sex_model.rds")
```

###### result

```{r}
#| eval: False

readRDS("pgcm_Int_pga6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Int_pga6_sex_result.rds")
```

```{r}
# Check model
eigen(inspect(readRDS("pgcm_Int_pga6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pga6_sex_result.rds")
```

### Result summary

#### Model fit indices

```{r}
lapply(
  c(
    "pgcm_pga6_sex_result.rds",
    "pgcm_Ext_pga6_sex_result.rds",
    "pgcm_Int_pga6_sex_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      # "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("pc", "Ext", "Int"), ., row.names = NULL) %>%
  knitr::kable()
```

#### Result

```{r}
model_list <- c(
  "pgcm_pga6_sex_model.rds",
  "pgcm_Ext_pga6_sex_model.rds",
  "pgcm_Int_pga6_sex_model.rds"
)

# combine all significant results

final.pga.sex.result <- data.frame()

for (a in 1:3) {
  final.pga.sex.result <- final.pga.sex.result %>%
    rbind(
      readRDS(paste0(model_list[a])) %>%
        standardizedSolution() %>%
        filter(op == "~") %>%
        filter(rhs != "dummy_sex") %>%
        mutate(label = str_sub(model_list[a], 6, 8))
    )
}

final.pga.sex.result %>%
  mutate(sig = case_when(
    pvalue < .001 ~ "***",
    pvalue < .01 ~ "**",
    pvalue < .05 ~ "*",
    pvalue >= .05 ~ ""
  )) %>%
  mutate(
    std.lv = round(est.std, 3),
    effsize = paste0(std.lv, " [", round(ci.lower, 3), ",", round(ci.upper, 3), "]")
  ) %>%
  select(lhs, op, rhs, label, effsize) %>%
  pivot_wider(
    names_from = label,
    values_from = effsize
  ) %>%
  select(lhs, op, rhs, Int, Ext, pga) %>%
  arrange(desc(rhs)) %>%
  knitr::kable()
```

### Visualization

```{r}
# Create function to plot graph based on specific intercept or slope
para_plot <- function(fit, mod) {
  plot <-
    lavPredict(fit, append.data = T) %>%
    data.frame()

  plot$id <-
    1:nrow(plot)

  # calculating implied manifest scores
  plot$p0 <- 1 * plot$p_i + 0 * plot$p_s + 0 * plot$p_q
  plot$p1 <- 1 * plot$p_i + .5 * plot$p_s + .25 * plot$p_q
  plot$p2 <- 1 * plot$p_i + 1 * plot$p_s + 1 * plot$p_q
  plot$p3 <- 1 * plot$p_i + 1.5 * plot$p_s + 2.25 * plot$p_q
  plot$p4 <- 1 * plot$p_i + 2 * plot$p_s + 4 * plot$p_q
  plot$p5 <- 1 * plot$p_i + 2.5 * plot$p_s + 6.25 * plot$p_q
  plot$p6 <- 1 * plot$p_i + 3 * plot$p_s + 9 * plot$p_q

  # reshaping wide to long
  plot_long <- plot %>%
    select("id", paste0("p", 0:6), mod) %>%
    pivot_longer(
      cols = paste0("p", 0:6),
      names_to = "eventtime",
      names_prefix = "p",
      values_to = "p"
    ) %>%
    mutate(
      eventtime = as.numeric(eventtime), # convert char vars to numeric
      p = as.numeric(p)
    ) %>%
    arrange(id, eventtime) # order by id and time

  plot_long <- plot_long %>%
    mutate(tip_g_i_group = plot_long %>%
      select(paste0(mod)) %>%
      ntile(10)) %>%
    mutate(tip_g_i_group = factor(tip_g_i_group))

  # intraindividual change trajectories
  graph <- plot_long %>% # data set
    ggplot(aes(x = eventtime, y = p, color = tip_g_i_group)) + # setting variables
    # geom_smooth(method = "lm") +
    # geom_line() +                                  #adding lines to plot
    stat_summary(aes(group = tip_g_i_group), geom = "line", fun.y = mean, size = 1) +
    viridis::scale_color_viridis(option = "turbo", discrete = TRUE, begin = .1, end = .9) +
    theme_bw() + # changing style/background
    # setting the x-axis with breaks and labels
    scale_x_continuous(
      breaks = 0:6,
      labels = paste0(10:16)
    ) +
    scale_y_continuous(labels = signs::signs_format(trim_leading_zeros = TRUE)) +
    labs(color = mod) +
    theme(
      axis.title.y = element_blank(),
      axis.title.x = element_blank(),
      plot.title = element_text(hjust = 0.5)
    )

  return(graph)
}
```

#### p, int, ext result plots

```{r}
#| warning: False
ggpubr::annotate_figure(
  ggpubr::annotate_figure(
    ggpubr::ggarrange(
      para_plot(readRDS("pgcm_pga6_sex_model.rds"), "g_i") +
        labs(color = "Decile\nof EV") +
        coord_cartesian(ylim = c(-0.25, 0.5)),
      para_plot(readRDS("pgcm_pga6_sex_model.rds"), "g_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_pga6_sex_model.rds"), "a_i") +
        coord_cartesian(ylim = c(-0.65, 1.5)),
      para_plot(readRDS("pgcm_pga6_sex_model.rds"), "a_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "g_i") +
        coord_cartesian(ylim = c(-0.25, 0.5)),
      para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "g_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "a_i") +
        coord_cartesian(ylim = c(-0.65, 1.5)),
      para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "a_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "g_i") +
        coord_cartesian(ylim = c(-0.25, 0.5)),
      para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "g_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "a_i") +
        coord_cartesian(ylim = c(-0.65, 1.5)),
      para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "a_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      common.legend = TRUE,
      legend = "right",
      ncol = 4,
      nrow = 3
    ),
    top = ggpubr::text_grob("g intercept                            g slope                             pp intercept                         pp slope", hjust = .54, size = 10),
    bottom = ggpubr::text_grob("Age (Years Old)", size = 10),
    left = ggpubr::text_grob("Externalizing                Internalizing                    p factor", size = 10, rot = 90)
  ),
  top = ggpubr::text_grob("Explanatory Variables (EV)", face = "bold", size = 10),
  left = ggpubr::text_grob("Response Variables (RV)", face = "bold", size = 10, rot = 90)
)
```

```{r}
para_plot(readRDS("pgcm_pga6_sex_model.rds"), "g_i") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.25, 0.5))
para_plot(readRDS("pgcm_pga6_sex_model.rds"), "g_s") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.4, 1))
para_plot(readRDS("pgcm_pga6_sex_model.rds"), "a_i") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.65, 1.5))
para_plot(readRDS("pgcm_pga6_sex_model.rds"), "a_s") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.4, 1))

para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "g_i") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.25, 0.5))
para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "g_s") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.4, 1))
para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "a_i") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.65, 1.5))
para_plot(readRDS("pgcm_Int_pga6_sex_model.rds"), "a_s") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.4, 1))

para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "g_i") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.25, 0.5))
para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "g_s") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.4, 1))
para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "a_i") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.65, 1.5))
para_plot(readRDS("pgcm_Ext_pga6_sex_model.rds"), "a_s") +
  theme(
    text = element_text(size = 60),
    legend.position = "none"
  ) +
  coord_cartesian(ylim = c(-0.4, 1))
```

## Commonality analysis

Our main models are models explained by pp and g 

To determine how much variance in pc is uniquely explained by g, uniquely explained by pp, and jointly explained by both, we need two reduced models:

1. model explained by g only
and
2. model explained by pp only

These models allow calculation of Unique g, Unique pp, and their Shared (Common) variance in explaining children's psychopathology, externalizing and internalizing symptoms.

### p factor model

#### pc ~ g model with sex

Children’s psychopathology (pc) was regressed on children’s cognitive functioning (g), with sex as a covariate.

##### model fit

```{r}
#| eval: false
pg6.sex.model <- "
               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1

                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      p_etaB ~ 0*1
                      p_eta1 ~ 0*1
                      p_eta2 ~ 0*1
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1 + dummy_sex
                      g_s~1 + dummy_sex

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

                      # regression
                      p_i ~ g_i
                      p_s ~ g_i + g_s
                      p_q ~ g_i + g_s"

lavaan(pg6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pg6_sex_model.rds")
```

##### result

```{r}
#| eval: false
readRDS("pgcm_pg6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    fm.args = list(robust = F),
    rsq = T
  ) %>%
  saveRDS("pgcm_pg6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_pg6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_pg6_sex_result.rds")
```

#### pc ~ pp model with sex

Children’s psychopathology (pc) was regressed on parental psychopathology (pp), with sex as a covariate.

##### model fit

```{r}
#| eval: false
pa6.sex.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1 + dummy_sex
                      a_s~1 + dummy_sex
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1

                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      p_etaB ~ 0*1
                      p_eta1 ~ 0*1
                      p_eta2 ~ 0*1
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1

                      # regression
                      p_i ~ a_i
                      p_s ~ a_i + a_s
                      p_q ~ a_i + a_s"

lavaan(pa6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pa6_sex_model.rds")
```

##### result

```{r}
#| eval: false
readRDS("pgcm_pa6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_pa6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_pa6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_pa6_sex_result.rds")
```

### Symptom model

#### Externalizing Symptoms

##### Ext ~ g model with sex

Children’s Externalizing symptoms (Ext) was regressed on children’s cognitive functioning (g), with sex as a covariate.

```{r}
#| eval: false
Ext.pg6.sex.model <- "#
               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1 + dummy_sex
                      g_s~1 + dummy_sex

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

                      # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q

                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex

                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6

                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1

                      # regression
                      p_i ~ g_i
                      p_s ~ g_i + g_s
                      p_q ~ g_i + g_s"

lavaan(Ext.pg6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pg6_sex_model.rds")
```

###### result

```{r}
readRDS("pgcm_Ext_pg6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    fm.args = list(robust = F),
    rsq = T
  ) %>%
  saveRDS("pgcm_Ext_pg6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Ext_pg6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pg6_sex_result.rds")
```

##### Ext ~ pp model with sex

Children’s Externalizing symptoms (Ext) was regressed on parental psychopathology (pp), with sex as a covariate.

```{r}
#| eval: false
Ext.pa6.sex.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1 + dummy_sex
                      a_s~1 + dummy_sex
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

                      # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q

                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex

                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6

                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1

                      # regression
                      p_i ~ a_i
                      p_s ~ a_i + a_s
                      p_q ~ a_i + a_s"

lavaan(Ext.pa6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pa6_sex_model.rds")
```

###### result

```{r}
#| eval: false
readRDS("pgcm_Ext_pa6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Ext_pa6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Ext_pa6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pa6_sex_result.rds")
```

#### Internalizing Symptoms

##### Int ~ g model with sex

Children’s Internalizing symptoms (Int) was regressed on children’s cognitive functioning (g), with sex as a covariate.

```{r}
#| eval: false
Int.pg6.sex.model <- "#
               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

                      #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1 + dummy_sex
                      g_s~1 + dummy_sex

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

                      # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6
                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q
                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex
                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6
                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1

                      # regression
                      p_i ~ g_i
                      p_s ~ g_i + g_s
                      p_q ~ g_i + g_s"

lavaan(Int.pg6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pg6_sex_model.rds")
```

###### result

```{r}
#| eval: false
readRDS("pgcm_Int_pg6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    fm.args = list(robust = F),
    rsq = T
  ) %>%
  saveRDS("pgcm_Int_pg6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Int_pg6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pg6_sex_result.rds")
```

##### Int ~ pp model with sex

Children’s Internalizing symptoms (Int) was regressed on parental psychopathology (pp), with sex as a covariate.

```{r}
#| eval: false
Int.pa6.sex.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1 + dummy_sex
                      a_s~1 + dummy_sex
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

                      # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q

                      p_i~1 + dummy_sex
                      p_s~1 + dummy_sex
                      p_q~1 + dummy_sex

                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6

                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1

                      # regression
                      p_i ~ a_i
                      p_s ~ a_i + a_s
                      p_q ~ a_i + a_s"

lavaan(Int.pa6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pa6_sex_model.rds")
```

###### result

```{r}
#| eval: false
readRDS("pgcm_Int_pa6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Int_pa6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Int_pa6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pa6_sex_result.rds")
```

### Commonality result

#### General p factor

```{r}
#| eval: False
lapply(
  c(
    "pgcm_pga6_sex_model.rds",
    "pgcm_pg6_sex_model.rds",
    "pgcm_pa6_sex_model.rds"
  ),
  function(f) {
    inspect(readRDS(f), "r2")[c("p_i", "p_s", "p_q")]
  }
) %>%
  do.call(rbind, .) %>%
  round(4) %>%
  data.frame(., row.names = c(
    "pc_pp.g", # pc explained by pp and g
    "pc_g", # pc explained by g
    "pc_pp" # pc explained by pp
  )) %>%
  t() %>%
  data.frame() %>%
  mutate(
    Unique_g = .[[1]] - .[[3]], # main model (pc ~ pp + g) minus pc ~ pp
    Unique_pp = .[[1]] - .[[2]], # main model (pc ~ pp + g) minus pc ~ g
    Common = .[[1]] - Unique_g - Unique_pp
  ) %>%
  saveRDS("p_com_result.rds")
```

```{r}
readRDS("p_com_result.rds") %>%
  knitr::kable()
```

#### Externalizing

```{r}
#| eval: False
lapply(
  c(
    "pgcm_Ext_pga6_sex_model.rds",
    "pgcm_Ext_pg6_sex_model.rds",
    "pgcm_Ext_pa6_sex_model.rds"
  ),
  function(f) {
    inspect(readRDS(f), "r2")[c("p_i", "p_s", "p_q")]
  }
) %>%
  do.call(rbind, .) %>%
  round(4) %>%
  data.frame(., row.names = c(
    "Ext_pp.g", # Ext explained by pp and g
    "Ext_g", # Ext explained by g
    "Ext_pp" # Ext explained by pp
  )) %>%
  t() %>%
  data.frame(., row.names = c(
    "Ext_i", # Int explained by pp and g
    "Ext_s", # Int explained by g
    "Ext_q" # Int explained by pp
  )) %>%
  mutate(
    Unique_g = .[[1]] - .[[3]], # main model (pc ~ pp + g) minus pc ~ pp
    Unique_pp = .[[1]] - .[[2]], # main model (pc ~ pp + g) minus pc ~ g
    Common = .[[1]] - Unique_g - Unique_pp
  ) %>%
  saveRDS("Ext_com_result.rds")
```

```{r}
readRDS("Ext_com_result.rds") %>%
  knitr::kable()
```

#### Internalizing 

```{r}
#| eval: False
lapply(
  c(
    "pgcm_Int_pga6_sex_model.rds",
    "pgcm_Int_pg6_sex_model.rds",
    "pgcm_Int_pa6_sex_model.rds"
  ),
  function(f) {
    inspect(readRDS(f), "r2")[c("p_i", "p_s", "p_q")]
  }
) %>%
  do.call(rbind, .) %>%
  round(4) %>%
  data.frame(., row.names = c(
    "Int_pp.g", # Int explained by pp and g
    "Int_g", # Int explained by g
    "Int_pp" # Int explained by pp
  )) %>%
  t() %>%
  data.frame(., row.names = c(
    "Int_i", # Int explained by pp and g
    "Int_s", # Int explained by g
    "Int_q" # Int explained by pp
  )) %>%
  mutate(
    Unique_g = .[[1]] - .[[3]], # main model (pc ~ pp + g) minus pc ~ pp
    Unique_pp = .[[1]] - .[[2]], # main model (pc ~ pp + g) minus pc ~ g
    Common = .[[1]] - Unique_g - Unique_pp
  ) %>%
  saveRDS("Int_com_result.rds")
```

```{r}
readRDS("Int_com_result.rds") %>%
  knitr::kable()
```

### Result summary

#### p, Ext, Int Table

```{r}
#| eval: False
rbind(
  readRDS("p_com_result.rds")   %>% select(4:6),
  readRDS("Ext_com_result.rds") %>% select(4:6),
  readRDS("Int_com_result.rds") %>% select(4:6)
) %>% 
  rownames_to_column() %>% 
  separate(rowname, into = c("Factor", "Parameter"), sep = "_") %>% 
  mutate( 
    Parameter = factor(Parameter, 
                       levels = c("q","s","i"),
                       labels = c("Quadratic", "Slope", "Intercept")),
    Factor = factor(Factor, 
                    levels = c("p","Int","Ext"),
                    labels = c("General\np factor", "Internalizing", "Externalizing")),
    # Treat negative variances explained as zero
    Unique_g = ifelse(Unique_g < 0,0,Unique_g*100),
    Unique_pp = ifelse(Unique_pp < 0,0,Unique_pp*100),
    Common = ifelse(Common < 0,0,Common*100)
  ) %>% 
  saveRDS("Commonality_all_table.rds")
```

```{r}
readRDS("Commonality_all_table.rds") %>%
  knitr::kable()
```

#### p, Ext, Int plot

```{r}
readRDS("Commonality_all_table.rds") %>%
  pivot_longer(cols = c(Unique_pp, Common, Unique_g), names_to = "Component", values_to = "Variance") %>%
  mutate(
    Component = factor(Component, 
                       levels = c("Unique_g", "Common", "Unique_pp"),
                       labels = c("Unique_g", "Common", "Unique_pp"))
  ) %>% 
  ggplot(aes(x = Variance, y = Parameter, fill = Component)) +
  geom_bar(stat = "identity", position = "stack", width = 0.7) +
  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 10)) +
  facet_wrap(~ Factor, ncol = 1, strip.position = "left") +
  scale_fill_manual(
    values = c("Unique_g" = "#A9D18E",
      "Common" = "#A6A6A6",
      "Unique_pp" = "#5B9BD5"),
    labels = c("Unique effects of children's cognitive functioning (g factor)",
               "Common effects between parental psychopathology and children's cognitive\nfunctioning (p_p & g factors)",
               "Unique effects of parental psychopathology (p_p factor)")
  ) +
  labs(x = "Variance explained (%)", y = NULL, title = "Children psychopathology") +
  theme_minimal() +
  theme(
    strip.text.y.left = element_text(angle = 0, hjust = 1, size = 11),
    strip.placement = "outside",
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold")
  ) +
  guides(fill = guide_legend(nrow = 3))
```

# Additional analysis with puberty

## Measurement invariance test

### Puberty (Parent-report)

#### Configural invariance model

##### model fit

```{r}
#| eval: False
pu.config.invar <- "#factor loadings #
               pu_etaB =~ lambda_S*ph_p_pds_001_0+
                          lambda_R*ph_p_pds_002_0+
                          lambda_M*ph_p_pds_003_0
               pu_eta1 =~ lambda_S1*ph_p_pds_001_1+
                          lambda_R1*ph_p_pds_002_1+
                          lambda_M1*ph_p_pds_003_1
               pu_eta2 =~ lambda_S2*ph_p_pds_001_2+
                          lambda_R2*ph_p_pds_002_2+
                          lambda_M2*ph_p_pds_003_2
               pu_eta3 =~ lambda_S3*ph_p_pds_001_3+
                          lambda_R3*ph_p_pds_002_3+
                          lambda_M3*ph_p_pds_003_3
               pu_eta4 =~ lambda_S4*ph_p_pds_001_4+
                          lambda_R4*ph_p_pds_002_4+
                          lambda_M4*ph_p_pds_003_4
               pu_eta5 =~ lambda_S5*ph_p_pds_001_5+
                          lambda_R5*ph_p_pds_002_5+
                          lambda_M5*ph_p_pds_003_5
               pu_eta6 =~ lambda_S6*ph_p_pds_001_6+
                          lambda_R6*ph_p_pds_002_6+
                          lambda_M6*ph_p_pds_003_6

              #latent variable variances #
                      pu_etaB~~1*pu_etaB
                      pu_eta1~~1*pu_eta1
                      pu_eta2~~1*pu_eta2
                      pu_eta3~~1*pu_eta3
                      pu_eta4~~1*pu_eta4
                      pu_eta5~~1*pu_eta5
                      pu_eta6~~1*pu_eta6

              #latent variable covariances
                      pu_etaB~~pu_eta1 + pu_eta2 + pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta1~~pu_eta2 + pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta2~~pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta3~~pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta4~~pu_eta5 + pu_eta6
                      pu_eta5~~pu_eta6

              #unique variances
                      ph_p_pds_001_0~~ph_p_pds_001_0
                      ph_p_pds_002_0~~ph_p_pds_002_0
                      ph_p_pds_003_0~~ph_p_pds_003_0
                      ph_p_pds_001_1~~ph_p_pds_001_1
                      ph_p_pds_002_1~~ph_p_pds_002_1
                      ph_p_pds_003_1~~ph_p_pds_003_1
                      ph_p_pds_001_2~~ph_p_pds_001_2
                      ph_p_pds_002_2~~ph_p_pds_002_2
                      ph_p_pds_003_2~~ph_p_pds_003_2
                      ph_p_pds_001_3~~ph_p_pds_001_3
                      ph_p_pds_002_3~~ph_p_pds_002_3
                      ph_p_pds_003_3~~ph_p_pds_003_3
                      ph_p_pds_001_4~~ph_p_pds_001_4
                      ph_p_pds_002_4~~ph_p_pds_002_4
                      ph_p_pds_003_4~~ph_p_pds_003_4
                      ph_p_pds_001_5~~ph_p_pds_001_5
                      ph_p_pds_002_5~~ph_p_pds_002_5
                      ph_p_pds_003_5~~ph_p_pds_003_5
                      ph_p_pds_001_6~~ph_p_pds_001_6
                      ph_p_pds_002_6~~ph_p_pds_002_6
                      ph_p_pds_003_6~~ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #latent variable intercepts # 0*1
                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1

              #observed variable intercepts # S & S2
                      ph_p_pds_001_0~tau_S*1
                      ph_p_pds_002_0~tau_R*1
                      ph_p_pds_003_0~tau_M*1
                      ph_p_pds_001_1~tau_S1*1
                      ph_p_pds_002_1~tau_R1*1
                      ph_p_pds_003_1~tau_M1*1
                      ph_p_pds_001_2~tau_S2*1
                      ph_p_pds_002_2~tau_R2*1
                      ph_p_pds_003_2~tau_M2*1
                      ph_p_pds_001_3~tau_S3*1
                      ph_p_pds_002_3~tau_R3*1
                      ph_p_pds_003_3~tau_M3*1
                      ph_p_pds_001_4~tau_S4*1
                      ph_p_pds_002_4~tau_R4*1
                      ph_p_pds_003_4~tau_M4*1
                      ph_p_pds_001_5~tau_S5*1
                      ph_p_pds_002_5~tau_R5*1
                      ph_p_pds_003_5~tau_M5*1
                      ph_p_pds_001_6~tau_S6*1
                      ph_p_pds_002_6~tau_R6*1
                      ph_p_pds_003_6~tau_M6*1"

lavaan(pu.config.invar,
  data = pub_yp_mean_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("p_pub_config.rds")
```

##### result

```{r}
#| eval: False
readRDS("p_pub_config.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("p_pub_config_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("p_pub_config.rds"), "cor.lv"))$value

readRDS("p_pub_config_result.rds")
```

#### Weak invariance model

##### model fit

```{r}
#| eval: False
pu.weak.invar <- "#factor loadings - MARKER VARIABLE METHOD
               # First indicator (S) fixed to 1 at all time points for identification
               pu_etaB =~ 1*ph_p_pds_001_0+
                          lambda_R*ph_p_pds_002_0+
                          lambda_M*ph_p_pds_003_0
               pu_eta1 =~ 1*ph_p_pds_001_1+
                          lambda_R*ph_p_pds_002_1+
                          lambda_M*ph_p_pds_003_1
               pu_eta2 =~ 1*ph_p_pds_001_2+
                          lambda_R*ph_p_pds_002_2+
                          lambda_M*ph_p_pds_003_2
               pu_eta3 =~ 1*ph_p_pds_001_3+
                          lambda_R*ph_p_pds_002_3+
                          lambda_M*ph_p_pds_003_3
               pu_eta4 =~ 1*ph_p_pds_001_4+
                          lambda_R*ph_p_pds_002_4+
                          lambda_M*ph_p_pds_003_4
               pu_eta5 =~ 1*ph_p_pds_001_5+
                          lambda_R*ph_p_pds_002_5+
                          lambda_M*ph_p_pds_003_5
               pu_eta6 =~ 1*ph_p_pds_001_6+
                          lambda_R*ph_p_pds_002_6+
                          lambda_M*ph_p_pds_003_6

              #latent variable variances - FREE TO VARY ACROSS TIME
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #latent variable covariances
                      pu_etaB~~pu_eta1 + pu_eta2 + pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta1~~pu_eta2 + pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta2~~pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta3~~pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta4~~pu_eta5 + pu_eta6
                      pu_eta5~~pu_eta6

              #unique variances
                      ph_p_pds_001_0~~ph_p_pds_001_0
                      ph_p_pds_002_0~~ph_p_pds_002_0
                      ph_p_pds_003_0~~ph_p_pds_003_0
                      ph_p_pds_001_1~~ph_p_pds_001_1
                      ph_p_pds_002_1~~ph_p_pds_002_1
                      ph_p_pds_003_1~~ph_p_pds_003_1
                      ph_p_pds_001_2~~ph_p_pds_001_2
                      ph_p_pds_002_2~~ph_p_pds_002_2
                      ph_p_pds_003_2~~ph_p_pds_003_2
                      ph_p_pds_001_3~~ph_p_pds_001_3
                      ph_p_pds_002_3~~ph_p_pds_002_3
                      ph_p_pds_003_3~~ph_p_pds_003_3
                      ph_p_pds_001_4~~ph_p_pds_001_4
                      ph_p_pds_002_4~~ph_p_pds_002_4
                      ph_p_pds_003_4~~ph_p_pds_003_4
                      ph_p_pds_001_5~~ph_p_pds_001_5
                      ph_p_pds_002_5~~ph_p_pds_002_5
                      ph_p_pds_003_5~~ph_p_pds_003_5
                      ph_p_pds_001_6~~ph_p_pds_001_6
                      ph_p_pds_002_6~~ph_p_pds_002_6
                      ph_p_pds_003_6~~ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #latent variable intercepts
                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1

              #observed variable intercepts - FREE TO VARY ACROSS TIME
                      ph_p_pds_001_0~tau_S0*1
                      ph_p_pds_002_0~tau_R0*1
                      ph_p_pds_003_0~tau_M0*1
                      ph_p_pds_001_1~tau_S1*1
                      ph_p_pds_002_1~tau_R1*1
                      ph_p_pds_003_1~tau_M1*1
                      ph_p_pds_001_2~tau_S2*1
                      ph_p_pds_002_2~tau_R2*1
                      ph_p_pds_003_2~tau_M2*1
                      ph_p_pds_001_3~tau_S3*1
                      ph_p_pds_002_3~tau_R3*1
                      ph_p_pds_003_3~tau_M3*1
                      ph_p_pds_001_4~tau_S4*1
                      ph_p_pds_002_4~tau_R4*1
                      ph_p_pds_003_4~tau_M4*1
                      ph_p_pds_001_5~tau_S5*1
                      ph_p_pds_002_5~tau_R5*1
                      ph_p_pds_003_5~tau_M5*1
                      ph_p_pds_001_6~tau_S6*1
                      ph_p_pds_002_6~tau_R6*1
                      ph_p_pds_003_6~tau_M6*1"

lavaan(pu.weak.invar,
  data = pub_yp_mean_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("p_pub_weak.rds")
```

##### result

```{r}
#| eval: False
readRDS("p_pub_weak.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("p_pub_weak_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("p_pub_weak.rds"), "cor.lv"))$value

readRDS("p_pub_weak_result.rds")
```

#### Strong invariance model

##### model fit

```{r}
#| eval: False
pu.strong.invar <- "#factor loadings - MARKER VARIABLE METHOD
               # First indicator (S) fixed to 1 at all time points for identification
               pu_etaB =~ 1*ph_p_pds_001_0+
                          lambda_R*ph_p_pds_002_0+
                          lambda_M*ph_p_pds_003_0
               pu_eta1 =~ 1*ph_p_pds_001_1+
                          lambda_R*ph_p_pds_002_1+
                          lambda_M*ph_p_pds_003_1
               pu_eta2 =~ 1*ph_p_pds_001_2+
                          lambda_R*ph_p_pds_002_2+
                          lambda_M*ph_p_pds_003_2
               pu_eta3 =~ 1*ph_p_pds_001_3+
                          lambda_R*ph_p_pds_002_3+
                          lambda_M*ph_p_pds_003_3
               pu_eta4 =~ 1*ph_p_pds_001_4+
                          lambda_R*ph_p_pds_002_4+
                          lambda_M*ph_p_pds_003_4
               pu_eta5 =~ 1*ph_p_pds_001_5+
                          lambda_R*ph_p_pds_002_5+
                          lambda_M*ph_p_pds_003_5
               pu_eta6 =~ 1*ph_p_pds_001_6+
                          lambda_R*ph_p_pds_002_6+
                          lambda_M*ph_p_pds_003_6

              #latent variable variances - FREE TO VARY ACROSS TIME
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #latent variable covariances
                      pu_etaB~~pu_eta1 + pu_eta2 + pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta1~~pu_eta2 + pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta2~~pu_eta3 + pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta3~~pu_eta4 + pu_eta5 + pu_eta6
                      pu_eta4~~pu_eta5 + pu_eta6
                      pu_eta5~~pu_eta6

              #unique variances
                      ph_p_pds_001_0~~ph_p_pds_001_0
                      ph_p_pds_002_0~~ph_p_pds_002_0
                      ph_p_pds_003_0~~ph_p_pds_003_0
                      ph_p_pds_001_1~~ph_p_pds_001_1
                      ph_p_pds_002_1~~ph_p_pds_002_1
                      ph_p_pds_003_1~~ph_p_pds_003_1
                      ph_p_pds_001_2~~ph_p_pds_001_2
                      ph_p_pds_002_2~~ph_p_pds_002_2
                      ph_p_pds_003_2~~ph_p_pds_003_2
                      ph_p_pds_001_3~~ph_p_pds_001_3
                      ph_p_pds_002_3~~ph_p_pds_002_3
                      ph_p_pds_003_3~~ph_p_pds_003_3
                      ph_p_pds_001_4~~ph_p_pds_001_4
                      ph_p_pds_002_4~~ph_p_pds_002_4
                      ph_p_pds_003_4~~ph_p_pds_003_4
                      ph_p_pds_001_5~~ph_p_pds_001_5
                      ph_p_pds_002_5~~ph_p_pds_002_5
                      ph_p_pds_003_5~~ph_p_pds_003_5
                      ph_p_pds_001_6~~ph_p_pds_001_6
                      ph_p_pds_002_6~~ph_p_pds_002_6
                      ph_p_pds_003_6~~ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #latent variable intercepts - FREE TO VARY ACROSS TIME
                      pu_etaB~0*1
                      pu_eta1~alpha1*1
                      pu_eta2~alpha2*1
                      pu_eta3~alpha3*1
                      pu_eta4~alpha4*1
                      pu_eta5~alpha5*1
                      pu_eta6~alpha6*1

              #observed variable intercepts - CONSTRAINED TO BE EQUAL ACROSS TIME
                      ph_p_pds_001_0~tau_S*1
                      ph_p_pds_002_0~tau_R*1
                      ph_p_pds_003_0~tau_M*1
                      ph_p_pds_001_1~tau_S*1
                      ph_p_pds_002_1~tau_R*1
                      ph_p_pds_003_1~tau_M*1
                      ph_p_pds_001_2~tau_S*1
                      ph_p_pds_002_2~tau_R*1
                      ph_p_pds_003_2~tau_M*1
                      ph_p_pds_001_3~tau_S*1
                      ph_p_pds_002_3~tau_R*1
                      ph_p_pds_003_3~tau_M*1
                      ph_p_pds_001_4~tau_S*1
                      ph_p_pds_002_4~tau_R*1
                      ph_p_pds_003_4~tau_M*1
                      ph_p_pds_001_5~tau_S*1
                      ph_p_pds_002_5~tau_R*1
                      ph_p_pds_003_5~tau_M*1
                      ph_p_pds_001_6~tau_S*1
                      ph_p_pds_002_6~tau_R*1
                      ph_p_pds_003_6~tau_M*1"

lavaan(pu.strong.invar,
  data = pub_yp_mean_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("p_pub_strong.rds")
```

##### result

```{r}
#| eval: False
readRDS("p_pub_strong.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("p_pub_strong_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("p_pub_strong.rds"), "cor.lv"))$value

readRDS("p_pub_strong_result.rds")
```

#### Latent growth curve model

##### model fit (with intercept & slope)

```{r}
#| eval: False
lg.pub.strong.invar <- "#factor loadings
               pu_etaB =~ 1*ph_p_pds_001_0 +
                          lambda_R*ph_p_pds_002_0 +
                          lambda_M*ph_p_pds_003_0

               pu_eta1 =~ 1*ph_p_pds_001_1 +
                          lambda_R*ph_p_pds_002_1 +
                          lambda_M*ph_p_pds_003_1

               pu_eta2 =~ 1*ph_p_pds_001_2 +
                          lambda_R*ph_p_pds_002_2 +
                          lambda_M*ph_p_pds_003_2

               pu_eta3 =~ 1*ph_p_pds_001_3 +
                          lambda_R*ph_p_pds_002_3 +
                          lambda_M*ph_p_pds_003_3

               pu_eta4 =~ 1*ph_p_pds_001_4 +
                          lambda_R*ph_p_pds_002_4 +
                          lambda_M*ph_p_pds_003_4

               pu_eta5 =~ 1*ph_p_pds_001_5 +
                          lambda_R*ph_p_pds_002_5 +
                          lambda_M*ph_p_pds_003_5

               pu_eta6 =~ 1*ph_p_pds_001_6 +
                          lambda_R*ph_p_pds_002_6 +
                          lambda_M*ph_p_pds_003_6

              #latent variable variances
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #unique variances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_0
                      ph_p_pds_002_0 ~~ ph_p_pds_002_0
                      ph_p_pds_003_0 ~~ ph_p_pds_003_0

                      ph_p_pds_001_1 ~~ ph_p_pds_001_1
                      ph_p_pds_002_1 ~~ ph_p_pds_002_1
                      ph_p_pds_003_1 ~~ ph_p_pds_003_1

                      ph_p_pds_001_2 ~~ ph_p_pds_001_2
                      ph_p_pds_002_2 ~~ ph_p_pds_002_2
                      ph_p_pds_003_2 ~~ ph_p_pds_003_2

                      ph_p_pds_001_3 ~~ ph_p_pds_001_3
                      ph_p_pds_002_3 ~~ ph_p_pds_002_3
                      ph_p_pds_003_3 ~~ ph_p_pds_003_3

                      ph_p_pds_001_4 ~~ ph_p_pds_001_4
                      ph_p_pds_002_4 ~~ ph_p_pds_002_4
                      ph_p_pds_003_4 ~~ ph_p_pds_003_4

                      ph_p_pds_001_5 ~~ ph_p_pds_001_5
                      ph_p_pds_002_5 ~~ ph_p_pds_002_5
                      ph_p_pds_003_5 ~~ ph_p_pds_003_5

                      ph_p_pds_001_6 ~~ ph_p_pds_001_6
                      ph_p_pds_002_6 ~~ ph_p_pds_002_6
                      ph_p_pds_003_6 ~~ ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #observed variable intercepts
                      ph_p_pds_001_0 ~ tau_S*1
                      ph_p_pds_001_1 ~ tau_S*1
                      ph_p_pds_001_2 ~ tau_S*1
                      ph_p_pds_001_3 ~ tau_S*1
                      ph_p_pds_001_4 ~ tau_S*1
                      ph_p_pds_001_5 ~ tau_S*1
                      ph_p_pds_001_6 ~ tau_S*1

                      ph_p_pds_002_0 ~ tau_R*1
                      ph_p_pds_002_1 ~ tau_R*1
                      ph_p_pds_002_2 ~ tau_R*1
                      ph_p_pds_002_3 ~ tau_R*1
                      ph_p_pds_002_4 ~ tau_R*1
                      ph_p_pds_002_5 ~ tau_R*1
                      ph_p_pds_002_6 ~ tau_R*1

                      ph_p_pds_003_0 ~ tau_M*1
                      ph_p_pds_003_1 ~ tau_M*1
                      ph_p_pds_003_2 ~ tau_M*1
                      ph_p_pds_003_3 ~ tau_M*1
                      ph_p_pds_003_4 ~ tau_M*1
                      ph_p_pds_003_5 ~ tau_M*1
                      ph_p_pds_003_6 ~ tau_M*1

              #latent basis model
                      pu_i =~ 1*pu_etaB + 1*pu_eta1 + 1*pu_eta2 + 1*pu_eta3 + 1*pu_eta4 + 1*pu_eta5 + 1*pu_eta6
                      pu_s =~ 0*pu_etaB + 0.5*pu_eta1 + 1*pu_eta2 + 1.5*pu_eta3 + 2*pu_eta4 + 2.5*pu_eta5 + 3*pu_eta6

                      pu_i~~NA*pu_i
                      pu_s~~NA*pu_s

                      pu_i~~pu_s

                      pu_i~1
                      pu_s~1

                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1"


lavaan(lg.pub.strong.invar,
  data = pub_yp_mean_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lg_p_pub_strong.rds")
```

##### result

```{r}
#| eval: False
readRDS("lg_p_pub_strong.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lg_pub_strong_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lg_p_pub_strong.rds"), "cor.lv"))$value

readRDS("lg_pub_strong_result.rds")
```

##### model fit (with intercept, slope & qudratic)

```{r}
#| eval: False
lg.pub.strong.invar2 <- "#factor loadings
               pu_etaB =~ 1*ph_p_pds_001_0 +
                          lambda_R*ph_p_pds_002_0 +
                          lambda_M*ph_p_pds_003_0

               pu_eta1 =~ 1*ph_p_pds_001_1 +
                          lambda_R*ph_p_pds_002_1 +
                          lambda_M*ph_p_pds_003_1

               pu_eta2 =~ 1*ph_p_pds_001_2 +
                          lambda_R*ph_p_pds_002_2 +
                          lambda_M*ph_p_pds_003_2

               pu_eta3 =~ 1*ph_p_pds_001_3 +
                          lambda_R*ph_p_pds_002_3 +
                          lambda_M*ph_p_pds_003_3

               pu_eta4 =~ 1*ph_p_pds_001_4 +
                          lambda_R*ph_p_pds_002_4 +
                          lambda_M*ph_p_pds_003_4

               pu_eta5 =~ 1*ph_p_pds_001_5 +
                          lambda_R*ph_p_pds_002_5 +
                          lambda_M*ph_p_pds_003_5

               pu_eta6 =~ 1*ph_p_pds_001_6 +
                          lambda_R*ph_p_pds_002_6 +
                          lambda_M*ph_p_pds_003_6

              #latent variable variances
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #unique variances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_0
                      ph_p_pds_002_0 ~~ ph_p_pds_002_0
                      ph_p_pds_003_0 ~~ ph_p_pds_003_0

                      ph_p_pds_001_1 ~~ ph_p_pds_001_1
                      ph_p_pds_002_1 ~~ ph_p_pds_002_1
                      ph_p_pds_003_1 ~~ ph_p_pds_003_1

                      ph_p_pds_001_2 ~~ ph_p_pds_001_2
                      ph_p_pds_002_2 ~~ ph_p_pds_002_2
                      ph_p_pds_003_2 ~~ ph_p_pds_003_2

                      ph_p_pds_001_3 ~~ ph_p_pds_001_3
                      ph_p_pds_002_3 ~~ ph_p_pds_002_3
                      ph_p_pds_003_3 ~~ ph_p_pds_003_3

                      ph_p_pds_001_4 ~~ ph_p_pds_001_4
                      ph_p_pds_002_4 ~~ ph_p_pds_002_4
                      ph_p_pds_003_4 ~~ ph_p_pds_003_4

                      ph_p_pds_001_5 ~~ ph_p_pds_001_5
                      ph_p_pds_002_5 ~~ ph_p_pds_002_5
                      ph_p_pds_003_5 ~~ ph_p_pds_003_5

                      ph_p_pds_001_6 ~~ ph_p_pds_001_6
                      ph_p_pds_002_6 ~~ ph_p_pds_002_6
                      ph_p_pds_003_6 ~~ ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #observed variable intercepts
                      ph_p_pds_001_0 ~ tau_S*1
                      ph_p_pds_001_1 ~ tau_S*1
                      ph_p_pds_001_2 ~ tau_S*1
                      ph_p_pds_001_3 ~ tau_S*1
                      ph_p_pds_001_4 ~ tau_S*1
                      ph_p_pds_001_5 ~ tau_S*1
                      ph_p_pds_001_6 ~ tau_S*1

                      ph_p_pds_002_0 ~ tau_R*1
                      ph_p_pds_002_1 ~ tau_R*1
                      ph_p_pds_002_2 ~ tau_R*1
                      ph_p_pds_002_3 ~ tau_R*1
                      ph_p_pds_002_4 ~ tau_R*1
                      ph_p_pds_002_5 ~ tau_R*1
                      ph_p_pds_002_6 ~ tau_R*1

                      ph_p_pds_003_0 ~ tau_M*1
                      ph_p_pds_003_1 ~ tau_M*1
                      ph_p_pds_003_2 ~ tau_M*1
                      ph_p_pds_003_3 ~ tau_M*1
                      ph_p_pds_003_4 ~ tau_M*1
                      ph_p_pds_003_5 ~ tau_M*1
                      ph_p_pds_003_6 ~ tau_M*1

              #latent basis model
                      pu_i =~ 1*pu_etaB + 1*pu_eta1 + 1*pu_eta2 + 1*pu_eta3 + 1*pu_eta4 + 1*pu_eta5 + 1*pu_eta6
                      pu_s =~ 0*pu_etaB + 0.5*pu_eta1 + 1*pu_eta2 + 1.5*pu_eta3 + 2*pu_eta4 + 2.5*pu_eta5 + 3*pu_eta6
                      pu_q =~ 0*pu_etaB + 0.25*pu_eta1 + 1*pu_eta2 + 2.25*pu_eta3 + 4*pu_eta4 + 6.25*pu_eta5 + 9*pu_eta6

                      pu_i~~NA*pu_i
                      pu_s~~NA*pu_s
                      pu_q~~NA*pu_q

                      pu_i~~pu_s + pu_q
                      pu_s~~pu_q

                      pu_i~1
                      pu_s~1
                      pu_q~1

                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1"


lavaan(lg.pub.strong.invar2,
  data = pub_yp_mean_wide.scaled,
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = F,
  std.lv = T
) %>%
  saveRDS("lg_p_pub_strong2.rds")
```

##### result

```{r}
#| eval: False
readRDS("lg_p_pub_strong2.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("lg_pub_strong_result2.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("lg_p_pub_strong2.rds"), "cor.lv"))$value

readRDS("lg_pub_strong_result2.rds")
```

##### ICC

```{r}
#| eval: False
lavPredict(readRDS("lg_p_pub_strong2.rds"),
  newdata = pub_yp_mean_wide.scaled,
  append.data = T
) %>%
  data.frame() %>%
  select(contains(c("pu_eta"))) %>%
  ICC(lmer = T) %>%
  saveRDS("p_pub_icc.rds")
```

```{r}
readRDS("p_pub_icc.rds") %>%
  {
    \(x) x$results
  }() %>%
  knitr::kable()
```

##### LGCM plot

```{r}
lgcm_plot(readRDS("lg_p_pub_strong2.rds")) +
  labs(y = "Children's Puberty") +
  scale_x_continuous(
    breaks = seq(0, 3, .5),
    labels = c("10", "11", "12", "13", "14", "15", "16")
  ) +
  # add significant results for intercept and slope
  annotate(geom = "text", x = 2.5, y = -0.3, label = 'paste(" ",italic("i")," = -.715***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.5, y = -0.5, label = 'paste(italic("s")," =  .597***")', parse = TRUE, size = 10) +
  annotate(geom = "text", x = 2.5, y = -0.7, label = 'paste(" ",italic("q")," = -.043*** ")', parse = TRUE, size = 10)
```

#### Model comparison

```{r}
lapply(
  c(
    "p_pub_config_result.rds",
    "p_pub_weak_result.rds",
    "p_pub_strong_result.rds",
    "lg_pub_strong_result.rds",
    "lg_pub_strong_result2.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("config", "weak", "strong", "LGCM (i,s)", "LGCM (i,s,q)"), ., row.names = NULL) %>%
  knitr::kable()
```

## Parallel Latent Growth Curve Modeling

### p factor model

#### pc ~ pp + g + pu model 

Children’s psychopathology (pc) was regressed on parental psychopathology (pp), children’s cognitive functioning (g) and children's puberty (pu).

##### model fit 

```{r}
pga_pu6.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order pc factor
               #factor loadings (with constraints)
               p_etaB =~ 1*anxdep_comp_0+
                       lambda_CW*withdep_comp_0+
                       lambda_CS*soma_comp_0+
                       lambda_CC*socprob_comp_0+
                       lambda_CH*thouprob_comp_0+
                       lambda_CA*attprob_comp_0+
                       lambda_CR*rulebreak_comp_0+
                       lambda_CG*aggress_comp_0
               p_eta1 =~ 1*anxdep_comp_1+
                       lambda_CW*withdep_comp_1+
                       lambda_CS*soma_comp_1+
                       lambda_CC*socprob_comp_1+
                       lambda_CH*thouprob_comp_1+
                       lambda_CA*attprob_comp_1+
                       lambda_CR*rulebreak_comp_1+
                       lambda_CG*aggress_comp_1
               p_eta2 =~ 1*anxdep_comp_2+
                       lambda_CW*withdep_comp_2+
                       lambda_CS*soma_comp_2+
                       lambda_CC*socprob_comp_2+
                       lambda_CH*thouprob_comp_2+
                       lambda_CA*attprob_comp_2+
                       lambda_CR*rulebreak_comp_2+
                       lambda_CG*aggress_comp_2
               p_eta3 =~ 1*anxdep_comp_3+
                       lambda_CW*withdep_comp_3+
                       lambda_CS*soma_comp_3+
                       lambda_CC*socprob_comp_3+
                       lambda_CH*thouprob_comp_3+
                       lambda_CA*attprob_comp_3+
                       lambda_CR*rulebreak_comp_3+
                       lambda_CG*aggress_comp_3
               p_eta4 =~ 1*anxdep_comp_4+
                       lambda_CW*withdep_comp_4+
                       lambda_CS*soma_comp_4+
                       lambda_CC*socprob_comp_4+
                       lambda_CH*thouprob_comp_4+
                       lambda_CA*attprob_comp_4+
                       lambda_CR*rulebreak_comp_4+
                       lambda_CG*aggress_comp_4
               p_eta5 =~ 1*anxdep_comp_5+
                       lambda_CW*withdep_comp_5+
                       lambda_CS*soma_comp_5+
                       lambda_CC*socprob_comp_5+
                       lambda_CH*thouprob_comp_5+
                       lambda_CA*attprob_comp_5+
                       lambda_CR*rulebreak_comp_5+
                       lambda_CG*aggress_comp_5
               p_eta6 =~ 1*anxdep_comp_6+
                       lambda_CW*withdep_comp_6+
                       lambda_CS*soma_comp_6+
                       lambda_CC*socprob_comp_6+
                       lambda_CH*thouprob_comp_6+
                       lambda_CA*attprob_comp_6+
                       lambda_CR*rulebreak_comp_6+
                       lambda_CG*aggress_comp_6

              #latent variable variances
                      p_etaB~~NA*p_etaB
                      p_eta1~~NA*p_eta1
                      p_eta2~~NA*p_eta2
                      p_eta3~~NA*p_eta3
                      p_eta4~~NA*p_eta4
                      p_eta5~~NA*p_eta5
                      p_eta6~~NA*p_eta6

              #unique variances # No need to constrict these
                      anxdep_comp_0~~anxdep_comp_0
                      withdep_comp_0~~withdep_comp_0
                      soma_comp_0~~soma_comp_0
                      socprob_comp_0~~socprob_comp_0
                      thouprob_comp_0~~thouprob_comp_0
                      attprob_comp_0~~attprob_comp_0
                      rulebreak_comp_0~~rulebreak_comp_0
                      aggress_comp_0~~aggress_comp_0
                      anxdep_comp_1~~anxdep_comp_1
                      withdep_comp_1~~withdep_comp_1
                      soma_comp_1~~soma_comp_1
                      socprob_comp_1~~socprob_comp_1
                      thouprob_comp_1~~thouprob_comp_1
                      attprob_comp_1~~attprob_comp_1
                      rulebreak_comp_1~~rulebreak_comp_1
                      aggress_comp_1~~aggress_comp_1

                      anxdep_comp_2~~anxdep_comp_2
                      withdep_comp_2~~withdep_comp_2
                      soma_comp_2~~soma_comp_2
                      socprob_comp_2~~socprob_comp_2
                      thouprob_comp_2~~thouprob_comp_2
                      attprob_comp_2~~attprob_comp_2
                      rulebreak_comp_2~~rulebreak_comp_2
                      aggress_comp_2~~aggress_comp_2

                      anxdep_comp_3~~anxdep_comp_3
                      withdep_comp_3~~withdep_comp_3
                      soma_comp_3~~soma_comp_3
                      socprob_comp_3~~socprob_comp_3
                      thouprob_comp_3~~thouprob_comp_3
                      attprob_comp_3~~attprob_comp_3
                      rulebreak_comp_3~~rulebreak_comp_3
                      aggress_comp_3~~aggress_comp_3

                      anxdep_comp_4~~anxdep_comp_4
                      withdep_comp_4~~withdep_comp_4
                      soma_comp_4~~soma_comp_4
                      socprob_comp_4~~socprob_comp_4
                      thouprob_comp_4~~thouprob_comp_4
                      attprob_comp_4~~attprob_comp_4
                      rulebreak_comp_4~~rulebreak_comp_4
                      aggress_comp_4~~aggress_comp_4

                      anxdep_comp_5~~anxdep_comp_5
                      withdep_comp_5~~withdep_comp_5
                      soma_comp_5~~soma_comp_5
                      socprob_comp_5~~socprob_comp_5
                      thouprob_comp_5~~thouprob_comp_5
                      attprob_comp_5~~attprob_comp_5
                      rulebreak_comp_5~~rulebreak_comp_5
                      aggress_comp_5~~aggress_comp_5

                      anxdep_comp_6~~anxdep_comp_6
                      withdep_comp_6~~withdep_comp_6
                      soma_comp_6~~soma_comp_6
                      socprob_comp_6~~socprob_comp_6
                      thouprob_comp_6~~thouprob_comp_6
                      attprob_comp_6~~attprob_comp_6
                      rulebreak_comp_6~~rulebreak_comp_6
                      aggress_comp_6~~aggress_comp_6

              #unique covariances
                      # Scores arcoss times
                      anxdep_comp_0~~anxdep_comp_1 + anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_1~~anxdep_comp_2 + anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_2~~anxdep_comp_3 + anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_3~~anxdep_comp_4 + anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_4~~anxdep_comp_5+ anxdep_comp_6
                      anxdep_comp_5~~anxdep_comp_6

                      withdep_comp_0~~withdep_comp_1 + withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_1~~withdep_comp_2 + withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_2~~withdep_comp_3 + withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_3~~withdep_comp_4 + withdep_comp_5 + withdep_comp_6
                      withdep_comp_4~~withdep_comp_5 + withdep_comp_6
                      withdep_comp_5~~withdep_comp_6

                      soma_comp_0~~soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_1~~soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_2~~soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_3~~soma_comp_4 + soma_comp_5 + soma_comp_6
                      soma_comp_4~~soma_comp_5 + soma_comp_6
                      soma_comp_5~~soma_comp_6

                      socprob_comp_0~~socprob_comp_1 + socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_1~~socprob_comp_2 + socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_2~~socprob_comp_3 + socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_3~~socprob_comp_4 + socprob_comp_5 + socprob_comp_6
                      socprob_comp_4~~socprob_comp_5 + socprob_comp_6
                      socprob_comp_5~~socprob_comp_6

                      thouprob_comp_0~~thouprob_comp_1 + thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_1~~thouprob_comp_2 + thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_2~~thouprob_comp_3 + thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_3~~thouprob_comp_4 + thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_4~~thouprob_comp_5 + thouprob_comp_6
                      thouprob_comp_5~~thouprob_comp_6

                      attprob_comp_0~~attprob_comp_1 + attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_1~~attprob_comp_2 + attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_2~~attprob_comp_3 + attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_3~~attprob_comp_4 + attprob_comp_5 + attprob_comp_6
                      attprob_comp_4~~attprob_comp_5 + attprob_comp_6
                      attprob_comp_5~~attprob_comp_6

                      rulebreak_comp_0~~rulebreak_comp_1 + rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_1~~rulebreak_comp_2 + rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_2~~rulebreak_comp_3 + rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_3~~rulebreak_comp_4 + rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_4~~rulebreak_comp_5 + rulebreak_comp_6
                      rulebreak_comp_5~~rulebreak_comp_6

                      aggress_comp_0~~aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_1~~aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_2~~aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_3~~aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      aggress_comp_4~~aggress_comp_5 + aggress_comp_6
                      aggress_comp_5~~aggress_comp_6

                      # Internalizeing subscale covariances
                      anxdep_comp_0~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_1~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_2~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_3~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_4~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_5~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6
                      anxdep_comp_6~~withdep_comp_0 + soma_comp_0 + withdep_comp_1 + soma_comp_1 + withdep_comp_2 + soma_comp_2 + withdep_comp_3 + soma_comp_3 + withdep_comp_4 + soma_comp_4 + withdep_comp_5 + soma_comp_5 + withdep_comp_6 + soma_comp_6

                      withdep_comp_0~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_1~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_2~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_3~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_4~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_5~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6
                      withdep_comp_6~~soma_comp_0 + soma_comp_1 + soma_comp_2 + soma_comp_3 + soma_comp_4 + soma_comp_5 + soma_comp_6

                      # Externalizeing subscale covariances
                      rulebreak_comp_0~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_1~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_2~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_3~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_4~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_5~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6
                      rulebreak_comp_6~~aggress_comp_0 +aggress_comp_1 + aggress_comp_2 + aggress_comp_3 + aggress_comp_4 + aggress_comp_5 + aggress_comp_6

              #observed variable intercepts
                      anxdep_comp_0~tau_CX*1
                      anxdep_comp_1~tau_CX*1
                      anxdep_comp_2~tau_CX*1
                      anxdep_comp_3~tau_CX*1
                      anxdep_comp_4~tau_CX*1
                      anxdep_comp_5~tau_CX*1
                      anxdep_comp_6~tau_CX*1
                      withdep_comp_0~tau_CW*1
                      withdep_comp_1~tau_CW*1
                      withdep_comp_2~tau_CW*1
                      withdep_comp_3~tau_CW*1
                      withdep_comp_4~tau_CW*1
                      withdep_comp_5~tau_CW*1
                      withdep_comp_6~tau_CW*1
                      soma_comp_0~tau_CS*1
                      soma_comp_1~tau_CS*1
                      soma_comp_2~tau_CS*1
                      soma_comp_3~tau_CS*1
                      soma_comp_4~tau_CS*1
                      soma_comp_5~tau_CS*1
                      soma_comp_6~tau_CS*1
                      socprob_comp_0~tau_CP*1
                      socprob_comp_1~tau_CP*1
                      socprob_comp_2~tau_CP*1
                      socprob_comp_3~tau_CP*1
                      socprob_comp_4~tau_CP*1
                      socprob_comp_5~tau_CP*1
                      socprob_comp_6~tau_CP*1
                      thouprob_comp_0~tau_CH*1
                      thouprob_comp_1~tau_CH*1
                      thouprob_comp_2~tau_CH*1
                      thouprob_comp_3~tau_CH*1
                      thouprob_comp_4~tau_CH*1
                      thouprob_comp_5~tau_CH*1
                      thouprob_comp_6~tau_CH*1
                      attprob_comp_0~tau_CA*1
                      attprob_comp_1~tau_CA*1
                      attprob_comp_2~tau_CA*1
                      attprob_comp_3~tau_CA*1
                      attprob_comp_4~tau_CA*1
                      attprob_comp_5~tau_CA*1
                      attprob_comp_6~tau_CA*1
                      rulebreak_comp_0~tau_CR*1
                      rulebreak_comp_1~tau_CR*1
                      rulebreak_comp_2~tau_CR*1
                      rulebreak_comp_3~tau_CR*1
                      rulebreak_comp_4~tau_CR*1
                      rulebreak_comp_5~tau_CR*1
                      rulebreak_comp_6~tau_CR*1
                      aggress_comp_0~tau_CG*1
                      aggress_comp_1~tau_CG*1
                      aggress_comp_2~tau_CG*1
                      aggress_comp_3~tau_CG*1
                      aggress_comp_4~tau_CG*1
                      aggress_comp_5~tau_CG*1
                      aggress_comp_6~tau_CG*1

                       #latent basis model
                      p_i =~ 1*p_etaB + 1*p_eta1 + 1*p_eta2 + 1*p_eta3 + 1*p_eta4 + 1*p_eta5 + 1*p_eta6
                      p_s =~ 0*p_etaB + .5*p_eta1 + 1*p_eta2 + 1.5*p_eta3 + 2*p_eta4 + 2.5*p_eta5 + 3*p_eta6
                      p_q =~ 0*p_etaB + .25*p_eta1 + 1*p_eta2 + 2.25*p_eta3 + 4*p_eta4 + 6.25*p_eta5 + 9*p_eta6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q
                      p_i~1
                      p_s~1
                      p_q~1
                      p_etaB ~ 0*1
                      p_eta1 ~ 0*1
                      p_eta2 ~ 0*1
                      p_eta3 ~ 0*1
                      p_eta4 ~ 0*1
                      p_eta5 ~ 0*1
                      p_eta6 ~ 0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

              #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

               # second-order puberty factor
               #factor loadings
               pu_etaB =~ 1*ph_p_pds_001_0 +
                          lambda_PR*ph_p_pds_002_0 +
                          lambda_PM*ph_p_pds_003_0

               pu_eta1 =~ 1*ph_p_pds_001_1 +
                          lambda_PR*ph_p_pds_002_1 +
                          lambda_PM*ph_p_pds_003_1

               pu_eta2 =~ 1*ph_p_pds_001_2 +
                          lambda_PR*ph_p_pds_002_2 +
                          lambda_PM*ph_p_pds_003_2

               pu_eta3 =~ 1*ph_p_pds_001_3 +
                          lambda_PR*ph_p_pds_002_3 +
                          lambda_PM*ph_p_pds_003_3

               pu_eta4 =~ 1*ph_p_pds_001_4 +
                          lambda_PR*ph_p_pds_002_4 +
                          lambda_PM*ph_p_pds_003_4

               pu_eta5 =~ 1*ph_p_pds_001_5 +
                          lambda_PR*ph_p_pds_002_5 +
                          lambda_PM*ph_p_pds_003_5

               pu_eta6 =~ 1*ph_p_pds_001_6 +
                          lambda_PR*ph_p_pds_002_6 +
                          lambda_PM*ph_p_pds_003_6

              #latent variable variances
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #unique variances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_0
                      ph_p_pds_002_0 ~~ ph_p_pds_002_0
                      ph_p_pds_003_0 ~~ ph_p_pds_003_0

                      ph_p_pds_001_1 ~~ ph_p_pds_001_1
                      ph_p_pds_002_1 ~~ ph_p_pds_002_1
                      ph_p_pds_003_1 ~~ ph_p_pds_003_1

                      ph_p_pds_001_2 ~~ ph_p_pds_001_2
                      ph_p_pds_002_2 ~~ ph_p_pds_002_2
                      ph_p_pds_003_2 ~~ ph_p_pds_003_2

                      ph_p_pds_001_3 ~~ ph_p_pds_001_3
                      ph_p_pds_002_3 ~~ ph_p_pds_002_3
                      ph_p_pds_003_3 ~~ ph_p_pds_003_3

                      ph_p_pds_001_4 ~~ ph_p_pds_001_4
                      ph_p_pds_002_4 ~~ ph_p_pds_002_4
                      ph_p_pds_003_4 ~~ ph_p_pds_003_4

                      ph_p_pds_001_5 ~~ ph_p_pds_001_5
                      ph_p_pds_002_5 ~~ ph_p_pds_002_5
                      ph_p_pds_003_5 ~~ ph_p_pds_003_5

                      ph_p_pds_001_6 ~~ ph_p_pds_001_6
                      ph_p_pds_002_6 ~~ ph_p_pds_002_6
                      ph_p_pds_003_6 ~~ ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #observed variable intercepts
                      ph_p_pds_001_0 ~ tau_PS*1
                      ph_p_pds_001_1 ~ tau_PS*1
                      ph_p_pds_001_2 ~ tau_PS*1
                      ph_p_pds_001_3 ~ tau_PS*1
                      ph_p_pds_001_4 ~ tau_PS*1
                      ph_p_pds_001_5 ~ tau_PS*1
                      ph_p_pds_001_6 ~ tau_PS*1

                      ph_p_pds_002_0 ~ tau_PR*1
                      ph_p_pds_002_1 ~ tau_PR*1
                      ph_p_pds_002_2 ~ tau_PR*1
                      ph_p_pds_002_3 ~ tau_PR*1
                      ph_p_pds_002_4 ~ tau_PR*1
                      ph_p_pds_002_5 ~ tau_PR*1
                      ph_p_pds_002_6 ~ tau_PR*1

                      ph_p_pds_003_0 ~ tau_PM*1
                      ph_p_pds_003_1 ~ tau_PM*1
                      ph_p_pds_003_2 ~ tau_PM*1
                      ph_p_pds_003_3 ~ tau_PM*1
                      ph_p_pds_003_4 ~ tau_PM*1
                      ph_p_pds_003_5 ~ tau_PM*1
                      ph_p_pds_003_6 ~ tau_PM*1

              #latent basis model
                      pu_i =~ 1*pu_etaB + 1*pu_eta1 + 1*pu_eta2 + 1*pu_eta3 + 1*pu_eta4 + 1*pu_eta5 + 1*pu_eta6
                      pu_s =~ 0*pu_etaB + 0.5*pu_eta1 + 1*pu_eta2 + 1.5*pu_eta3 + 2*pu_eta4 + 2.5*pu_eta5 + 3*pu_eta6
                      pu_q =~ 0*pu_etaB + 0.25*pu_eta1 + 1*pu_eta2 + 2.25*pu_eta3 + 4*pu_eta4 + 6.25*pu_eta5 + 9*pu_eta6

                      pu_i~~NA*pu_i
                      pu_s~~NA*pu_s
                      pu_q~~NA*pu_q

                      pu_i~~pu_s + pu_q
                      pu_s~~pu_q

                      pu_i~1
                      pu_s~1
                      pu_q~1

                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1

                      # regression
                      p_i ~ g_i + a_i + pu_i
                      p_s ~ g_i + g_s + a_i + a_s + pu_i + pu_s + pu_q
                      p_q ~ g_i + g_s + a_i + a_s + pu_i + pu_s + pu_q"
```

```{r}
#| eval: False
lavaan(pga_pu6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_pga_pu6_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("pgcm_pga_pu6_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_pga_pu6_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_pga_pu6_model.rds"), "cor.lv"))$value

readRDS("pgcm_pga_pu6_result.rds")
```

#### pc ~ pp + g + pu model with sex

Children’s psychopathology (pc) was regressed on parental psychopathology (pp), children’s cognitive functioning (g) and children's puberty (pu), with sex as covariate.

##### model fit

```{r}
# Add sex as covariate
pga_pu6.sex.model <- pga_pu6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(pga_pu6.sex.model)
```

```{r}
#| eval: False

lavaan(pga_pu6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_pga_pu6_sex_model.rds")
```

##### result

```{r}
#| eval: False
readRDS("pgcm_pga_pu6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_pga_pu6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_pga_pu6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_pga_pu6_sex_result.rds")
```

### Symptom model

#### Externalizing symptoms

##### Ext ~ pp + g + pu model 

Children’s Externalizing symptoms (Ext) was regressed on parental psychopathology (pp), children’s cognitive functioning (g) and children's puberty (pu).

###### model fit

```{r}
Ext.pga_pu6.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

              #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

               # second-order puberty factor
               #factor loadings
               pu_etaB =~ 1*ph_p_pds_001_0 +
                          lambda_PR*ph_p_pds_002_0 +
                          lambda_PM*ph_p_pds_003_0

               pu_eta1 =~ 1*ph_p_pds_001_1 +
                          lambda_PR*ph_p_pds_002_1 +
                          lambda_PM*ph_p_pds_003_1

               pu_eta2 =~ 1*ph_p_pds_001_2 +
                          lambda_PR*ph_p_pds_002_2 +
                          lambda_PM*ph_p_pds_003_2

               pu_eta3 =~ 1*ph_p_pds_001_3 +
                          lambda_PR*ph_p_pds_002_3 +
                          lambda_PM*ph_p_pds_003_3

               pu_eta4 =~ 1*ph_p_pds_001_4 +
                          lambda_PR*ph_p_pds_002_4 +
                          lambda_PM*ph_p_pds_003_4

               pu_eta5 =~ 1*ph_p_pds_001_5 +
                          lambda_PR*ph_p_pds_002_5 +
                          lambda_PM*ph_p_pds_003_5

               pu_eta6 =~ 1*ph_p_pds_001_6 +
                          lambda_PR*ph_p_pds_002_6 +
                          lambda_PM*ph_p_pds_003_6

              #latent variable variances
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #unique variances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_0
                      ph_p_pds_002_0 ~~ ph_p_pds_002_0
                      ph_p_pds_003_0 ~~ ph_p_pds_003_0

                      ph_p_pds_001_1 ~~ ph_p_pds_001_1
                      ph_p_pds_002_1 ~~ ph_p_pds_002_1
                      ph_p_pds_003_1 ~~ ph_p_pds_003_1

                      ph_p_pds_001_2 ~~ ph_p_pds_001_2
                      ph_p_pds_002_2 ~~ ph_p_pds_002_2
                      ph_p_pds_003_2 ~~ ph_p_pds_003_2

                      ph_p_pds_001_3 ~~ ph_p_pds_001_3
                      ph_p_pds_002_3 ~~ ph_p_pds_002_3
                      ph_p_pds_003_3 ~~ ph_p_pds_003_3

                      ph_p_pds_001_4 ~~ ph_p_pds_001_4
                      ph_p_pds_002_4 ~~ ph_p_pds_002_4
                      ph_p_pds_003_4 ~~ ph_p_pds_003_4

                      ph_p_pds_001_5 ~~ ph_p_pds_001_5
                      ph_p_pds_002_5 ~~ ph_p_pds_002_5
                      ph_p_pds_003_5 ~~ ph_p_pds_003_5

                      ph_p_pds_001_6 ~~ ph_p_pds_001_6
                      ph_p_pds_002_6 ~~ ph_p_pds_002_6
                      ph_p_pds_003_6 ~~ ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #observed variable intercepts
                      ph_p_pds_001_0 ~ tau_PS*1
                      ph_p_pds_001_1 ~ tau_PS*1
                      ph_p_pds_001_2 ~ tau_PS*1
                      ph_p_pds_001_3 ~ tau_PS*1
                      ph_p_pds_001_4 ~ tau_PS*1
                      ph_p_pds_001_5 ~ tau_PS*1
                      ph_p_pds_001_6 ~ tau_PS*1

                      ph_p_pds_002_0 ~ tau_PR*1
                      ph_p_pds_002_1 ~ tau_PR*1
                      ph_p_pds_002_2 ~ tau_PR*1
                      ph_p_pds_002_3 ~ tau_PR*1
                      ph_p_pds_002_4 ~ tau_PR*1
                      ph_p_pds_002_5 ~ tau_PR*1
                      ph_p_pds_002_6 ~ tau_PR*1

                      ph_p_pds_003_0 ~ tau_PM*1
                      ph_p_pds_003_1 ~ tau_PM*1
                      ph_p_pds_003_2 ~ tau_PM*1
                      ph_p_pds_003_3 ~ tau_PM*1
                      ph_p_pds_003_4 ~ tau_PM*1
                      ph_p_pds_003_5 ~ tau_PM*1
                      ph_p_pds_003_6 ~ tau_PM*1

              #latent basis model
                      pu_i =~ 1*pu_etaB + 1*pu_eta1 + 1*pu_eta2 + 1*pu_eta3 + 1*pu_eta4 + 1*pu_eta5 + 1*pu_eta6
                      pu_s =~ 0*pu_etaB + 0.5*pu_eta1 + 1*pu_eta2 + 1.5*pu_eta3 + 2*pu_eta4 + 2.5*pu_eta5 + 3*pu_eta6
                      pu_q =~ 0*pu_etaB + 0.25*pu_eta1 + 1*pu_eta2 + 2.25*pu_eta3 + 4*pu_eta4 + 6.25*pu_eta5 + 9*pu_eta6

                      pu_i~~NA*pu_i
                      pu_s~~NA*pu_s
                      pu_q~~NA*pu_q

                      pu_i~~pu_s + pu_q
                      pu_s~~pu_q

                      pu_i~1
                      pu_s~1
                      pu_q~1

                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1

              # Externalizing model
                      p_i =~ 1*Ext_comp_0 + 1*Ext_comp_1 + 1*Ext_comp_2 + 1*Ext_comp_3 + 1*Ext_comp_4 + 1*Ext_comp_5 + 1*Ext_comp_6
                      p_s =~ 0*Ext_comp_0 + .5*Ext_comp_1 + 1*Ext_comp_2 + 1.5*Ext_comp_3 + 2*Ext_comp_4 + 2.5*Ext_comp_5 + 3*Ext_comp_6
                      p_q =~ 0*Ext_comp_0 + .25*Ext_comp_1 + 1*Ext_comp_2 + 2.25*Ext_comp_3 + 4*Ext_comp_4 + 6.25*Ext_comp_5 + 9*Ext_comp_6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q

                      p_i~1
                      p_s~1
                      p_q~1

                      Ext_comp_0 ~~ NA*Ext_comp_0
                      Ext_comp_1 ~~ NA*Ext_comp_1
                      Ext_comp_2 ~~ NA*Ext_comp_2
                      Ext_comp_3 ~~ NA*Ext_comp_3
                      Ext_comp_4 ~~ NA*Ext_comp_4
                      Ext_comp_5 ~~ NA*Ext_comp_5
                      Ext_comp_6 ~~ NA*Ext_comp_6

                      Ext_comp_0 ~ 0*1
                      Ext_comp_1 ~ 0*1
                      Ext_comp_2 ~ 0*1
                      Ext_comp_3 ~ 0*1
                      Ext_comp_4 ~ 0*1
                      Ext_comp_5 ~ 0*1
                      Ext_comp_6 ~ 0*1

                      # regression
                      p_i ~ g_i + a_i + pu_i
                      p_s ~ g_i + g_s + a_i + a_s + pu_i + pu_s + pu_q
                      p_q ~ g_i + g_s + a_i + a_s + pu_i + pu_s + pu_q"
```

```{r}
#| eval: False
lavaan(Ext.pga_pu6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pga_pu6_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Ext_pga_pu6_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Ext_pga_pu6_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Ext_pga_pu6_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pga_pu6_result.rds")
```

##### Ext ~ pp + g + pu model with sex

Children’s Externalizing symptoms (Ext) was regressed on parental psychopathology (pp), children’s cognitive functioning (g) and children's puberty (pu), with sex as covariate.

###### model fit

```{r}
# Add sex as covariate
Ext.pga_pu6.sex.model <- Ext.pga_pu6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(Ext.pga_pu6.sex.model)
```

```{r}
#| eval: False
lavaan(Ext.pga_pu6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Ext_pga_pu6_sex_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Ext_pga_pu6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Ext_pga_pu6_sex_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Ext_pga_pu6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Ext_pga_pu6_sex_result.rds")
```

#### Internalizing symptoms

##### Int ~ pp + g + pu model 

Children’s Internalizing symptoms (Int) was regressed on parental psychopathology (pp), children’s cognitive functioning (g) and children's puberty (pu).

###### model fit

```{r}
Int.pga_pu6.model <- "# second-order pp factor
               #factor loadings (with constraints)
               a_etaB =~ 1*asr_anxdep_comp_0+
                       lambda_AW*asr_withdep_comp_0+
                       lambda_AS*asr_soma_comp_0+
                       lambda_AC*asr_thouprob_comp_0+
                       lambda_AH*asr_attprob_comp_0+
                       lambda_AA*asr_rulebreak_comp_0+
                       lambda_AR*asr_aggress_comp_0+
                       lambda_AG*asr_intru_comp_0
               a_eta2 =~ 1*asr_anxdep_comp_2+
                       lambda_AW*asr_withdep_comp_2+
                       lambda_AS*asr_soma_comp_2+
                       lambda_AC*asr_thouprob_comp_2+
                       lambda_AH*asr_attprob_comp_2+
                       lambda_AA*asr_rulebreak_comp_2+
                       lambda_AR*asr_aggress_comp_2+
                       lambda_AG*asr_intru_comp_2
               a_eta4 =~ 1*asr_anxdep_comp_4+
                       lambda_AW*asr_withdep_comp_4+
                       lambda_AS*asr_soma_comp_4+
                       lambda_AC*asr_thouprob_comp_4+
                       lambda_AH*asr_attprob_comp_4+
                       lambda_AA*asr_rulebreak_comp_4+
                       lambda_AR*asr_aggress_comp_4+
                       lambda_AG*asr_intru_comp_4

              #latent variable variances
                      a_etaB~~NA*a_etaB
                      a_eta2~~NA*a_eta2
                      a_eta4~~NA*a_eta4

              #unique variances # No need to constrict these
                      asr_anxdep_comp_0~~asr_anxdep_comp_0
                      asr_withdep_comp_0~~asr_withdep_comp_0
                      asr_soma_comp_0~~asr_soma_comp_0
                      asr_thouprob_comp_0~~asr_thouprob_comp_0
                      asr_attprob_comp_0~~asr_attprob_comp_0
                      asr_rulebreak_comp_0~~asr_rulebreak_comp_0
                      asr_aggress_comp_0~~asr_aggress_comp_0
                      asr_intru_comp_0~~asr_intru_comp_0

                      asr_anxdep_comp_2~~asr_anxdep_comp_2
                      asr_withdep_comp_2~~asr_withdep_comp_2
                      asr_soma_comp_2~~asr_soma_comp_2
                      asr_thouprob_comp_2~~asr_thouprob_comp_2
                      asr_attprob_comp_2~~asr_attprob_comp_2
                      asr_rulebreak_comp_2~~asr_rulebreak_comp_2
                      asr_aggress_comp_2~~asr_aggress_comp_2
                      asr_intru_comp_2~~asr_intru_comp_2

                      asr_anxdep_comp_4~~asr_anxdep_comp_4
                      asr_withdep_comp_4~~asr_withdep_comp_4
                      asr_soma_comp_4~~asr_soma_comp_4
                      asr_thouprob_comp_4~~asr_thouprob_comp_4
                      asr_attprob_comp_4~~asr_attprob_comp_4
                      asr_rulebreak_comp_4~~asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_aggress_comp_4
                      asr_intru_comp_4~~asr_intru_comp_4

              #unique covariances
                      # Scores arcoss times
                      asr_anxdep_comp_0~~ asr_anxdep_comp_2 + asr_anxdep_comp_4
                      asr_anxdep_comp_2~~ asr_anxdep_comp_4

                      asr_withdep_comp_0 ~~ asr_withdep_comp_2 + asr_withdep_comp_4
                      asr_withdep_comp_2 ~~ asr_withdep_comp_4

                      asr_soma_comp_0~~ asr_soma_comp_2 + asr_soma_comp_4
                      asr_soma_comp_2~~ asr_soma_comp_4

                      asr_thouprob_comp_0~~ asr_thouprob_comp_2 + asr_thouprob_comp_4
                      asr_thouprob_comp_2~~ asr_thouprob_comp_4

                      asr_attprob_comp_0~~ asr_attprob_comp_2 + asr_attprob_comp_4
                      asr_attprob_comp_2~~ asr_attprob_comp_4

                      asr_rulebreak_comp_0~~ asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_rulebreak_comp_2~~ asr_rulebreak_comp_4

                      asr_aggress_comp_0~~ asr_aggress_comp_2 + asr_aggress_comp_4
                      asr_aggress_comp_2~~ asr_aggress_comp_4

                      asr_intru_comp_0~~ asr_intru_comp_2 + asr_intru_comp_4
                      asr_intru_comp_2~~ asr_intru_comp_4

                      # Internalizeing subscale covariances
                      asr_anxdep_comp_0~~asr_withdep_comp_0 + asr_soma_comp_0 + asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_2~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4
                      asr_anxdep_comp_4~~asr_withdep_comp_0 + asr_soma_comp_0 +  asr_withdep_comp_2 + asr_soma_comp_2 + asr_withdep_comp_4 + asr_soma_comp_4

                      asr_withdep_comp_0~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_2~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4
                      asr_withdep_comp_4~~asr_soma_comp_0 + asr_soma_comp_2 + asr_soma_comp_4

                      # Externalizeing subscale covariances
                      asr_aggress_comp_0~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_2~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4
                      asr_aggress_comp_4~~asr_intru_comp_0 + asr_rulebreak_comp_0 + asr_intru_comp_2 + asr_rulebreak_comp_2 + asr_intru_comp_4 + asr_rulebreak_comp_4

                      asr_intru_comp_0~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_2~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4
                      asr_intru_comp_4~~asr_rulebreak_comp_0 + asr_rulebreak_comp_2 + asr_rulebreak_comp_4

              #observed variable intercepts
                      asr_anxdep_comp_0~tau_AX*1
                      asr_withdep_comp_0~tau_AW*1
                      asr_soma_comp_0~tau_AS*1
                      asr_thouprob_comp_0~tau_AP*1
                      asr_attprob_comp_0~tau_AH*1
                      asr_rulebreak_comp_0~tau_AA*1
                      asr_aggress_comp_0~tau_AR*1
                      asr_intru_comp_0~tau_AG*1

                      asr_anxdep_comp_2~tau_AX*1
                      asr_withdep_comp_2~tau_AW*1
                      asr_soma_comp_2~tau_AS*1
                      asr_thouprob_comp_2~tau_AP*1
                      asr_attprob_comp_2~tau_AH*1
                      asr_rulebreak_comp_2~tau_AA*1
                      asr_aggress_comp_2~tau_AR*1
                      asr_intru_comp_2~tau_AG*1

                      asr_anxdep_comp_4~tau_AX*1
                      asr_withdep_comp_4~tau_AW*1
                      asr_soma_comp_4~tau_AS*1
                      asr_thouprob_comp_4~tau_AP*1
                      asr_attprob_comp_4~tau_AH*1
                      asr_rulebreak_comp_4~tau_AA*1
                      asr_aggress_comp_4~tau_AR*1
                      asr_intru_comp_4~tau_AG*1

                      #latent basis model
                      a_i =~ 1*a_etaB+1*a_eta2+1*a_eta4
                      a_s =~ 0*a_etaB+1*a_eta2+2*a_eta4
                      a_i~~NA*a_i
                      a_s~~NA*a_s
                      a_i~~a_s
                      a_i~1
                      a_s~1
                      a_etaB~0*1
                      a_eta2~0*1
                      a_eta4~0*1

               # second-order g factor
               #factor loadings # S & S2
               g_etaB =~ 1*flanker_0+
                       lambda_R*pattern_0+
                       lambda_M*picture_0+
                       lambda_P*picvocab_0+
                       lambda_V*reading_0
               g_eta2 =~ 1*flanker_2+
                       lambda_R*pattern_2+
                       lambda_M*picture_2+
                       lambda_P*picvocab_2+
                       lambda_V*reading_2
               g_eta4 =~ 1*flanker_4+
                       lambda_R*pattern_4+
                       lambda_M*picture_4+
                       lambda_P*picvocab_4+
                       lambda_V*reading_4
               g_eta6 =~ 1*flanker_6+
                       lambda_R*pattern_6+
                       lambda_M*picture_6+
                       lambda_P*picvocab_6+
                       lambda_V*reading_6

              #latent variable variances
                       g_etaB~~NA*g_etaB
                       g_eta2~~NA*g_eta2
                       g_eta4~~NA*g_eta4
                       g_eta6~~NA*g_eta6

              #unique variances
                      flanker_0~~flanker_0
                      flanker_2~~flanker_2
                      flanker_4~~flanker_4
                      flanker_6~~flanker_6

                      pattern_0~~pattern_0
                      pattern_2~~pattern_2
                      pattern_4~~pattern_4
                      pattern_6~~pattern_6

                      picture_0~~picture_0
                      picture_2~~picture_2
                      picture_4~~picture_4
                      picture_6~~picture_6

                      picvocab_0~~picvocab_0
                      picvocab_2~~picvocab_2
                      picvocab_4~~picvocab_4
                      picvocab_6~~picvocab_6

                      reading_0~~reading_0
                      reading_2~~reading_2
                      reading_4~~reading_4
                      reading_6~~reading_6

              #unique covariances
                      # Task across times
                      flanker_0~~flanker_2 + flanker_4 + flanker_6
                      flanker_2~~flanker_4 + flanker_6
                      flanker_4~~flanker_6

                      pattern_0~~pattern_2 + pattern_4 + pattern_6
                      pattern_2~~pattern_4 + pattern_6
                      pattern_4~~pattern_6

                      picture_0~~picture_2 + picture_4 + picture_6
                      picture_2~~picture_4 + picture_6
                      picture_4~~picture_6

                      picvocab_0~~picvocab_2 + picvocab_4 + picvocab_6
                      picvocab_2~~picvocab_4 + picvocab_6
                      picvocab_4~~picvocab_6

                      reading_0~~reading_2 + reading_4 + reading_6
                      reading_2~~reading_4 + reading_6
                      reading_4~~reading_6

                      #Language
                      picvocab_0~~reading_0 + reading_2 + reading_4 + reading_6
                      picvocab_2~~reading_2 + reading_0 + reading_4 + reading_6
                      picvocab_4~~reading_4 + reading_0 + reading_2 + reading_6
                      picvocab_6~~reading_6 + reading_0 + reading_2 + reading_4

              #observed variable intercepts # S & S2
                      flanker_0~tau_S*1
                      flanker_2~tau_S*1
                      flanker_4~tau_S*1
                      flanker_6~tau_S*1
                      pattern_0~tau_R*1
                      pattern_2~tau_R*1
                      pattern_4~tau_R*1
                      pattern_6~tau_R*1
                      picture_0~tau_M*1
                      picture_2~tau_M*1
                      picture_4~tau_M*1
                      picture_6~tau_M*1
                      picvocab_0~tau_P*1
                      picvocab_2~tau_P*1
                      picvocab_4~tau_P*1
                      picvocab_6~tau_P*1
                      reading_0~tau_V*1
                      reading_2~tau_V*1
                      reading_4~tau_V*1
                      reading_6~tau_V*1

              #latent basis model
                      g_i =~    1*g_etaB + 1*g_eta2 + 1*g_eta4 + 1*g_eta6
                      g_s =~    0*g_etaB + 1*g_eta2 + 2*g_eta4 + 3*g_eta6

                      g_i~~NA*g_i
                      g_s~~NA*g_s

                      g_i~~g_s

                      g_i~1
                      g_s~1

                      g_etaB~0*1
                      g_eta2~0*1
                      g_eta4~0*1
                      g_eta6~0*1

               # second-order puberty factor
               #factor loadings
               pu_etaB =~ 1*ph_p_pds_001_0 +
                          lambda_PR*ph_p_pds_002_0 +
                          lambda_PM*ph_p_pds_003_0

               pu_eta1 =~ 1*ph_p_pds_001_1 +
                          lambda_PR*ph_p_pds_002_1 +
                          lambda_PM*ph_p_pds_003_1

               pu_eta2 =~ 1*ph_p_pds_001_2 +
                          lambda_PR*ph_p_pds_002_2 +
                          lambda_PM*ph_p_pds_003_2

               pu_eta3 =~ 1*ph_p_pds_001_3 +
                          lambda_PR*ph_p_pds_002_3 +
                          lambda_PM*ph_p_pds_003_3

               pu_eta4 =~ 1*ph_p_pds_001_4 +
                          lambda_PR*ph_p_pds_002_4 +
                          lambda_PM*ph_p_pds_003_4

               pu_eta5 =~ 1*ph_p_pds_001_5 +
                          lambda_PR*ph_p_pds_002_5 +
                          lambda_PM*ph_p_pds_003_5

               pu_eta6 =~ 1*ph_p_pds_001_6 +
                          lambda_PR*ph_p_pds_002_6 +
                          lambda_PM*ph_p_pds_003_6

              #latent variable variances
                      pu_etaB~~NA*pu_etaB
                      pu_eta1~~NA*pu_eta1
                      pu_eta2~~NA*pu_eta2
                      pu_eta3~~NA*pu_eta3
                      pu_eta4~~NA*pu_eta4
                      pu_eta5~~NA*pu_eta5
                      pu_eta6~~NA*pu_eta6

              #unique variances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_0
                      ph_p_pds_002_0 ~~ ph_p_pds_002_0
                      ph_p_pds_003_0 ~~ ph_p_pds_003_0

                      ph_p_pds_001_1 ~~ ph_p_pds_001_1
                      ph_p_pds_002_1 ~~ ph_p_pds_002_1
                      ph_p_pds_003_1 ~~ ph_p_pds_003_1

                      ph_p_pds_001_2 ~~ ph_p_pds_001_2
                      ph_p_pds_002_2 ~~ ph_p_pds_002_2
                      ph_p_pds_003_2 ~~ ph_p_pds_003_2

                      ph_p_pds_001_3 ~~ ph_p_pds_001_3
                      ph_p_pds_002_3 ~~ ph_p_pds_002_3
                      ph_p_pds_003_3 ~~ ph_p_pds_003_3

                      ph_p_pds_001_4 ~~ ph_p_pds_001_4
                      ph_p_pds_002_4 ~~ ph_p_pds_002_4
                      ph_p_pds_003_4 ~~ ph_p_pds_003_4

                      ph_p_pds_001_5 ~~ ph_p_pds_001_5
                      ph_p_pds_002_5 ~~ ph_p_pds_002_5
                      ph_p_pds_003_5 ~~ ph_p_pds_003_5

                      ph_p_pds_001_6 ~~ ph_p_pds_001_6
                      ph_p_pds_002_6 ~~ ph_p_pds_002_6
                      ph_p_pds_003_6 ~~ ph_p_pds_003_6

              #unique covariances
                      ph_p_pds_001_0 ~~ ph_p_pds_001_1 + ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_1 ~~ ph_p_pds_001_2 + ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_2 ~~ ph_p_pds_001_3 + ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_3 ~~ ph_p_pds_001_4 + ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_4 ~~ ph_p_pds_001_5 + ph_p_pds_001_6
                      ph_p_pds_001_5 ~~ ph_p_pds_001_6

                      ph_p_pds_002_0 ~~ ph_p_pds_002_1 + ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_1 ~~ ph_p_pds_002_2 + ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_2 ~~ ph_p_pds_002_3 + ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_3 ~~ ph_p_pds_002_4 + ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_4 ~~ ph_p_pds_002_5 + ph_p_pds_002_6
                      ph_p_pds_002_5 ~~ ph_p_pds_002_6

                      ph_p_pds_003_0 ~~ ph_p_pds_003_1 + ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_1 ~~ ph_p_pds_003_2 + ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_2 ~~ ph_p_pds_003_3 + ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_3 ~~ ph_p_pds_003_4 + ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_4 ~~ ph_p_pds_003_5 + ph_p_pds_003_6
                      ph_p_pds_003_5 ~~ ph_p_pds_003_6

              #observed variable intercepts
                      ph_p_pds_001_0 ~ tau_PS*1
                      ph_p_pds_001_1 ~ tau_PS*1
                      ph_p_pds_001_2 ~ tau_PS*1
                      ph_p_pds_001_3 ~ tau_PS*1
                      ph_p_pds_001_4 ~ tau_PS*1
                      ph_p_pds_001_5 ~ tau_PS*1
                      ph_p_pds_001_6 ~ tau_PS*1

                      ph_p_pds_002_0 ~ tau_PR*1
                      ph_p_pds_002_1 ~ tau_PR*1
                      ph_p_pds_002_2 ~ tau_PR*1
                      ph_p_pds_002_3 ~ tau_PR*1
                      ph_p_pds_002_4 ~ tau_PR*1
                      ph_p_pds_002_5 ~ tau_PR*1
                      ph_p_pds_002_6 ~ tau_PR*1

                      ph_p_pds_003_0 ~ tau_PM*1
                      ph_p_pds_003_1 ~ tau_PM*1
                      ph_p_pds_003_2 ~ tau_PM*1
                      ph_p_pds_003_3 ~ tau_PM*1
                      ph_p_pds_003_4 ~ tau_PM*1
                      ph_p_pds_003_5 ~ tau_PM*1
                      ph_p_pds_003_6 ~ tau_PM*1

              #latent basis model
                      pu_i =~ 1*pu_etaB + 1*pu_eta1 + 1*pu_eta2 + 1*pu_eta3 + 1*pu_eta4 + 1*pu_eta5 + 1*pu_eta6
                      pu_s =~ 0*pu_etaB + 0.5*pu_eta1 + 1*pu_eta2 + 1.5*pu_eta3 + 2*pu_eta4 + 2.5*pu_eta5 + 3*pu_eta6
                      pu_q =~ 0*pu_etaB + 0.25*pu_eta1 + 1*pu_eta2 + 2.25*pu_eta3 + 4*pu_eta4 + 6.25*pu_eta5 + 9*pu_eta6

                      pu_i~~NA*pu_i
                      pu_s~~NA*pu_s
                      pu_q~~NA*pu_q

                      pu_i~~pu_s + pu_q
                      pu_s~~pu_q

                      pu_i~1
                      pu_s~1
                      pu_q~1

                      pu_etaB~0*1
                      pu_eta1~0*1
                      pu_eta2~0*1
                      pu_eta3~0*1
                      pu_eta4~0*1
                      pu_eta5~0*1
                      pu_eta6~0*1

              # Internalizing model
                      p_i =~ 1*Int_comp_0 + 1*Int_comp_1 + 1*Int_comp_2 + 1*Int_comp_3 + 1*Int_comp_4 + 1*Int_comp_5 + 1*Int_comp_6
                      p_s =~ 0*Int_comp_0 + .5*Int_comp_1 + 1*Int_comp_2 + 1.5*Int_comp_3 + 2*Int_comp_4 + 2.5*Int_comp_5 + 3*Int_comp_6
                      p_q =~ 0*Int_comp_0 + .25*Int_comp_1 + 1*Int_comp_2 + 2.25*Int_comp_3 + 4*Int_comp_4 + 6.25*Int_comp_5 + 9*Int_comp_6

                      p_i~~NA*p_i
                      p_s~~NA*p_s
                      p_q~~NA*p_q

                      p_i~~p_s + p_q
                      p_s~~p_q

                      p_i~1
                      p_s~1
                      p_q~1

                      Int_comp_0 ~~ NA*Int_comp_0
                      Int_comp_1 ~~ NA*Int_comp_1
                      Int_comp_2 ~~ NA*Int_comp_2
                      Int_comp_3 ~~ NA*Int_comp_3
                      Int_comp_4 ~~ NA*Int_comp_4
                      Int_comp_5 ~~ NA*Int_comp_5
                      Int_comp_6 ~~ NA*Int_comp_6

                      Int_comp_0 ~ 0*1
                      Int_comp_1 ~ 0*1
                      Int_comp_2 ~ 0*1
                      Int_comp_3 ~ 0*1
                      Int_comp_4 ~ 0*1
                      Int_comp_5 ~ 0*1
                      Int_comp_6 ~ 0*1

                      # regression
                      p_i ~ g_i + a_i + pu_i
                      p_s ~ g_i + g_s + a_i + a_s + pu_i + pu_s + pu_q
                      p_q ~ g_i + g_s + a_i + a_s + pu_i + pu_s + pu_q"
```

```{r}
#| eval: False
lavaan(Int.pga_pu6.model,
  data = readRDS("pga6_all_data.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = FALSE,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pga_pu6_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Int_pga_pu6_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Int_pga_pu6_result.rds")
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Int_pga_pu6_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pga_pu6_result.rds")
```

##### Int ~ pp + g + pu model with sex

Children’s Internalizing symptoms (Int) was regressed on parental psychopathology (pp), children’s cognitive functioning (g) and children's puberty (pu), with sex as covariate.

###### model fit

```{r}
# Add sex as covariate
Int.pga_pu6.sex.model <- Int.pga_pu6.model %>%
  str_replace_all(
    c(
      "_i ~ 1" = "_i ~ 1 + dummy_sex",
      "_s ~ 1" = "_s ~ 1 + dummy_sex",
      "_q ~ 1" = "_q ~ 1 + dummy_sex",
      "_i~1" = "_i~1 + dummy_sex",
      "_s~1" = "_s~1 + dummy_sex",
      "_q~1" = "_q~1 + dummy_sex"
    )
  )

writeLines(Int.pga_pu6.sex.model)
```

```{r}
#| eval: False
lavaan(Int.pga_pu6.sex.model,
  data = readRDS("pga6_all_data_sex.rds"),
  meanstructure = TRUE,
  estimator = "ML",
  missing = "fiml",
  fixed.x = T,
  std.lv = T
) %>%
  saveRDS("pgcm_Int_pga_pu6_sex_model.rds")
```

###### result

```{r}
#| eval: False
readRDS("pgcm_Int_pga_pu6_sex_model.rds") %>%
  summary(
    std = T,
    fit.measures = TRUE,
    rsq = T
  ) %>%
  saveRDS("pgcm_Int_pga_pu6_sex_result.rds")
```

### Result summary

#### Model fit indices

```{r}
lapply(
  c(
    "pgcm_pga_pu6_sex_result.rds",
    "pgcm_Ext_pga_pu6_sex_result.rds",
    "pgcm_Int_pga_pu6_sex_result.rds"
  ),
  function(f) {
    readRDS(f)$fit[c(
      # "chisq", "df", "pvalue",
      "cfi.robust", "tli.robust",
      "rmsea.robust", "rmsea.ci.lower.robust",
      "rmsea.ci.upper.robust", "srmr"
    )]
  }
) %>%
  do.call(rbind, .) %>%
  round(3) %>%
  data.frame(model = c("pc", "Ext", "Int"), ., row.names = NULL) %>%
  knitr::kable()
```

#### Result

```{r}
pu_model_list <- c(
  "pgcm_pga_pu6_sex_model.rds",
  "pgcm_Ext_pga_pu6_sex_model.rds",
  "pgcm_Int_pga_pu6_sex_model.rds"
)

# combine all significant results

final.pga.pu.sex.result <- data.frame()

for (a in 1:3) {
  final.pga.pu.sex.result <- final.pga.pu.sex.result %>%
    rbind(
      readRDS(paste0(model_list[a])) %>%
        standardizedSolution() %>%
        filter(op == "~") %>%
        filter(rhs != "dummy_sex") %>%
        mutate(label = str_sub(model_list[a], 6, 8))
    )
}

final.pga.pu.sex.result %>%
  mutate(sig = case_when(
    pvalue < .001 ~ "***",
    pvalue < .01 ~ "**",
    pvalue < .05 ~ "*",
    pvalue >= .05 ~ ""
  )) %>%
  mutate(
    std.lv = round(est.std, 3),
    effsize = paste0(std.lv, " [", round(ci.lower, 3), ",", round(ci.upper, 3), "]")
  ) %>%
  select(lhs, op, rhs, label, effsize) %>%
  pivot_wider(
    names_from = label,
    values_from = effsize
  ) %>%
  select(lhs, op, rhs, Int, Ext, pga) %>%
  arrange(desc(rhs)) %>%
  knitr::kable()
```

```{r}
# Check for Haywood case
eigen(inspect(readRDS("pgcm_Int_pga_pu6_sex_model.rds"), "cor.lv"))$value

readRDS("pgcm_Int_pga_pu6_sex_result.rds")
```

### Visualization

#### p, int, ext with pu result plots

```{r}
#| warning: false
ggpubr::annotate_figure(
  ggpubr::annotate_figure(
    ggpubr::ggarrange(
      para_plot(readRDS("pgcm_pga_pu6_sex_model.rds"), "g_i") +
        labs(color = "Decile\nof EV") +
        coord_cartesian(ylim = c(-0.25, 0.5)),
      para_plot(readRDS("pgcm_pga_pu6_sex_model.rds"), "g_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_pga_pu6_sex_model.rds"), "a_i") +
        coord_cartesian(ylim = c(-0.65, 1.5)),
      para_plot(readRDS("pgcm_pga_pu6_sex_model.rds"), "a_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Int_pga_pu6_sex_model.rds"), "g_i") +
        coord_cartesian(ylim = c(-0.25, 0.5)),
      para_plot(readRDS("pgcm_Int_pga_pu6_sex_model.rds"), "g_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Int_pga_pu6_sex_model.rds"), "a_i") +
        coord_cartesian(ylim = c(-0.65, 1.5)),
      para_plot(readRDS("pgcm_Int_pga_pu6_sex_model.rds"), "a_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Ext_pga_pu6_sex_model.rds"), "g_i") +
        coord_cartesian(ylim = c(-0.25, 0.5)),
      para_plot(readRDS("pgcm_Ext_pga_pu6_sex_model.rds"), "g_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      para_plot(readRDS("pgcm_Ext_pga_pu6_sex_model.rds"), "a_i") +
        coord_cartesian(ylim = c(-0.65, 1.5)),
      para_plot(readRDS("pgcm_Ext_pga_pu6_sex_model.rds"), "a_s") +
        coord_cartesian(ylim = c(-0.4, 1)),
      common.legend = TRUE,
      legend = "right",
      ncol = 4,
      nrow = 3
    ),
    top = ggpubr::text_grob("g intercept                            g slope                             pp intercept                         pp slope", hjust = .54, size = 10),
    bottom = ggpubr::text_grob("Age (Years Old)", size = 10),
    left = ggpubr::text_grob("Externalizing                Internalizing                    p factor", size = 10, rot = 90)
  ),
  top = ggpubr::text_grob("Explanatory Variables (EV)", face = "bold", size = 10),
  left = ggpubr::text_grob("Response Variables (RV)", face = "bold", size = 10, rot = 90)
)
```

## Result comparison from both models with and wthout puberty

### p, int, ext result table

```{r}
#| eval: False
bind_rows(
  standardizedSolution(readRDS("pgcm_pga6_sex_model.rds")) %>%
    filter(op == "~" & rhs != "dummy_sex") %>%
    mutate(
      op = lhs,
      label = "pga"
    ),
  standardizedSolution(readRDS("pgcm_Int_pga6_sex_model.rds")) %>%
    filter(op == "~" & rhs != "dummy_sex") %>%
    mutate(
      op = str_replace(lhs, "p_", "Int_"),
      label = "pga"
    ),
  standardizedSolution(readRDS("pgcm_Ext_pga6_sex_model.rds")) %>%
    filter(op == "~" & rhs != "dummy_sex") %>%
    mutate(
      op = str_replace(lhs, "p_", "Ext_"),
      label = "pga"
    ),
  standardizedSolution(readRDS("pgcm_pga_pu6_sex_model.rds")) %>%
    filter(op == "~" & rhs != "dummy_sex" & !str_detect(rhs, "pu_")) %>%
    mutate(
      op = lhs,
      label = "pga_pu"
    ),
  standardizedSolution(readRDS("pgcm_Int_pga_pu6_sex_model.rds")) %>%
    filter(op == "~" & rhs != "dummy_sex" & !str_detect(rhs, "pu_")) %>%
    mutate(
      op = str_replace(lhs, "p_", "Int_"),
      label = "pga_pu"
    ),
  standardizedSolution(readRDS("pgcm_Ext_pga_pu6_sex_model.rds")) %>%
    filter(op == "~" & rhs != "dummy_sex" & !str_detect(rhs, "pu_")) %>%
    mutate(
      op = str_replace(lhs, "p_", "Ext_"),
      label = "pga_pu"
    )
) %>%
  select(label, op, rhs, est.std, ci.lower, ci.upper) %>%
  mutate(No = row_number()) %>%
  saveRDS("result_sum_table.rds")
```

```{r}
readRDS("result_sum_table.rds") %>%
  DT::datatable(options = list(pageLength = 10, scrollY = "450px", scrollX = TRUE))
```

#### result comparison plots

```{r}
readRDS("result_sum_table.rds") %>%
  mutate(
    path = paste(rhs, "→", str_sub(op, -1)), # readable path
    response = str_extract(op, "^[A-Za-z]+") %>%
      recode(
        "Int" = "Internalizing",
        "Ext" = "Externalizing",
        "p" = "general~italic(p)~factor"
      )
  ) %>%
  ggplot(aes(
    x = est.std,
    y = reorder(path, -No),
    color = label
  )) +
  geom_point(position = position_dodge(width = 0.6), size = 1.5) +
  geom_errorbarh(
    aes(xmin = ci.lower, xmax = ci.upper),
    position = position_dodge(width = 0.6),
    height = 0.4,
    linewidth = 1
  ) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
  facet_wrap(~response, labeller = label_parsed) +
  labs(
    x = "Standardized Estimate with 95% CI",
    y = "Path",
    color = "Model"
  ) +
  scale_x_continuous(labels = signs::signs_format(trim_leading_zeros = TRUE)) +
  scale_color_discrete(
    labels = c(
      "pga"     = "with puberty",
      "pga_pu"  = "w/o puberty"
    )
  ) +
  theme_minimal(base_size = 17) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    strip.text = element_text(face = "bold")
  )

# No noticeable differences were observed between the main and additional analyses.
```
